<!DOCTYPE html>
<html lang="en-us">
<head>
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <script type="text/javascript" src="https://latest.cactus.chat/cactus.js"></script>
  <link rel="stylesheet" href="https://latest.cactus.chat/style.css" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Kubernetes 认证与授权 | Cactus theme example</title>
  <link rel = 'canonical' href = 'https://example.com/posts/kubernetes-auth-rbac/'>
  <meta name="description" content="随便记录点东西">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="Kubernetes 认证与授权" />
<meta property="og:description" content="对于一个系统来说，认证和授权不可或缺的部分，最常见的方式要数账号密码，管理员和普通用户这种认证方式，也就是常说的ABAC。但是每次修改权限都需要重启，或者修改记录，会有些不方便，于是基于角色的访问控制&ndash;RBAC就出现了，同时k8s分离了认证，授权和准入的过程，方便第三方开发相关插件。
下图大致描述了k8s认证的流程图，描述了一个请求在经过APIServer的时候都经历了哪些鉴权的过程。如下图所示：需要访问API的有人类，也就是Ops，通过kubectl以及Kubeconfig配置文件和API-Server交互。还有就是Pod，也就是应用，对API资源进行CURD。然后依次经过了身份认证(authentication)、授权(authorization)和准入控制（admission control）。下面就来详细介绍下认证和授权
认证  Authentication：即身份验证，这个环节它面对的输入是整个http request，它负责对来自client的请求进行身份校验，支持的方法包括：  client证书验证（https双向验证） basic auth 普通token jwt token(用于serviceaccount)    APIServer启动时，可以指定一种Authentication方法，也可以指定多种方法。如果指定了多种方法，那么APIServer将会逐个使用这些方法对客户端请求进行验证，只要请求数据通过其中一种方法的验证，APIServer就会认为Authentication成功；在较新版本kubeadm引导启动的k8s集群的apiserver初始配置中，默认支持client证书验证和serviceaccount两种身份验证方式。在这个环节，apiserver会通过client证书或http header中的字段(比如serviceaccount的jwt token)来识别出请求的“用户身份”，包括”user”、”group”等，这些信息将在后面的authorization环节用到。
Client 证书 首先我们看一下kubectl的默认配置文件~/.kube/config
1apiVersion: v1 2clusters: 3- cluster: 4 certificate-authority-data: REDACTED 5 server: https://172.16.66.101:6443 6 name: kubernetes 7contexts: 8- context: 9 cluster: kubernetes 10 user: kubernetes-admin 11 name: kubernetes-admin@kubernetes 12current-context: kubernetes-admin@kubernetes 13kind: Config 14preferences: {} 15users: 16- name: kubernetes-admin 17 user: 18 client-certificate-data: REDACTED 19 client-key-data: REDACTED 这有两个重要的信息 client-certificate-data, client-key-data,首先把data提取出来" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://example.com/posts/kubernetes-auth-rbac/" />
<meta property="article:published_time" content="2018-06-15T22:31:20+08:00" />
<meta property="article:modified_time" content="2018-06-15T22:31:20+08:00" />

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Kubernetes 认证与授权"/>
<meta name="twitter:description" content="对于一个系统来说，认证和授权不可或缺的部分，最常见的方式要数账号密码，管理员和普通用户这种认证方式，也就是常说的ABAC。但是每次修改权限都需要重启，或者修改记录，会有些不方便，于是基于角色的访问控制&ndash;RBAC就出现了，同时k8s分离了认证，授权和准入的过程，方便第三方开发相关插件。
下图大致描述了k8s认证的流程图，描述了一个请求在经过APIServer的时候都经历了哪些鉴权的过程。如下图所示：需要访问API的有人类，也就是Ops，通过kubectl以及Kubeconfig配置文件和API-Server交互。还有就是Pod，也就是应用，对API资源进行CURD。然后依次经过了身份认证(authentication)、授权(authorization)和准入控制（admission control）。下面就来详细介绍下认证和授权
认证  Authentication：即身份验证，这个环节它面对的输入是整个http request，它负责对来自client的请求进行身份校验，支持的方法包括：  client证书验证（https双向验证） basic auth 普通token jwt token(用于serviceaccount)    APIServer启动时，可以指定一种Authentication方法，也可以指定多种方法。如果指定了多种方法，那么APIServer将会逐个使用这些方法对客户端请求进行验证，只要请求数据通过其中一种方法的验证，APIServer就会认为Authentication成功；在较新版本kubeadm引导启动的k8s集群的apiserver初始配置中，默认支持client证书验证和serviceaccount两种身份验证方式。在这个环节，apiserver会通过client证书或http header中的字段(比如serviceaccount的jwt token)来识别出请求的“用户身份”，包括”user”、”group”等，这些信息将在后面的authorization环节用到。
Client 证书 首先我们看一下kubectl的默认配置文件~/.kube/config
1apiVersion: v1 2clusters: 3- cluster: 4 certificate-authority-data: REDACTED 5 server: https://172.16.66.101:6443 6 name: kubernetes 7contexts: 8- context: 9 cluster: kubernetes 10 user: kubernetes-admin 11 name: kubernetes-admin@kubernetes 12current-context: kubernetes-admin@kubernetes 13kind: Config 14preferences: {} 15users: 16- name: kubernetes-admin 17 user: 18 client-certificate-data: REDACTED 19 client-key-data: REDACTED 这有两个重要的信息 client-certificate-data, client-key-data,首先把data提取出来"/>

  
  
    
  
  
  <link rel="stylesheet" href="https://example.com/css/styles.b7d947e05a1170a37e8b82db035a37baf568e98c7fcbe3f9dd31eac5e6a72150f9f731721fa60a1b3eed4c6a9db9c5a706d396767b698198aeea1614f88ce960.css" integrity="sha512-t9lH4FoRcKN&#43;i4LbA1o3uvVo6Yx/y&#43;P53THqxeanIVD59zFyH6YKGz7tTGqducWnBtOWdntpgZiu6hYU&#43;IzpYA=="> 

  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://example.com/images/favicon.ico" />

  
  
  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts">Writings</a></li>
         
        <li><a href="/tags">Tags</a></li>
         
        <li><a href="/about">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li>
          <a class="icon" href="https://example.com/posts/promethus/" aria-label="Next">
            <i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i>
          </a>
        </li>
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#" aria-label="Share">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fexample.com%2fposts%2fkubernetes-auth-rbac%2f" aria-label="Facebook">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fexample.com%2fposts%2fkubernetes-auth-rbac%2f&text=Kubernetes%20%e8%ae%a4%e8%af%81%e4%b8%8e%e6%8e%88%e6%9d%83" aria-label="Twitter">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fexample.com%2fposts%2fkubernetes-auth-rbac%2f&title=Kubernetes%20%e8%ae%a4%e8%af%81%e4%b8%8e%e6%8e%88%e6%9d%83" aria-label="Linkedin">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fexample.com%2fposts%2fkubernetes-auth-rbac%2f&is_video=false&description=Kubernetes%20%e8%ae%a4%e8%af%81%e4%b8%8e%e6%8e%88%e6%9d%83" aria-label="Pinterest">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Kubernetes%20%e8%ae%a4%e8%af%81%e4%b8%8e%e6%8e%88%e6%9d%83&body=Check out this article: https%3a%2f%2fexample.com%2fposts%2fkubernetes-auth-rbac%2f" aria-label="Email">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fexample.com%2fposts%2fkubernetes-auth-rbac%2f&title=Kubernetes%20%e8%ae%a4%e8%af%81%e4%b8%8e%e6%8e%88%e6%9d%83" aria-label="Pocket">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fexample.com%2fposts%2fkubernetes-auth-rbac%2f&title=Kubernetes%20%e8%ae%a4%e8%af%81%e4%b8%8e%e6%8e%88%e6%9d%83" aria-label="reddit">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fexample.com%2fposts%2fkubernetes-auth-rbac%2f&name=Kubernetes%20%e8%ae%a4%e8%af%81%e4%b8%8e%e6%8e%88%e6%9d%83&description=%e5%af%b9%e4%ba%8e%e4%b8%80%e4%b8%aa%e7%b3%bb%e7%bb%9f%e6%9d%a5%e8%af%b4%ef%bc%8c%e8%ae%a4%e8%af%81%e5%92%8c%e6%8e%88%e6%9d%83%e4%b8%8d%e5%8f%af%e6%88%96%e7%bc%ba%e7%9a%84%e9%83%a8%e5%88%86%ef%bc%8c%e6%9c%80%e5%b8%b8%e8%a7%81%e7%9a%84%e6%96%b9%e5%bc%8f%e8%a6%81%e6%95%b0%e8%b4%a6%e5%8f%b7%e5%af%86%e7%a0%81%ef%bc%8c%e7%ae%a1%e7%90%86%e5%91%98%e5%92%8c%e6%99%ae%e9%80%9a%e7%94%a8%e6%88%b7%e8%bf%99%e7%a7%8d%e8%ae%a4%e8%af%81%e6%96%b9%e5%bc%8f%ef%bc%8c%e4%b9%9f%e5%b0%b1%e6%98%af%e5%b8%b8%e8%af%b4%e7%9a%84ABAC%e3%80%82%e4%bd%86%e6%98%af%e6%af%8f%e6%ac%a1%e4%bf%ae%e6%94%b9%e6%9d%83%e9%99%90%e9%83%bd%e9%9c%80%e8%a6%81%e9%87%8d%e5%90%af%ef%bc%8c%e6%88%96%e8%80%85%e4%bf%ae%e6%94%b9%e8%ae%b0%e5%bd%95%ef%bc%8c%e4%bc%9a%e6%9c%89%e4%ba%9b%e4%b8%8d%e6%96%b9%e4%be%bf%ef%bc%8c%e4%ba%8e%e6%98%af%e5%9f%ba%e4%ba%8e%e8%a7%92%e8%89%b2%e7%9a%84%e8%ae%bf%e9%97%ae%e6%8e%a7%e5%88%b6%26ndash%3bRBAC%e5%b0%b1%e5%87%ba%e7%8e%b0%e4%ba%86%ef%bc%8c%e5%90%8c%e6%97%b6k8s%e5%88%86%e7%a6%bb%e4%ba%86%e8%ae%a4%e8%af%81%ef%bc%8c%e6%8e%88%e6%9d%83%e5%92%8c%e5%87%86%e5%85%a5%e7%9a%84%e8%bf%87%e7%a8%8b%ef%bc%8c%e6%96%b9%e4%be%bf%e7%ac%ac%e4%b8%89%e6%96%b9%e5%bc%80%e5%8f%91%e7%9b%b8%e5%85%b3%e6%8f%92%e4%bb%b6%e3%80%82%0a%e4%b8%8b%e5%9b%be%e5%a4%a7%e8%87%b4%e6%8f%8f%e8%bf%b0%e4%ba%86k8s%e8%ae%a4%e8%af%81%e7%9a%84%e6%b5%81%e7%a8%8b%e5%9b%be%ef%bc%8c%e6%8f%8f%e8%bf%b0%e4%ba%86%e4%b8%80%e4%b8%aa%e8%af%b7%e6%b1%82%e5%9c%a8%e7%bb%8f%e8%bf%87APIServer%e7%9a%84%e6%97%b6%e5%80%99%e9%83%bd%e7%bb%8f%e5%8e%86%e4%ba%86%e5%93%aa%e4%ba%9b%e9%89%b4%e6%9d%83%e7%9a%84%e8%bf%87%e7%a8%8b%e3%80%82%e5%a6%82%e4%b8%8b%e5%9b%be%e6%89%80%e7%a4%ba%ef%bc%9a%e9%9c%80%e8%a6%81%e8%ae%bf%e9%97%aeAPI%e7%9a%84%e6%9c%89%e4%ba%ba%e7%b1%bb%ef%bc%8c%e4%b9%9f%e5%b0%b1%e6%98%afOps%ef%bc%8c%e9%80%9a%e8%bf%87kubectl%e4%bb%a5%e5%8f%8aKubeconfig%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e5%92%8cAPI-Server%e4%ba%a4%e4%ba%92%e3%80%82%e8%bf%98%e6%9c%89%e5%b0%b1%e6%98%afPod%ef%bc%8c%e4%b9%9f%e5%b0%b1%e6%98%af%e5%ba%94%e7%94%a8%ef%bc%8c%e5%af%b9API%e8%b5%84%e6%ba%90%e8%bf%9b%e8%a1%8cCURD%e3%80%82%e7%84%b6%e5%90%8e%e4%be%9d%e6%ac%a1%e7%bb%8f%e8%bf%87%e4%ba%86%e8%ba%ab%e4%bb%bd%e8%ae%a4%e8%af%81%28authentication%29%e3%80%81%e6%8e%88%e6%9d%83%28authorization%29%e5%92%8c%e5%87%86%e5%85%a5%e6%8e%a7%e5%88%b6%ef%bc%88admission%20control%ef%bc%89%e3%80%82%e4%b8%8b%e9%9d%a2%e5%b0%b1%e6%9d%a5%e8%af%a6%e7%bb%86%e4%bb%8b%e7%bb%8d%e4%b8%8b%e8%ae%a4%e8%af%81%e5%92%8c%e6%8e%88%e6%9d%83%0a%e8%ae%a4%e8%af%81%20%20Authentication%ef%bc%9a%e5%8d%b3%e8%ba%ab%e4%bb%bd%e9%aa%8c%e8%af%81%ef%bc%8c%e8%bf%99%e4%b8%aa%e7%8e%af%e8%8a%82%e5%ae%83%e9%9d%a2%e5%af%b9%e7%9a%84%e8%be%93%e5%85%a5%e6%98%af%e6%95%b4%e4%b8%aahttp%20request%ef%bc%8c%e5%ae%83%e8%b4%9f%e8%b4%a3%e5%af%b9%e6%9d%a5%e8%87%aaclient%e7%9a%84%e8%af%b7%e6%b1%82%e8%bf%9b%e8%a1%8c%e8%ba%ab%e4%bb%bd%e6%a0%a1%e9%aa%8c%ef%bc%8c%e6%94%af%e6%8c%81%e7%9a%84%e6%96%b9%e6%b3%95%e5%8c%85%e6%8b%ac%ef%bc%9a%20%20client%e8%af%81%e4%b9%a6%e9%aa%8c%e8%af%81%ef%bc%88https%e5%8f%8c%e5%90%91%e9%aa%8c%e8%af%81%ef%bc%89%20basic%20auth%20%e6%99%ae%e9%80%9atoken%20jwt%20token%28%e7%94%a8%e4%ba%8eserviceaccount%29%20%20%20%20APIServer%e5%90%af%e5%8a%a8%e6%97%b6%ef%bc%8c%e5%8f%af%e4%bb%a5%e6%8c%87%e5%ae%9a%e4%b8%80%e7%a7%8dAuthentication%e6%96%b9%e6%b3%95%ef%bc%8c%e4%b9%9f%e5%8f%af%e4%bb%a5%e6%8c%87%e5%ae%9a%e5%a4%9a%e7%a7%8d%e6%96%b9%e6%b3%95%e3%80%82%e5%a6%82%e6%9e%9c%e6%8c%87%e5%ae%9a%e4%ba%86%e5%a4%9a%e7%a7%8d%e6%96%b9%e6%b3%95%ef%bc%8c%e9%82%a3%e4%b9%88APIServer%e5%b0%86%e4%bc%9a%e9%80%90%e4%b8%aa%e4%bd%bf%e7%94%a8%e8%bf%99%e4%ba%9b%e6%96%b9%e6%b3%95%e5%af%b9%e5%ae%a2%e6%88%b7%e7%ab%af%e8%af%b7%e6%b1%82%e8%bf%9b%e8%a1%8c%e9%aa%8c%e8%af%81%ef%bc%8c%e5%8f%aa%e8%a6%81%e8%af%b7%e6%b1%82%e6%95%b0%e6%8d%ae%e9%80%9a%e8%bf%87%e5%85%b6%e4%b8%ad%e4%b8%80%e7%a7%8d%e6%96%b9%e6%b3%95%e7%9a%84%e9%aa%8c%e8%af%81%ef%bc%8cAPIServer%e5%b0%b1%e4%bc%9a%e8%ae%a4%e4%b8%baAuthentication%e6%88%90%e5%8a%9f%ef%bc%9b%e5%9c%a8%e8%be%83%e6%96%b0%e7%89%88%e6%9c%ackubeadm%e5%bc%95%e5%af%bc%e5%90%af%e5%8a%a8%e7%9a%84k8s%e9%9b%86%e7%be%a4%e7%9a%84apiserver%e5%88%9d%e5%a7%8b%e9%85%8d%e7%bd%ae%e4%b8%ad%ef%bc%8c%e9%bb%98%e8%ae%a4%e6%94%af%e6%8c%81client%e8%af%81%e4%b9%a6%e9%aa%8c%e8%af%81%e5%92%8cserviceaccount%e4%b8%a4%e7%a7%8d%e8%ba%ab%e4%bb%bd%e9%aa%8c%e8%af%81%e6%96%b9%e5%bc%8f%e3%80%82%e5%9c%a8%e8%bf%99%e4%b8%aa%e7%8e%af%e8%8a%82%ef%bc%8capiserver%e4%bc%9a%e9%80%9a%e8%bf%87client%e8%af%81%e4%b9%a6%e6%88%96http%20header%e4%b8%ad%e7%9a%84%e5%ad%97%e6%ae%b5%28%e6%af%94%e5%a6%82serviceaccount%e7%9a%84jwt%20token%29%e6%9d%a5%e8%af%86%e5%88%ab%e5%87%ba%e8%af%b7%e6%b1%82%e7%9a%84%e2%80%9c%e7%94%a8%e6%88%b7%e8%ba%ab%e4%bb%bd%e2%80%9d%ef%bc%8c%e5%8c%85%e6%8b%ac%e2%80%9duser%e2%80%9d%e3%80%81%e2%80%9dgroup%e2%80%9d%e7%ad%89%ef%bc%8c%e8%bf%99%e4%ba%9b%e4%bf%a1%e6%81%af%e5%b0%86%e5%9c%a8%e5%90%8e%e9%9d%a2%e7%9a%84authorization%e7%8e%af%e8%8a%82%e7%94%a8%e5%88%b0%e3%80%82%0aClient%20%e8%af%81%e4%b9%a6%20%e9%a6%96%e5%85%88%e6%88%91%e4%bb%ac%e7%9c%8b%e4%b8%80%e4%b8%8bkubectl%e7%9a%84%e9%bb%98%e8%ae%a4%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6~%2f.kube%2fconfig%0a1apiVersion%3a%20v1%202clusters%3a%203-%20cluster%3a%204%20certificate-authority-data%3a%20REDACTED%205%20server%3a%20https%3a%2f%2f172.16.66.101%3a6443%206%20name%3a%20kubernetes%207contexts%3a%208-%20context%3a%209%20cluster%3a%20kubernetes%2010%20user%3a%20kubernetes-admin%2011%20name%3a%20kubernetes-admin%40kubernetes%2012current-context%3a%20kubernetes-admin%40kubernetes%2013kind%3a%20Config%2014preferences%3a%20%7b%7d%2015users%3a%2016-%20name%3a%20kubernetes-admin%2017%20user%3a%2018%20client-certificate-data%3a%20REDACTED%2019%20client-key-data%3a%20REDACTED%20%e8%bf%99%e6%9c%89%e4%b8%a4%e4%b8%aa%e9%87%8d%e8%a6%81%e7%9a%84%e4%bf%a1%e6%81%af%20client-certificate-data%2c%20client-key-data%2c%e9%a6%96%e5%85%88%e6%8a%8adata%e6%8f%90%e5%8f%96%e5%87%ba%e6%9d%a5" aria-label="Tumblr">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fexample.com%2fposts%2fkubernetes-auth-rbac%2f&t=Kubernetes%20%e8%ae%a4%e8%af%81%e4%b8%8e%e6%8e%88%e6%9d%83" aria-label="Hacker News">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    
    <div id="toc">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#认证">认证</a>
      <ul>
        <li><a href="#client-证书">Client 证书</a></li>
        <li><a href="#basic-auth">Basic Auth</a></li>
        <li><a href="#service-account">Service Account</a></li>
      </ul>
    </li>
    <li><a href="#授权">授权</a></li>
    <li><a href="#rbac实战">RBAC实战</a></li>
    <li><a href="#ref">Ref</a></li>
  </ul>
</nav>
    </div>
    
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        Kubernetes 认证与授权
      </h1>
      <div class="meta">
        
        <div class="postdate">
          
          <time datetime="2018-06-15 22:31:20 &#43;0800 CST" itemprop="datePublished">2018-06-15</time>
          
        </div>
        
        
        <div class="article-read-time">
          <i class="far fa-clock"></i>
          
          12 minute read
        </div>
        
        
        
        <div class="article-tag">
            <i class="fas fa-tag"></i>
            
            
            <a class="tag-link" href="/tags/k8s" rel="tag">k8s</a>
            
        </div>
        
      </div>
    </header>

  
    
    <div class="content" itemprop="articleBody">
      <p>对于一个系统来说，认证和授权不可或缺的部分，最常见的方式要数账号密码，管理员和普通用户这种认证方式，也就是常说的ABAC。但是每次修改权限都需要重启，或者修改记录，会有些不方便，于是基于角色的访问控制&ndash;RBAC就出现了，同时k8s分离了认证，授权和准入的过程，方便第三方开发相关插件。</p>
<p>下图大致描述了k8s认证的流程图，描述了一个请求在经过APIServer的时候都经历了哪些鉴权的过程。如下图所示：需要访问API的有人类，也就是Ops，通过kubectl以及Kubeconfig配置文件和API-Server交互。还有就是Pod，也就是应用，对API资源进行CURD。然后依次经过了身份认证(authentication)、授权(authorization)和准入控制（admission control）。下面就来详细介绍下认证和授权</p>
<p><img src="../images/rbac01.jpg" alt=""></p>
<h2 id="认证">认证</h2>
<ul>
<li>Authentication：即身份验证，这个环节它面对的输入是整个http request，它负责对来自client的请求进行身份校验，支持的方法包括：
<ul>
<li>client证书验证（https双向验证）</li>
<li>basic auth</li>
<li>普通token</li>
<li>jwt token(用于serviceaccount)</li>
</ul>
</li>
</ul>
<p>APIServer启动时，可以指定一种Authentication方法，也可以指定多种方法。如果指定了多种方法，那么APIServer将会逐个使用这些方法对客户端请求进行验证，只要请求数据通过其中一种方法的验证，APIServer就会认为Authentication成功；在较新版本kubeadm引导启动的k8s集群的apiserver初始配置中，默认支持client证书验证和serviceaccount两种身份验证方式。在这个环节，apiserver会通过client证书或http header中的字段(比如serviceaccount的jwt token)来识别出请求的“用户身份”，包括”user”、”group”等，这些信息将在后面的authorization环节用到。</p>
<h3 id="client-证书">Client 证书</h3>
<p>首先我们看一下kubectl的默认配置文件~/.kube/config</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#ff79c6">apiVersion</span>: v1
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#ff79c6">clusters</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>- <span style="color:#ff79c6">cluster</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>    <span style="color:#ff79c6">certificate-authority-data</span>: REDACTED
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>    <span style="color:#ff79c6">server</span>: https://172.16.66.101:6443
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>  <span style="color:#ff79c6">name</span>: kubernetes
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span style="color:#ff79c6">contexts</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>- <span style="color:#ff79c6">context</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>    <span style="color:#ff79c6">cluster</span>: kubernetes
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>    <span style="color:#ff79c6">user</span>: kubernetes-admin
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>  <span style="color:#ff79c6">name</span>: kubernetes-admin@kubernetes
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span style="color:#ff79c6">current-context</span>: kubernetes-admin@kubernetes
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span style="color:#ff79c6">kind</span>: Config
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span style="color:#ff79c6">preferences</span>: {}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span style="color:#ff79c6">users</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>- <span style="color:#ff79c6">name</span>: kubernetes-admin
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>  <span style="color:#ff79c6">user</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>    <span style="color:#ff79c6">client-certificate-data</span>: REDACTED
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>    <span style="color:#ff79c6">client-key-data</span>: REDACTED
</code></pre></div><p>这有两个重要的信息 client-certificate-data, client-key-data,首先把data提取出来</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#6272a4"># 生成client-certificate-data</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>grep <span style="color:#f1fa8c">&#39;client-certificate-data&#39;</span> ~/.kube/config | head -n <span style="color:#bd93f9">1</span> | awk <span style="color:#f1fa8c">&#39;{print $2}&#39;</span> | base64 -d &gt;&gt; kubecfg.crt
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span style="color:#6272a4"># 生成client-key-data</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>grep <span style="color:#f1fa8c">&#39;client-key-data&#39;</span> ~/.kube/config | head -n <span style="color:#bd93f9">1</span> | awk <span style="color:#f1fa8c">&#39;{print $2}&#39;</span> | base64 -d &gt;&gt; kubecfg.key
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>openssl x509 -noout -text -in kubecfg.crt
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>Certificate:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>    Data:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>        Version: <span style="color:#bd93f9">3</span> <span style="color:#ff79c6">(</span>0x2<span style="color:#ff79c6">)</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>        Serial Number: <span style="color:#bd93f9">6675913985209031083</span> <span style="color:#ff79c6">(</span>0x5ca59c66277259ab<span style="color:#ff79c6">)</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>    Signature Algorithm: sha256WithRSAEncryption
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>        Issuer: <span style="color:#8be9fd;font-style:italic">CN</span><span style="color:#ff79c6">=</span>kubernetes
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>        Validity
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>            Not Before: Apr <span style="color:#bd93f9">13</span> 10:22:37 <span style="color:#bd93f9">2019</span> GMT
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>            Not After : Apr <span style="color:#bd93f9">12</span> 10:22:38 <span style="color:#bd93f9">2020</span> GMT
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>        Subject: <span style="color:#8be9fd;font-style:italic">O</span><span style="color:#ff79c6">=</span>system:masters, <span style="color:#8be9fd;font-style:italic">CN</span><span style="color:#ff79c6">=</span>kubernetes-admin <span style="color:#6272a4">#此证书是签发给system:masters的，</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>        Subject Public Key Info:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>            Public Key Algorithm: rsaEncryption
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span>                Public-Key: <span style="color:#ff79c6">(</span><span style="color:#bd93f9">2048</span> bit<span style="color:#ff79c6">)</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>                Modulus:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>                    .....
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>                Exponent: <span style="color:#bd93f9">65537</span> <span style="color:#ff79c6">(</span>0x10001<span style="color:#ff79c6">)</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span>        X509v3 extensions:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>            X509v3 Key Usage: critical
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span>                Digital Signature, Key Encipherment
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span>            X509v3 Extended Key Usage: 
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span>                TLS Web Client Authentication <span style="color:#6272a4"># 此证书可以作为TLS的客户端证书</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span>    Signature Algorithm: sha256WithRSAEncryption
</code></pre></div><p>为什么是这个用户呢？在集群中可以看到这样一条记录，k8s默认把system:masters用户绑定上了clsuter-admin的角色，也就是整个集群的管理员，所以当我们有了这个客户端证书之后，就可以管理集群的任何资源。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span>kubectl -n kube-system describe clusterrolebindings cluster-admin
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>Name:         cluster-admin
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>Labels:       kubernetes.io/bootstrapping<span style="color:#ff79c6">=</span>rbac-defaults
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>Annotations:  rbac.authorization.kubernetes.io/autoupdate<span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">true</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>Role:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>  Kind:  ClusterRole
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>  Name:  cluster-admin
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>Subjects:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>  Kind   Name            Namespace
</code></pre></div><p>下面我们来手动访问下API Server：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#8be9fd;font-style:italic">MASTER</span><span style="color:#ff79c6">=</span>192.168.1.1
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#6272a4"># 因为是自签名证书 用-k 忽略证书校验 </span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span style="color:#6272a4"># 默认的request是system:anonymous用户 没有权限访问</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>curl -k  https://<span style="color:#8be9fd;font-style:italic">$MASTER</span>:6443/api
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span style="color:#ff79c6">{</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>  <span style="color:#f1fa8c">&#34;kind&#34;</span>: <span style="color:#f1fa8c">&#34;Status&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>  <span style="color:#f1fa8c">&#34;apiVersion&#34;</span>: <span style="color:#f1fa8c">&#34;v1&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>  <span style="color:#f1fa8c">&#34;metadata&#34;</span>: <span style="color:#ff79c6">{</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>  <span style="color:#ff79c6">}</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>  <span style="color:#f1fa8c">&#34;status&#34;</span>: <span style="color:#f1fa8c">&#34;Failure&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>  <span style="color:#f1fa8c">&#34;message&#34;</span>: <span style="color:#f1fa8c">&#34;forbidden: User \&#34;system:anonymous\&#34; cannot get path \&#34;/api\&#34;&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>  <span style="color:#f1fa8c">&#34;reason&#34;</span>: <span style="color:#f1fa8c">&#34;Forbidden&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>  <span style="color:#f1fa8c">&#34;details&#34;</span>: <span style="color:#ff79c6">{</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>  <span style="color:#ff79c6">}</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>  <span style="color:#f1fa8c">&#34;code&#34;</span>: <span style="color:#bd93f9">403</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span style="color:#ff79c6">}</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span style="color:#6272a4"># 使用客户端证书进行认证</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span>curl -v --cacert /etc/kubernetes/pki/ca.crt  --key ./kubecfg.key --cert ./kubecfg.crt https://<span style="color:#8be9fd;font-style:italic">$MASTER</span>:6443/api
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span><span style="color:#6272a4"># 同理访问kubelet的metrics接口</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>curl -k  --cacert /etc/kubernetes/pki/ca.crt --cert /etc/kubernetes/pki/apiserver-kubelet-client.crt --key /etc/kubernetes/pki/apiserver-kubelet-client.key https://127.0.0.1:10250/metrics
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span><span style="color:#6272a4"># 也可以生成另一类p12证书</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>openssl pkcs12 -export -clcerts -inkey kubecfg.key -in kubecfg.crt -out kubecfg.p12 -name <span style="color:#f1fa8c">&#34;kubernetes-client&#34;</span>
</code></pre></div><h3 id="basic-auth">Basic Auth</h3>
<p>API有一个启动参数&ndash;basic-auth-file，可以指定一个csv格式的文件作为Basic Auth</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span>cat &lt;&lt;EOF &gt; basicauth.csv
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>admin,admin,1,&#34;demo&#34;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>EOF
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>cat &lt;&lt;EOF &gt; kubectl apply -f -
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span style="color:#ff79c6">kind</span>: ClusterRole
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span style="color:#ff79c6">apiVersion</span>: rbac.authorization.k8s.io/v1
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span style="color:#ff79c6">metadata</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>  <span style="color:#ff79c6">name</span>: ui-admin
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span style="color:#ff79c6">rules</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>- <span style="color:#ff79c6">apiGroups</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>  - <span style="color:#f1fa8c">&#34;&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>  <span style="color:#ff79c6">resources</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>  - services
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>  - services/proxy
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>  <span style="color:#ff79c6">verbs</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>  - <span style="color:#f1fa8c">&#39;*&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>---
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span style="color:#ff79c6">apiVersion</span>: rbac.authorization.k8s.io/v1
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span style="color:#ff79c6">kind</span>: RoleBinding
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span><span style="color:#ff79c6">metadata</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>  <span style="color:#ff79c6">name</span>: ui-admin-binding
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>  <span style="color:#ff79c6">namespace</span>: kube-system
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span><span style="color:#ff79c6">roleRef</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>  <span style="color:#ff79c6">apiGroup</span>: rbac.authorization.k8s.io
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span>  <span style="color:#ff79c6">kind</span>: ClusterRole
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span>  <span style="color:#ff79c6">name</span>: ui-admin
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span><span style="color:#ff79c6">subjects</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span>- <span style="color:#ff79c6">apiGroup</span>: rbac.authorization.k8s.io
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span>  <span style="color:#ff79c6">kind</span>: User
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span>  <span style="color:#ff79c6">name</span>: admin
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span>EOF  
</code></pre></div><h3 id="service-account">Service Account</h3>
<p>当创建一个Service Account会生成一个token，通过<code>kubectl -n kube-system describe secrets  ${Service account}</code>可以看到一个以<code>eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9</code>开头的Token。可以在jwt.io上面解码一下，得到的结果如下所示：APIServer也就是通过这些字段进行鉴权的。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span style="color:#ff79c6">{</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span>  <span style="color:#f1fa8c">&#34;iss&#34;</span>: <span style="color:#f1fa8c">&#34;kubernetes/serviceaccount&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span>  <span style="color:#f1fa8c">&#34;kubernetes.io/serviceaccount/namespace&#34;</span>: <span style="color:#f1fa8c">&#34;default&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span>  <span style="color:#f1fa8c">&#34;kubernetes.io/serviceaccount/secret.name&#34;</span>: <span style="color:#f1fa8c">&#34;default-token-ph2f5&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span>  <span style="color:#f1fa8c">&#34;kubernetes.io/serviceaccount/service-account.name&#34;</span>: <span style="color:#f1fa8c">&#34;default&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span>  <span style="color:#f1fa8c">&#34;kubernetes.io/serviceaccount/service-account.uid&#34;</span>: <span style="color:#f1fa8c">&#34;7ce56043-7dcc-11e9-9925-00163e132347&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span>  <span style="color:#f1fa8c">&#34;sub&#34;</span>: <span style="color:#f1fa8c">&#34;system:serviceaccount:default:default&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8</span><span style="color:#ff79c6">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span style="color:#6272a4"># 手动使用Token认证一下</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span style="color:#8be9fd;font-style:italic">TOKEN</span><span style="color:#ff79c6">=</span><span style="color:#ff79c6">$(</span>kubectl describe secret <span style="color:#ff79c6">$(</span>kubectl get secrets | grep default | cut -f1 -d <span style="color:#f1fa8c">&#39; &#39;</span><span style="color:#ff79c6">)</span> | grep -E <span style="color:#f1fa8c">&#39;^token&#39;</span> | cut -f2 -d<span style="color:#f1fa8c">&#39;:&#39;</span> | tr -d <span style="color:#f1fa8c">&#39;\t&#39;</span><span style="color:#ff79c6">)</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span style="color:#8be9fd;font-style:italic">MASTER</span><span style="color:#ff79c6">=</span>10.96.0.1
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span style="color:#8be9fd;font-style:italic">TOKEN</span><span style="color:#ff79c6">=</span><span style="color:#ff79c6">$(</span>cat /var/run/secrets/kubernetes.io/serviceaccount/token<span style="color:#ff79c6">)</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span>curl -k -H <span style="color:#f1fa8c">&#34;Authorization: Bearer </span><span style="color:#8be9fd;font-style:italic">$TOKEN</span><span style="color:#f1fa8c">&#34;</span> https://<span style="color:#8be9fd;font-style:italic">$MASTER</span>:6443/api
</code></pre></div><h2 id="授权">授权</h2>
<p>Authorization：授权。这个环节面对的输入是http request context中的各种属性，包括：user、group、request path（比如：/api/v1、/healthz、/version等）、request verb(比如：get、list、create等)。APIServer会将这些属性值与事先配置好的访问策略(access policy）相比较。APIServer支持多种authorization mode，包括Node、RBAC、Webhook等。</p>
<p>APIServer启动时，可以指定一种authorization mode，也可以指定多种authorization mode，如果是后者，只要Request通过了其中一种mode的授权，那么该环节的最终结果就是授权成功。在较新版本kubeadm引导启动的k8s集群的apiserver初始配置中，authorization-mode的默认配置是”Node,RBAC”。Node授权器主要用于各个node上的kubelet访问apiserver时使用的，其他一般均由RBAC授权器来授权。</p>
<h2 id="rbac实战">RBAC实战</h2>
<p>k8s 大约有以下几种角色</p>
<ul>
<li>role 和 clusterrole 规定了权限的内容，也就是某个人或者角色能干什么</li>
<li>Service account 也就是具体的角色或者账户</li>
<li>rolebinding 和 clusterrolebinding 就是将两者结合在一起，规定什么人有什么样的权限</li>
</ul>
<p>下面我们来看一下例子</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span>---
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#6272a4"># ------------------- ClusterRole ------------------- #</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span style="color:#ff79c6">kind</span>: ClusterRole
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span style="color:#ff79c6">apiVersion</span>: rbac.authorization.k8s.io/v1beta1
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span style="color:#ff79c6">metadata</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>  <span style="color:#ff79c6">name</span>: traefik-ingress-controller
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span style="color:#ff79c6">rules</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>  - <span style="color:#ff79c6">apiGroups</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>      - <span style="color:#f1fa8c">&#34;&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>    <span style="color:#ff79c6">resources</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>      - services
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>      - endpoints
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>      - secrets
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>    <span style="color:#ff79c6">verbs</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>      - get
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>      - list
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>      - watch
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>  - <span style="color:#ff79c6">apiGroups</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>      - extensions
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span>    <span style="color:#ff79c6">resources</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>      - ingresses
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>    <span style="color:#ff79c6">verbs</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>      - get
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span>      - list
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>      - watch
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span>---
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span><span style="color:#6272a4"># ------------------- ClusterRoleBinding ------------------- #</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span><span style="color:#ff79c6">kind</span>: ClusterRoleBinding
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span><span style="color:#ff79c6">apiVersion</span>: rbac.authorization.k8s.io/v1beta1
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span><span style="color:#ff79c6">metadata</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span>  <span style="color:#ff79c6">name</span>: traefik-ingress-controller
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span><span style="color:#ff79c6">roleRef</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span>  <span style="color:#ff79c6">apiGroup</span>: rbac.authorization.k8s.io
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span>  <span style="color:#ff79c6">kind</span>: ClusterRole
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span>  <span style="color:#ff79c6">name</span>: traefik-ingress-controller
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36</span><span style="color:#ff79c6">subjects</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37</span>- <span style="color:#ff79c6">kind</span>: ServiceAccount
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38</span>  <span style="color:#ff79c6">name</span>: traefik-ingress-controller
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39</span>  <span style="color:#ff79c6">namespace</span>: kube-system
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40</span>---
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41</span><span style="color:#6272a4"># ------------------- ServiceAccount ------------------- #</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42</span>---
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43</span><span style="color:#ff79c6">apiVersion</span>: v1
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44</span><span style="color:#ff79c6">kind</span>: ServiceAccount
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45</span><span style="color:#ff79c6">metadata</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46</span>  <span style="color:#ff79c6">name</span>: traefik-ingress-controller
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47</span>  <span style="color:#ff79c6">namespace</span>: kube-system
</code></pre></div><h2 id="ref">Ref</h2>
<p>Kubernetes集群的安全配置</p>
<p><a href="https://tonybai.com/2016/11/25/the-security-settings-for-kubernetes-cluster/">https://tonybai.com/2016/11/25/the-security-settings-for-kubernetes-cluster/</a></p>
<p>Kubernetes RBAC 详解
<a href="https://blog.qikqiak.com/post/use-rbac-in-k8s/">https://blog.qikqiak.com/post/use-rbac-in-k8s/</a></p>
<p>使用 RBAC 控制 kubectl 权限</p>
<p><a href="https://mritd.me/2018/03/20/use-rbac-to-control-kubectl-permissions/">https://mritd.me/2018/03/20/use-rbac-to-control-kubectl-permissions/</a></p>

    </div>
  </article>

  
  






  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/posts">Writings</a></li>
         
          <li><a href="/tags">Tags</a></li>
         
          <li><a href="/about">About</a></li>
        
      </ul>
    </div>

    
    <div id="toc-footer" style="display: none">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#认证">认证</a>
      <ul>
        <li><a href="#client-证书">Client 证书</a></li>
        <li><a href="#basic-auth">Basic Auth</a></li>
        <li><a href="#service-account">Service Account</a></li>
      </ul>
    </li>
    <li><a href="#授权">授权</a></li>
    <li><a href="#rbac实战">RBAC实战</a></li>
    <li><a href="#ref">Ref</a></li>
  </ul>
</nav>
    </div>
    

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fexample.com%2fposts%2fkubernetes-auth-rbac%2f" aria-label="Facebook">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fexample.com%2fposts%2fkubernetes-auth-rbac%2f&text=Kubernetes%20%e8%ae%a4%e8%af%81%e4%b8%8e%e6%8e%88%e6%9d%83" aria-label="Twitter">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fexample.com%2fposts%2fkubernetes-auth-rbac%2f&title=Kubernetes%20%e8%ae%a4%e8%af%81%e4%b8%8e%e6%8e%88%e6%9d%83" aria-label="Linkedin">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fexample.com%2fposts%2fkubernetes-auth-rbac%2f&is_video=false&description=Kubernetes%20%e8%ae%a4%e8%af%81%e4%b8%8e%e6%8e%88%e6%9d%83" aria-label="Pinterest">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Kubernetes%20%e8%ae%a4%e8%af%81%e4%b8%8e%e6%8e%88%e6%9d%83&body=Check out this article: https%3a%2f%2fexample.com%2fposts%2fkubernetes-auth-rbac%2f" aria-label="Email">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fexample.com%2fposts%2fkubernetes-auth-rbac%2f&title=Kubernetes%20%e8%ae%a4%e8%af%81%e4%b8%8e%e6%8e%88%e6%9d%83" aria-label="Pocket">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fexample.com%2fposts%2fkubernetes-auth-rbac%2f&title=Kubernetes%20%e8%ae%a4%e8%af%81%e4%b8%8e%e6%8e%88%e6%9d%83" aria-label="reddit">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fexample.com%2fposts%2fkubernetes-auth-rbac%2f&name=Kubernetes%20%e8%ae%a4%e8%af%81%e4%b8%8e%e6%8e%88%e6%9d%83&description=%e5%af%b9%e4%ba%8e%e4%b8%80%e4%b8%aa%e7%b3%bb%e7%bb%9f%e6%9d%a5%e8%af%b4%ef%bc%8c%e8%ae%a4%e8%af%81%e5%92%8c%e6%8e%88%e6%9d%83%e4%b8%8d%e5%8f%af%e6%88%96%e7%bc%ba%e7%9a%84%e9%83%a8%e5%88%86%ef%bc%8c%e6%9c%80%e5%b8%b8%e8%a7%81%e7%9a%84%e6%96%b9%e5%bc%8f%e8%a6%81%e6%95%b0%e8%b4%a6%e5%8f%b7%e5%af%86%e7%a0%81%ef%bc%8c%e7%ae%a1%e7%90%86%e5%91%98%e5%92%8c%e6%99%ae%e9%80%9a%e7%94%a8%e6%88%b7%e8%bf%99%e7%a7%8d%e8%ae%a4%e8%af%81%e6%96%b9%e5%bc%8f%ef%bc%8c%e4%b9%9f%e5%b0%b1%e6%98%af%e5%b8%b8%e8%af%b4%e7%9a%84ABAC%e3%80%82%e4%bd%86%e6%98%af%e6%af%8f%e6%ac%a1%e4%bf%ae%e6%94%b9%e6%9d%83%e9%99%90%e9%83%bd%e9%9c%80%e8%a6%81%e9%87%8d%e5%90%af%ef%bc%8c%e6%88%96%e8%80%85%e4%bf%ae%e6%94%b9%e8%ae%b0%e5%bd%95%ef%bc%8c%e4%bc%9a%e6%9c%89%e4%ba%9b%e4%b8%8d%e6%96%b9%e4%be%bf%ef%bc%8c%e4%ba%8e%e6%98%af%e5%9f%ba%e4%ba%8e%e8%a7%92%e8%89%b2%e7%9a%84%e8%ae%bf%e9%97%ae%e6%8e%a7%e5%88%b6%26ndash%3bRBAC%e5%b0%b1%e5%87%ba%e7%8e%b0%e4%ba%86%ef%bc%8c%e5%90%8c%e6%97%b6k8s%e5%88%86%e7%a6%bb%e4%ba%86%e8%ae%a4%e8%af%81%ef%bc%8c%e6%8e%88%e6%9d%83%e5%92%8c%e5%87%86%e5%85%a5%e7%9a%84%e8%bf%87%e7%a8%8b%ef%bc%8c%e6%96%b9%e4%be%bf%e7%ac%ac%e4%b8%89%e6%96%b9%e5%bc%80%e5%8f%91%e7%9b%b8%e5%85%b3%e6%8f%92%e4%bb%b6%e3%80%82%0a%e4%b8%8b%e5%9b%be%e5%a4%a7%e8%87%b4%e6%8f%8f%e8%bf%b0%e4%ba%86k8s%e8%ae%a4%e8%af%81%e7%9a%84%e6%b5%81%e7%a8%8b%e5%9b%be%ef%bc%8c%e6%8f%8f%e8%bf%b0%e4%ba%86%e4%b8%80%e4%b8%aa%e8%af%b7%e6%b1%82%e5%9c%a8%e7%bb%8f%e8%bf%87APIServer%e7%9a%84%e6%97%b6%e5%80%99%e9%83%bd%e7%bb%8f%e5%8e%86%e4%ba%86%e5%93%aa%e4%ba%9b%e9%89%b4%e6%9d%83%e7%9a%84%e8%bf%87%e7%a8%8b%e3%80%82%e5%a6%82%e4%b8%8b%e5%9b%be%e6%89%80%e7%a4%ba%ef%bc%9a%e9%9c%80%e8%a6%81%e8%ae%bf%e9%97%aeAPI%e7%9a%84%e6%9c%89%e4%ba%ba%e7%b1%bb%ef%bc%8c%e4%b9%9f%e5%b0%b1%e6%98%afOps%ef%bc%8c%e9%80%9a%e8%bf%87kubectl%e4%bb%a5%e5%8f%8aKubeconfig%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e5%92%8cAPI-Server%e4%ba%a4%e4%ba%92%e3%80%82%e8%bf%98%e6%9c%89%e5%b0%b1%e6%98%afPod%ef%bc%8c%e4%b9%9f%e5%b0%b1%e6%98%af%e5%ba%94%e7%94%a8%ef%bc%8c%e5%af%b9API%e8%b5%84%e6%ba%90%e8%bf%9b%e8%a1%8cCURD%e3%80%82%e7%84%b6%e5%90%8e%e4%be%9d%e6%ac%a1%e7%bb%8f%e8%bf%87%e4%ba%86%e8%ba%ab%e4%bb%bd%e8%ae%a4%e8%af%81%28authentication%29%e3%80%81%e6%8e%88%e6%9d%83%28authorization%29%e5%92%8c%e5%87%86%e5%85%a5%e6%8e%a7%e5%88%b6%ef%bc%88admission%20control%ef%bc%89%e3%80%82%e4%b8%8b%e9%9d%a2%e5%b0%b1%e6%9d%a5%e8%af%a6%e7%bb%86%e4%bb%8b%e7%bb%8d%e4%b8%8b%e8%ae%a4%e8%af%81%e5%92%8c%e6%8e%88%e6%9d%83%0a%e8%ae%a4%e8%af%81%20%20Authentication%ef%bc%9a%e5%8d%b3%e8%ba%ab%e4%bb%bd%e9%aa%8c%e8%af%81%ef%bc%8c%e8%bf%99%e4%b8%aa%e7%8e%af%e8%8a%82%e5%ae%83%e9%9d%a2%e5%af%b9%e7%9a%84%e8%be%93%e5%85%a5%e6%98%af%e6%95%b4%e4%b8%aahttp%20request%ef%bc%8c%e5%ae%83%e8%b4%9f%e8%b4%a3%e5%af%b9%e6%9d%a5%e8%87%aaclient%e7%9a%84%e8%af%b7%e6%b1%82%e8%bf%9b%e8%a1%8c%e8%ba%ab%e4%bb%bd%e6%a0%a1%e9%aa%8c%ef%bc%8c%e6%94%af%e6%8c%81%e7%9a%84%e6%96%b9%e6%b3%95%e5%8c%85%e6%8b%ac%ef%bc%9a%20%20client%e8%af%81%e4%b9%a6%e9%aa%8c%e8%af%81%ef%bc%88https%e5%8f%8c%e5%90%91%e9%aa%8c%e8%af%81%ef%bc%89%20basic%20auth%20%e6%99%ae%e9%80%9atoken%20jwt%20token%28%e7%94%a8%e4%ba%8eserviceaccount%29%20%20%20%20APIServer%e5%90%af%e5%8a%a8%e6%97%b6%ef%bc%8c%e5%8f%af%e4%bb%a5%e6%8c%87%e5%ae%9a%e4%b8%80%e7%a7%8dAuthentication%e6%96%b9%e6%b3%95%ef%bc%8c%e4%b9%9f%e5%8f%af%e4%bb%a5%e6%8c%87%e5%ae%9a%e5%a4%9a%e7%a7%8d%e6%96%b9%e6%b3%95%e3%80%82%e5%a6%82%e6%9e%9c%e6%8c%87%e5%ae%9a%e4%ba%86%e5%a4%9a%e7%a7%8d%e6%96%b9%e6%b3%95%ef%bc%8c%e9%82%a3%e4%b9%88APIServer%e5%b0%86%e4%bc%9a%e9%80%90%e4%b8%aa%e4%bd%bf%e7%94%a8%e8%bf%99%e4%ba%9b%e6%96%b9%e6%b3%95%e5%af%b9%e5%ae%a2%e6%88%b7%e7%ab%af%e8%af%b7%e6%b1%82%e8%bf%9b%e8%a1%8c%e9%aa%8c%e8%af%81%ef%bc%8c%e5%8f%aa%e8%a6%81%e8%af%b7%e6%b1%82%e6%95%b0%e6%8d%ae%e9%80%9a%e8%bf%87%e5%85%b6%e4%b8%ad%e4%b8%80%e7%a7%8d%e6%96%b9%e6%b3%95%e7%9a%84%e9%aa%8c%e8%af%81%ef%bc%8cAPIServer%e5%b0%b1%e4%bc%9a%e8%ae%a4%e4%b8%baAuthentication%e6%88%90%e5%8a%9f%ef%bc%9b%e5%9c%a8%e8%be%83%e6%96%b0%e7%89%88%e6%9c%ackubeadm%e5%bc%95%e5%af%bc%e5%90%af%e5%8a%a8%e7%9a%84k8s%e9%9b%86%e7%be%a4%e7%9a%84apiserver%e5%88%9d%e5%a7%8b%e9%85%8d%e7%bd%ae%e4%b8%ad%ef%bc%8c%e9%bb%98%e8%ae%a4%e6%94%af%e6%8c%81client%e8%af%81%e4%b9%a6%e9%aa%8c%e8%af%81%e5%92%8cserviceaccount%e4%b8%a4%e7%a7%8d%e8%ba%ab%e4%bb%bd%e9%aa%8c%e8%af%81%e6%96%b9%e5%bc%8f%e3%80%82%e5%9c%a8%e8%bf%99%e4%b8%aa%e7%8e%af%e8%8a%82%ef%bc%8capiserver%e4%bc%9a%e9%80%9a%e8%bf%87client%e8%af%81%e4%b9%a6%e6%88%96http%20header%e4%b8%ad%e7%9a%84%e5%ad%97%e6%ae%b5%28%e6%af%94%e5%a6%82serviceaccount%e7%9a%84jwt%20token%29%e6%9d%a5%e8%af%86%e5%88%ab%e5%87%ba%e8%af%b7%e6%b1%82%e7%9a%84%e2%80%9c%e7%94%a8%e6%88%b7%e8%ba%ab%e4%bb%bd%e2%80%9d%ef%bc%8c%e5%8c%85%e6%8b%ac%e2%80%9duser%e2%80%9d%e3%80%81%e2%80%9dgroup%e2%80%9d%e7%ad%89%ef%bc%8c%e8%bf%99%e4%ba%9b%e4%bf%a1%e6%81%af%e5%b0%86%e5%9c%a8%e5%90%8e%e9%9d%a2%e7%9a%84authorization%e7%8e%af%e8%8a%82%e7%94%a8%e5%88%b0%e3%80%82%0aClient%20%e8%af%81%e4%b9%a6%20%e9%a6%96%e5%85%88%e6%88%91%e4%bb%ac%e7%9c%8b%e4%b8%80%e4%b8%8bkubectl%e7%9a%84%e9%bb%98%e8%ae%a4%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6~%2f.kube%2fconfig%0a1apiVersion%3a%20v1%202clusters%3a%203-%20cluster%3a%204%20certificate-authority-data%3a%20REDACTED%205%20server%3a%20https%3a%2f%2f172.16.66.101%3a6443%206%20name%3a%20kubernetes%207contexts%3a%208-%20context%3a%209%20cluster%3a%20kubernetes%2010%20user%3a%20kubernetes-admin%2011%20name%3a%20kubernetes-admin%40kubernetes%2012current-context%3a%20kubernetes-admin%40kubernetes%2013kind%3a%20Config%2014preferences%3a%20%7b%7d%2015users%3a%2016-%20name%3a%20kubernetes-admin%2017%20user%3a%2018%20client-certificate-data%3a%20REDACTED%2019%20client-key-data%3a%20REDACTED%20%e8%bf%99%e6%9c%89%e4%b8%a4%e4%b8%aa%e9%87%8d%e8%a6%81%e7%9a%84%e4%bf%a1%e6%81%af%20client-certificate-data%2c%20client-key-data%2c%e9%a6%96%e5%85%88%e6%8a%8adata%e6%8f%90%e5%8f%96%e5%87%ba%e6%9d%a5" aria-label="Tumblr">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fexample.com%2fposts%2fkubernetes-auth-rbac%2f&t=Kubernetes%20%e8%ae%a4%e8%af%81%e4%b8%8e%e6%8e%88%e6%9d%83" aria-label="Hacker News">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu-toggle" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;" aria-label="Menu">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
        <a id="toc-toggle" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;" aria-label="TOC">
          <i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share-toggle" class="icon" href="#" onclick="$('#share-footer').toggle();return false;" aria-label="Share">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2025  You 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts">Writings</a></li>
         
        <li><a href="/tags">Tags</a></li>
         
        <li><a href="/about">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>

<script src=/js/code-copy.js></script>




</html>
