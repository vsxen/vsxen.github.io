<!DOCTYPE html>
<html lang="en-us">
<head>
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <script type="text/javascript" src="https://latest.cactus.chat/cactus.js"></script>
  <link rel="stylesheet" href="https://latest.cactus.chat/style.css" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> 新式监控系统 — prometheus | Cactus theme example</title>
  <link rel = 'canonical' href = 'https://example.com/posts/promethus/'>
  <meta name="description" content="随便记录点东西">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="新式监控系统 — prometheus" />
<meta property="og:description" content="Prometheus 是一套开源的系统监控报警框架。它启发于 Google 的 borgmon 监控系统，由工作在 SoundCloud 的 google 前员工在 2012 年创建，作为社区开源项目进行开发，并于 2015 年正式发布。2016 年，Prometheus 正式加入 Cloud Native Computing Foundation，成为受欢迎度仅次于 Kubernetes 的项目。
Prometheus简介 作为新一代的监控框架，Prometheus 具有以下特点：
  强大的多维度数据模型：
 时间序列数据通过 metric 名和键值对来区分。 所有的 metrics 都可以设置任意的多维标签。 数据模型更随意，不需要刻意设置为以点分隔的字符串。 可以对数据模型进行聚合，切割和切片操作。 支持双精度浮点类型，标签可以设为全 unicode。    灵活而强大的查询语句（PromQL）：在同一个查询语句，可以对多个 metrics 进行乘法、加法、连接、取分数位等操作。
  易于管理： Prometheus server 是一个单独的二进制文件，可直接在本地工作，不依赖于分布式存储。
  高效：平均每个采样点仅占 3.5 bytes，且一个 Prometheus server 可以处理数百万的 metrics。
  使用 pull 模式采集时间序列数据，这样不仅有利于本机测试而且可以避免有问题的服务器推送坏的 metrics。
  可以采用 push gateway 的方式把时间序列数据推送至 Prometheus server 端。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://example.com/posts/promethus/" />
<meta property="article:published_time" content="2018-09-14T22:31:20+08:00" />
<meta property="article:modified_time" content="2018-09-14T22:31:20+08:00" />

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="新式监控系统 — prometheus"/>
<meta name="twitter:description" content="Prometheus 是一套开源的系统监控报警框架。它启发于 Google 的 borgmon 监控系统，由工作在 SoundCloud 的 google 前员工在 2012 年创建，作为社区开源项目进行开发，并于 2015 年正式发布。2016 年，Prometheus 正式加入 Cloud Native Computing Foundation，成为受欢迎度仅次于 Kubernetes 的项目。
Prometheus简介 作为新一代的监控框架，Prometheus 具有以下特点：
  强大的多维度数据模型：
 时间序列数据通过 metric 名和键值对来区分。 所有的 metrics 都可以设置任意的多维标签。 数据模型更随意，不需要刻意设置为以点分隔的字符串。 可以对数据模型进行聚合，切割和切片操作。 支持双精度浮点类型，标签可以设为全 unicode。    灵活而强大的查询语句（PromQL）：在同一个查询语句，可以对多个 metrics 进行乘法、加法、连接、取分数位等操作。
  易于管理： Prometheus server 是一个单独的二进制文件，可直接在本地工作，不依赖于分布式存储。
  高效：平均每个采样点仅占 3.5 bytes，且一个 Prometheus server 可以处理数百万的 metrics。
  使用 pull 模式采集时间序列数据，这样不仅有利于本机测试而且可以避免有问题的服务器推送坏的 metrics。
  可以采用 push gateway 的方式把时间序列数据推送至 Prometheus server 端。"/>

  
  
    
  
  
  <link rel="stylesheet" href="https://example.com/css/styles.b7d947e05a1170a37e8b82db035a37baf568e98c7fcbe3f9dd31eac5e6a72150f9f731721fa60a1b3eed4c6a9db9c5a706d396767b698198aeea1614f88ce960.css" integrity="sha512-t9lH4FoRcKN&#43;i4LbA1o3uvVo6Yx/y&#43;P53THqxeanIVD59zFyH6YKGz7tTGqducWnBtOWdntpgZiu6hYU&#43;IzpYA=="> 

  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://example.com/images/favicon.ico" />

  
  
  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts">Writings</a></li>
         
        <li><a href="/tags">Tags</a></li>
         
        <li><a href="/about">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li>
          <a class="icon" href=" https://example.com/posts/kubernetes-auth-rbac/" aria-label="Previous">
            <i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i>
          </a>
        </li>
        
        
        <li>
          <a class="icon" href="https://example.com/posts/terraform/" aria-label="Next">
            <i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i>
          </a>
        </li>
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#" aria-label="Share">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fexample.com%2fposts%2fpromethus%2f" aria-label="Facebook">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fexample.com%2fposts%2fpromethus%2f&text=%e6%96%b0%e5%bc%8f%e7%9b%91%e6%8e%a7%e7%b3%bb%e7%bb%9f%20%e2%80%94%20prometheus" aria-label="Twitter">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fexample.com%2fposts%2fpromethus%2f&title=%e6%96%b0%e5%bc%8f%e7%9b%91%e6%8e%a7%e7%b3%bb%e7%bb%9f%20%e2%80%94%20prometheus" aria-label="Linkedin">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fexample.com%2fposts%2fpromethus%2f&is_video=false&description=%e6%96%b0%e5%bc%8f%e7%9b%91%e6%8e%a7%e7%b3%bb%e7%bb%9f%20%e2%80%94%20prometheus" aria-label="Pinterest">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=%e6%96%b0%e5%bc%8f%e7%9b%91%e6%8e%a7%e7%b3%bb%e7%bb%9f%20%e2%80%94%20prometheus&body=Check out this article: https%3a%2f%2fexample.com%2fposts%2fpromethus%2f" aria-label="Email">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fexample.com%2fposts%2fpromethus%2f&title=%e6%96%b0%e5%bc%8f%e7%9b%91%e6%8e%a7%e7%b3%bb%e7%bb%9f%20%e2%80%94%20prometheus" aria-label="Pocket">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fexample.com%2fposts%2fpromethus%2f&title=%e6%96%b0%e5%bc%8f%e7%9b%91%e6%8e%a7%e7%b3%bb%e7%bb%9f%20%e2%80%94%20prometheus" aria-label="reddit">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fexample.com%2fposts%2fpromethus%2f&name=%e6%96%b0%e5%bc%8f%e7%9b%91%e6%8e%a7%e7%b3%bb%e7%bb%9f%20%e2%80%94%20prometheus&description=Prometheus%20%e6%98%af%e4%b8%80%e5%a5%97%e5%bc%80%e6%ba%90%e7%9a%84%e7%b3%bb%e7%bb%9f%e7%9b%91%e6%8e%a7%e6%8a%a5%e8%ad%a6%e6%a1%86%e6%9e%b6%e3%80%82%e5%ae%83%e5%90%af%e5%8f%91%e4%ba%8e%20Google%20%e7%9a%84%20borgmon%20%e7%9b%91%e6%8e%a7%e7%b3%bb%e7%bb%9f%ef%bc%8c%e7%94%b1%e5%b7%a5%e4%bd%9c%e5%9c%a8%20SoundCloud%20%e7%9a%84%20google%20%e5%89%8d%e5%91%98%e5%b7%a5%e5%9c%a8%202012%20%e5%b9%b4%e5%88%9b%e5%bb%ba%ef%bc%8c%e4%bd%9c%e4%b8%ba%e7%a4%be%e5%8c%ba%e5%bc%80%e6%ba%90%e9%a1%b9%e7%9b%ae%e8%bf%9b%e8%a1%8c%e5%bc%80%e5%8f%91%ef%bc%8c%e5%b9%b6%e4%ba%8e%202015%20%e5%b9%b4%e6%ad%a3%e5%bc%8f%e5%8f%91%e5%b8%83%e3%80%822016%20%e5%b9%b4%ef%bc%8cPrometheus%20%e6%ad%a3%e5%bc%8f%e5%8a%a0%e5%85%a5%20Cloud%20Native%20Computing%20Foundation%ef%bc%8c%e6%88%90%e4%b8%ba%e5%8f%97%e6%ac%a2%e8%bf%8e%e5%ba%a6%e4%bb%85%e6%ac%a1%e4%ba%8e%20Kubernetes%20%e7%9a%84%e9%a1%b9%e7%9b%ae%e3%80%82%0aPrometheus%e7%ae%80%e4%bb%8b%20%e4%bd%9c%e4%b8%ba%e6%96%b0%e4%b8%80%e4%bb%a3%e7%9a%84%e7%9b%91%e6%8e%a7%e6%a1%86%e6%9e%b6%ef%bc%8cPrometheus%20%e5%85%b7%e6%9c%89%e4%bb%a5%e4%b8%8b%e7%89%b9%e7%82%b9%ef%bc%9a%0a%20%20%e5%bc%ba%e5%a4%a7%e7%9a%84%e5%a4%9a%e7%bb%b4%e5%ba%a6%e6%95%b0%e6%8d%ae%e6%a8%a1%e5%9e%8b%ef%bc%9a%0a%20%e6%97%b6%e9%97%b4%e5%ba%8f%e5%88%97%e6%95%b0%e6%8d%ae%e9%80%9a%e8%bf%87%20metric%20%e5%90%8d%e5%92%8c%e9%94%ae%e5%80%bc%e5%af%b9%e6%9d%a5%e5%8c%ba%e5%88%86%e3%80%82%20%e6%89%80%e6%9c%89%e7%9a%84%20metrics%20%e9%83%bd%e5%8f%af%e4%bb%a5%e8%ae%be%e7%bd%ae%e4%bb%bb%e6%84%8f%e7%9a%84%e5%a4%9a%e7%bb%b4%e6%a0%87%e7%ad%be%e3%80%82%20%e6%95%b0%e6%8d%ae%e6%a8%a1%e5%9e%8b%e6%9b%b4%e9%9a%8f%e6%84%8f%ef%bc%8c%e4%b8%8d%e9%9c%80%e8%a6%81%e5%88%bb%e6%84%8f%e8%ae%be%e7%bd%ae%e4%b8%ba%e4%bb%a5%e7%82%b9%e5%88%86%e9%9a%94%e7%9a%84%e5%ad%97%e7%ac%a6%e4%b8%b2%e3%80%82%20%e5%8f%af%e4%bb%a5%e5%af%b9%e6%95%b0%e6%8d%ae%e6%a8%a1%e5%9e%8b%e8%bf%9b%e8%a1%8c%e8%81%9a%e5%90%88%ef%bc%8c%e5%88%87%e5%89%b2%e5%92%8c%e5%88%87%e7%89%87%e6%93%8d%e4%bd%9c%e3%80%82%20%e6%94%af%e6%8c%81%e5%8f%8c%e7%b2%be%e5%ba%a6%e6%b5%ae%e7%82%b9%e7%b1%bb%e5%9e%8b%ef%bc%8c%e6%a0%87%e7%ad%be%e5%8f%af%e4%bb%a5%e8%ae%be%e4%b8%ba%e5%85%a8%20unicode%e3%80%82%20%20%20%20%e7%81%b5%e6%b4%bb%e8%80%8c%e5%bc%ba%e5%a4%a7%e7%9a%84%e6%9f%a5%e8%af%a2%e8%af%ad%e5%8f%a5%ef%bc%88PromQL%ef%bc%89%ef%bc%9a%e5%9c%a8%e5%90%8c%e4%b8%80%e4%b8%aa%e6%9f%a5%e8%af%a2%e8%af%ad%e5%8f%a5%ef%bc%8c%e5%8f%af%e4%bb%a5%e5%af%b9%e5%a4%9a%e4%b8%aa%20metrics%20%e8%bf%9b%e8%a1%8c%e4%b9%98%e6%b3%95%e3%80%81%e5%8a%a0%e6%b3%95%e3%80%81%e8%bf%9e%e6%8e%a5%e3%80%81%e5%8f%96%e5%88%86%e6%95%b0%e4%bd%8d%e7%ad%89%e6%93%8d%e4%bd%9c%e3%80%82%0a%20%20%e6%98%93%e4%ba%8e%e7%ae%a1%e7%90%86%ef%bc%9a%20Prometheus%20server%20%e6%98%af%e4%b8%80%e4%b8%aa%e5%8d%95%e7%8b%ac%e7%9a%84%e4%ba%8c%e8%bf%9b%e5%88%b6%e6%96%87%e4%bb%b6%ef%bc%8c%e5%8f%af%e7%9b%b4%e6%8e%a5%e5%9c%a8%e6%9c%ac%e5%9c%b0%e5%b7%a5%e4%bd%9c%ef%bc%8c%e4%b8%8d%e4%be%9d%e8%b5%96%e4%ba%8e%e5%88%86%e5%b8%83%e5%bc%8f%e5%ad%98%e5%82%a8%e3%80%82%0a%20%20%e9%ab%98%e6%95%88%ef%bc%9a%e5%b9%b3%e5%9d%87%e6%af%8f%e4%b8%aa%e9%87%87%e6%a0%b7%e7%82%b9%e4%bb%85%e5%8d%a0%203.5%20bytes%ef%bc%8c%e4%b8%94%e4%b8%80%e4%b8%aa%20Prometheus%20server%20%e5%8f%af%e4%bb%a5%e5%a4%84%e7%90%86%e6%95%b0%e7%99%be%e4%b8%87%e7%9a%84%20metrics%e3%80%82%0a%20%20%e4%bd%bf%e7%94%a8%20pull%20%e6%a8%a1%e5%bc%8f%e9%87%87%e9%9b%86%e6%97%b6%e9%97%b4%e5%ba%8f%e5%88%97%e6%95%b0%e6%8d%ae%ef%bc%8c%e8%bf%99%e6%a0%b7%e4%b8%8d%e4%bb%85%e6%9c%89%e5%88%a9%e4%ba%8e%e6%9c%ac%e6%9c%ba%e6%b5%8b%e8%af%95%e8%80%8c%e4%b8%94%e5%8f%af%e4%bb%a5%e9%81%bf%e5%85%8d%e6%9c%89%e9%97%ae%e9%a2%98%e7%9a%84%e6%9c%8d%e5%8a%a1%e5%99%a8%e6%8e%a8%e9%80%81%e5%9d%8f%e7%9a%84%20metrics%e3%80%82%0a%20%20%e5%8f%af%e4%bb%a5%e9%87%87%e7%94%a8%20push%20gateway%20%e7%9a%84%e6%96%b9%e5%bc%8f%e6%8a%8a%e6%97%b6%e9%97%b4%e5%ba%8f%e5%88%97%e6%95%b0%e6%8d%ae%e6%8e%a8%e9%80%81%e8%87%b3%20Prometheus%20server%20%e7%ab%af%e3%80%82" aria-label="Tumblr">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fexample.com%2fposts%2fpromethus%2f&t=%e6%96%b0%e5%bc%8f%e7%9b%91%e6%8e%a7%e7%b3%bb%e7%bb%9f%20%e2%80%94%20prometheus" aria-label="Hacker News">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    
    <div id="toc">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#prometheus简介">Prometheus简介</a>
      <ul>
        <li><a href="#组成及架构">组成及架构</a></li>
        <li><a href="#prometheus-相关概念">Prometheus 相关概念</a></li>
      </ul>
    </li>
    <li><a href="#prometheus配置">Prometheus配置</a>
      <ul>
        <li>
          <ul>
            <li><a href="#rules规则">rules规则</a></li>
          </ul>
        </li>
        <li><a href="#四种数据类型">四种数据类型</a></li>
        <li><a href="#promql">Promql</a>
          <ul>
            <li><a href="#二元操作">二元操作</a></li>
            <li><a href="#聚合操作">聚合操作</a></li>
            <li><a href="#函数">函数</a></li>
          </ul>
        </li>
        <li><a href="#常用例子">常用例子:</a></li>
      </ul>
    </li>
    <li><a href="#alertmanager配置">AlertManager配置</a></li>
    <li><a href="#ref">Ref</a></li>
  </ul>
</nav>
    </div>
    
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        新式监控系统 — prometheus
      </h1>
      <div class="meta">
        
        <div class="postdate">
          
          <time datetime="2018-09-14 22:31:20 &#43;0800 CST" itemprop="datePublished">2018-09-14</time>
          
        </div>
        
        
        <div class="article-read-time">
          <i class="far fa-clock"></i>
          
          19 minute read
        </div>
        
        
        
        <div class="article-tag">
            <i class="fas fa-tag"></i>
            
            
            <a class="tag-link" href="/tags/monitor" rel="tag">monitor</a>
            
        </div>
        
      </div>
    </header>

  
    
    <div class="content" itemprop="articleBody">
      <p>Prometheus 是一套开源的系统监控报警框架。它启发于 Google 的 borgmon 监控系统，由工作在 SoundCloud 的 google 前员工在 2012 年创建，作为社区开源项目进行开发，并于 2015 年正式发布。2016 年，Prometheus 正式加入 Cloud Native Computing Foundation，成为受欢迎度仅次于 Kubernetes 的项目。</p>
<h2 id="prometheus简介">Prometheus简介</h2>
<p>作为新一代的监控框架，Prometheus 具有以下特点：</p>
<ul>
<li>
<p>强大的多维度数据模型：</p>
<ol>
<li>时间序列数据通过 metric 名和键值对来区分。</li>
<li>所有的 metrics 都可以设置任意的多维标签。</li>
<li>数据模型更随意，不需要刻意设置为以点分隔的字符串。</li>
<li>可以对数据模型进行聚合，切割和切片操作。</li>
<li>支持双精度浮点类型，标签可以设为全 unicode。</li>
</ol>
</li>
<li>
<p>灵活而强大的查询语句（PromQL）：在同一个查询语句，可以对多个 metrics 进行乘法、加法、连接、取分数位等操作。</p>
</li>
<li>
<p>易于管理： Prometheus server 是一个单独的二进制文件，可直接在本地工作，不依赖于分布式存储。</p>
</li>
<li>
<p>高效：平均每个采样点仅占 3.5 bytes，且一个 Prometheus server 可以处理数百万的 metrics。</p>
</li>
<li>
<p>使用 pull 模式采集时间序列数据，这样不仅有利于本机测试而且可以避免有问题的服务器推送坏的 metrics。</p>
</li>
<li>
<p>可以采用 push gateway 的方式把时间序列数据推送至 Prometheus server 端。</p>
</li>
<li>
<p>可以通过服务发现或者静态配置去获取监控的 targets。</p>
</li>
<li>
<p>有多种可视化图形界面。</p>
</li>
<li>
<p>易于伸缩。</p>
</li>
</ul>
<p>需要指出的是，由于数据采集可能会有丢失，所以 Prometheus 不适用对采集数据要 100% 准确的情形。但如果用于记录时间序列数据，Prometheus 具有很大的查询优势，此外，Prometheus 适用于微服务的体系架构。这样做非常适合虚拟化环境比如 VM 或者 Docker ，故其为为数不多的适合 Docker、Mesos 、Kubernetes 环境的监控系统之一，被很多人称为下一代监控系统。</p>
<p><strong>pull 方式</strong></p>
<p>Prometheus 采集数据用的是 pull 也就是拉模型,通过 HTTP 协议去采集指标，只要应用系统能够提供 HTTP 接口就可以接入监控系统，相比于私有协议或二进制协议来说开发简单。</p>
<p><strong>push 方式</strong></p>
<p>对于定时任务这种短周期的指标采集，如果采用 pull 模式，可能造成任务结束了 Prometheus 还没有来得及采集的情况，这个时候可以使用加一个中转层，客户端推数据到 Push Gateway 缓存一下，由 Prometheus 从 push gateway pull 指标过来。</p>
<h3 id="组成及架构">组成及架构</h3>
<p>Prometheus 生态圈中包含了多个组件，其中许多组件是可选的：</p>
<ul>
<li><strong>Prometheus Server</strong>: 用于收集和存储时间序列数据。</li>
<li><strong>Client Library</strong>: 客户端库，为需要监控的服务生成相应的 metrics 并暴露给 Prometheus server。当 Prometheus server 来 pull 时，直接返回实时状态的 metrics。</li>
<li><strong>Push Gateway</strong>: 主要用于短期的 jobs。由于这类 jobs 存在时间较短，可能在 Prometheus 来 pull 之前就消失了。为此，这次 jobs 可以直接向 Prometheus server 端推送它们的 metrics。这种方式主要用于服务层面的 metrics，对于机器层面的 metrices，需要使用 node exporter。</li>
<li><strong>Exporters</strong>: 用于暴露已有的第三方服务的 metrics 给 Prometheus。</li>
<li><strong>Alertmanager</strong>: 从 Prometheus server 端接收到 alerts 后，会进行去除重复数据，分组，并路由到对收的接受方式，发出报警。常见的接收方式有：电子邮件，pagerduty，OpsGenie, webhook 等。</li>
<li>一些其他的工具。</li>
</ul>
<p>图 1 为 Prometheus 官方文档中的架构图：</p>
<p><img src="./images/prometueus.png" alt=""></p>
<p>从上图可以看出，Prometheus 的主要模块包括：Prometheus server, exporters, Pushgateway, PromQL, Alertmanager 以及图形界面。</p>
<p>其大概的工作流程是：</p>
<ol>
<li>Prometheus server 定期从配置好的 jobs 或者 exporters 中拉 metrics，或者接收来自 Pushgateway 发过来的 metrics，或者从其他的 Prometheus server 中拉 metrics。</li>
<li>Prometheus server 在本地存储收集到的 metrics，并运行已定义好的 alert.rules，记录新的时间序列或者向 Alertmanager 推送警报。</li>
<li>Alertmanager 根据配置文件，对接收到的警报进行处理，发出告警。</li>
<li>在图形界面中，可视化采集数据。</li>
</ol>
<h3 id="prometheus-相关概念">Prometheus 相关概念</h3>
<p>下面将对 Prometheus 中的数据模型，metric 类型以及 instance 和 job 等概念进行介绍，以便读者在 Prometheus 的配置和使用中可以有一个更好的理解。</p>
<p><strong>数据模型</strong></p>
<p>Prometheus 中存储的数据为时间序列，是由 metric 的名字和一系列的标签（键值对）唯一标识的，不同的标签则代表不同的时间序列。</p>
<ul>
<li>metric 名字：该名字应该具有语义，一般用于表示 metric 的功能，例如：http_requests_total, 表示 http 请求的总数。其中，metric 名字由 ASCII 字符，数字，下划线，以及冒号组成。</li>
<li>标签：使同一个时间序列有了不同维度的识别。例如 http_requests_total{method=&ldquo;Get&rdquo;} 表示所有 http 请求中的 Get 请求。当 method=&ldquo;post&rdquo; 时，则为新的一个 metric。标签中的键由 ASCII 字符，数字，以及下划线组成。</li>
<li>样本：实际的时间序列，每个序列包括一个 float64 的值和一个毫秒级的时间戳。</li>
<li>格式：<!-- raw HTML omitted -->{<!-- raw HTML omitted -->=<!-- raw HTML omitted -->, …}，例如：http_requests_total{method=&ldquo;POST&rdquo;,endpoint=&quot;/api/tracks&quot;}。</li>
</ul>
<p><strong>四种 Metric 类型</strong></p>
<p>Prometheus 客户端库主要提供四种主要的 metric 类型：</p>
<p><strong>Counter</strong> 计数器</p>
<ul>
<li>一种累加的 metric，典型的应用如：请求的个数，结束的任务数， 出现的错误数等等。</li>
</ul>
<p>例如，查询 http_requests_total{method=&ldquo;get&rdquo;, job=&ldquo;Prometheus&rdquo;, handler=&ldquo;query&rdquo;} 返回 8，10 秒后，再次查询，则返回 14。</p>
<p><strong>Gauge</strong> 瞬时值</p>
<ul>
<li>一种常规的 metric，典型的应用如：温度，运行的 goroutines 的个数。</li>
<li>可以任意加减。</li>
</ul>
<p>例如：go_goroutines{instance=&ldquo;172.17.0.2&rdquo;, job=&ldquo;Prometheus&rdquo;} 返回值 147，表示有147个goroutine</p>
<p><strong>Histogram</strong> 直方图</p>
<p>这种主要用来统计百分位的，什么是百分位？英文叫做quantiles。比如你有100条访问请求的耗时时间，把它们从小到大排序，第90个时间是200ms，那么我们可以说90%的请求都小于200ms，这也叫做”90分位是200ms”，能够反映出服务的基本质量。当然，也许第91个时间是2000ms，这就没法说了。实际情况是，我们每天访问量至少几个亿，不可能把所有访问数据都存起来，然后排序找到90分位的时间是多少。因此，类似这种问题都采用了一些估算的算法来处理，不需要把所有数据都存下来，这里面数学原理比较高端，我们就直接看看prometheus的用法好了。</p>
<ul>
<li>可以理解为柱状图，典型的应用如：请求持续时间，响应大小。</li>
<li>可以对观察结果采样，分组及统计。</li>
</ul>
<p><strong>Summary</strong></p>
<ul>
<li>类似于 Histogram, 典型的应用如：请求持续时间，响应大小。</li>
<li>提供观测值的 count 和 sum 功能。</li>
<li>提供百分位的功能，即可以按百分比划分跟踪结果。</li>
</ul>
<p>比如go_gc_duration_seconds可以得到go gc 25%，50%，75%的持续时间</p>
<p>summary已经完成了计算，由prom的服务端完成，如下所示：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#6272a4"># HELP prometheus_engine_query_duration_seconds Query timings</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#6272a4"># TYPE prometheus_engine_query_duration_seconds summary</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>prometheus_engine_query_duration_seconds<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">slice</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;inner_eval&#34;</span>,quantile<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;0.5&#34;</span><span style="color:#ff79c6">}</span> 0.000300242
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>prometheus_engine_query_duration_seconds<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">slice</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;inner_eval&#34;</span>,quantile<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;0.9&#34;</span><span style="color:#ff79c6">}</span> 0.016269568
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>prometheus_engine_query_duration_seconds<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">slice</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;inner_eval&#34;</span>,quantile<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;0.99&#34;</span><span style="color:#ff79c6">}</span> 0.027198073
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>prometheus_engine_query_duration_seconds_sum<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">slice</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;inner_eval&#34;</span><span style="color:#ff79c6">}</span> 0.080493713
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>prometheus_engine_query_duration_seconds_count<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">slice</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;inner_eval&#34;</span><span style="color:#ff79c6">}</span> <span style="color:#bd93f9">21</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>prometheus_engine_query_duration_seconds<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">slice</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;prepare_time&#34;</span>,quantile<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;0.5&#34;</span><span style="color:#ff79c6">}</span> 7.2256e-05
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>prometheus_engine_query_duration_seconds<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">slice</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;prepare_time&#34;</span>,quantile<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;0.9&#34;</span><span style="color:#ff79c6">}</span> 0.000894565
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>prometheus_engine_query_duration_seconds<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">slice</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;prepare_time&#34;</span>,quantile<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;0.99&#34;</span><span style="color:#ff79c6">}</span> 0.001640657
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>prometheus_engine_query_duration_seconds_sum<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">slice</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;prepare_time&#34;</span><span style="color:#ff79c6">}</span> 0.004723942
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>prometheus_engine_query_duration_seconds_count<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">slice</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;prepare_time&#34;</span><span style="color:#ff79c6">}</span> <span style="color:#bd93f9">21</span>
</code></pre></div><p>与summary不同的是histogram只负责存储数据，客户端读取之后进行计算。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#6272a4"># HELP prometheus_http_request_duration_seconds Histogram of latencies for HTTP requests.</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#6272a4"># TYPE prometheus_http_request_duration_seconds histogram</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>prometheus_http_request_duration_seconds_bucket<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">handler</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/api/v1/query&#34;</span>,le<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;0.1&#34;</span><span style="color:#ff79c6">}</span> <span style="color:#bd93f9">0</span>  <span style="color:#6272a4"># 小于0.1的有0个</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>prometheus_http_request_duration_seconds_bucket<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">handler</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/api/v1/query&#34;</span>,le<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;0.2&#34;</span><span style="color:#ff79c6">}</span> <span style="color:#bd93f9">11</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>prometheus_http_request_duration_seconds_bucket<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">handler</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/api/v1/query&#34;</span>,le<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;0.4&#34;</span><span style="color:#ff79c6">}</span> <span style="color:#bd93f9">11</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>prometheus_http_request_duration_seconds_bucket<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">handler</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/api/v1/query&#34;</span>,le<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;1&#34;</span><span style="color:#ff79c6">}</span> <span style="color:#bd93f9">11</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>prometheus_http_request_duration_seconds_bucket<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">handler</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/api/v1/query&#34;</span>,le<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;3&#34;</span><span style="color:#ff79c6">}</span> <span style="color:#bd93f9">11</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>prometheus_http_request_duration_seconds_bucket<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">handler</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/api/v1/query&#34;</span>,le<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;8&#34;</span><span style="color:#ff79c6">}</span> <span style="color:#bd93f9">11</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>prometheus_http_request_duration_seconds_bucket<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">handler</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/api/v1/query&#34;</span>,le<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;20&#34;</span><span style="color:#ff79c6">}</span> <span style="color:#bd93f9">11</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>prometheus_http_request_duration_seconds_bucket<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">handler</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/api/v1/query&#34;</span>,le<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;60&#34;</span><span style="color:#ff79c6">}</span> <span style="color:#bd93f9">11</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>prometheus_http_request_duration_seconds_bucket<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">handler</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/api/v1/query&#34;</span>,le<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;120&#34;</span><span style="color:#ff79c6">}</span> <span style="color:#bd93f9">11</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>prometheus_http_request_duration_seconds_bucket<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">handler</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/api/v1/query&#34;</span>,le<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;+Inf&#34;</span><span style="color:#ff79c6">}</span> <span style="color:#bd93f9">11</span> <span style="color:#6272a4"># 无穷大的时候近似等于请求总数</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>prometheus_http_request_duration_seconds_sum<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">handler</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/api/v1/query&#34;</span><span style="color:#ff79c6">}</span> 0.033323976000000005
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>prometheus_http_request_duration_seconds_count<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">handler</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/api/v1/query&#34;</span><span style="color:#ff79c6">}</span> <span style="color:#bd93f9">11</span> <span style="color:#6272a4"># 一共有11个请求</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>histogram_quantile<span style="color:#ff79c6">(</span>0.95, sum<span style="color:#ff79c6">(</span>rate<span style="color:#ff79c6">(</span>prometheus_http_request_duration_seconds_bucket<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">handler</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/api/v1/query_range&#34;</span><span style="color:#ff79c6">}[</span>5m<span style="color:#ff79c6">]))</span> by <span style="color:#ff79c6">(</span>le<span style="color:#ff79c6">))</span>
</code></pre></div><h2 id="prometheus配置">Prometheus配置</h2>
<p>配置文件可以分为6个部分，如下所示：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#6272a4"># 全局配置</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#ff79c6">global</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>  <span style="color:#ff79c6">scrape_interval</span>:     15s <span style="color:#6272a4"># 默认抓取间隔, 15秒向目标抓取一次数据。</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>  <span style="color:#ff79c6">evaluation_interval</span>: 15s <span style="color:#6272a4"># Evaluate rules every 15 seconds. The default is every 1 minute.</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>  <span style="color:#6272a4"># scrape_timeout is set to the global default (10s).</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>  <span style="color:#6272a4"># 这个标签是在本机上每一条时间序列上都会默认产生的，主要可以用于联合查询、远程存储、Alertmanger时使用。</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>  <span style="color:#ff79c6">external_labels</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>      <span style="color:#ff79c6">monitor</span>: <span style="color:#f1fa8c">&#39;codelab-monitor&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>      <span style="color:#ff79c6">cluster</span>:  <span style="color:#f1fa8c">&#39;prod-k8s&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span style="color:#6272a4"># 加载ruls文件</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span style="color:#ff79c6">rule_files</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>  <span style="color:#6272a4"># - &#34;first.rules&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>  <span style="color:#6272a4"># - &#34;second.rules&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span style="color:#6272a4"># 这里就表示抓取对象的配置</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span style="color:#6272a4"># 这里是抓去promethues自身的配置</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span style="color:#ff79c6">scrape_configs</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span style="color:#6272a4"># job name 这个配置是表示在这个配置内的时间序例，每一条都会自动添加上这个{job_name:&#34;prometheus&#34;}的标签。</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>  - <span style="color:#ff79c6">job_name</span>: <span style="color:#f1fa8c">&#39;prometheus&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>    <span style="color:#6272a4"># metrics_path defaults to &#39;/metrics&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span>    <span style="color:#6272a4"># scheme defaults to &#39;http&#39;.</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span>    <span style="color:#6272a4"># 重写了全局抓取间隔时间，由15秒重写成5秒。</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span>    <span style="color:#ff79c6">scrape_interval</span>: 5s
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span>    <span style="color:#ff79c6">static_configs</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span>      - <span style="color:#ff79c6">targets</span>: [<span style="color:#f1fa8c">&#39;localhost:9090&#39;</span>]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span><span style="color:#6272a4"># 与Alertmanager相关的设置。</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span><span style="color:#ff79c6">alerting</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span>  <span style="color:#ff79c6">alert_relabel_configs</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span>    [ - &lt;relabel_config&gt; ... ]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span>  <span style="color:#ff79c6">alertmanagers</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36</span>    [ - &lt;alertmanager_config&gt; ... ]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38</span><span style="color:#6272a4"># 将数据写到远程</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39</span><span style="color:#ff79c6">remote_write</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40</span>  [ - &lt;remote_write&gt; ... ]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42</span><span style="color:#6272a4"># 读取远程的数据</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43</span><span style="color:#ff79c6">remote_read</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44</span>  [ - &lt;remote_read&gt; ... ]      
</code></pre></div><p>scrape_configs 主要用于配置拉取数据节点，每一个拉取配置主要包含以下参数：</p>
<ul>
<li>job_name：任务名称</li>
<li>honor_labels： 用于解决拉取数据标签有冲突，当设置为 true, 以拉取数据为准，否则以服务配置为准</li>
<li>params：数据拉取访问时带的请求参数</li>
<li>scrape_interval： 拉取时间间隔</li>
<li>scrape_timeout: 拉取超时时间</li>
<li>metrics_path： 拉取节点的 metric 路径</li>
<li>scheme： 拉取数据访问协议</li>
<li>sample_limit： 存储的数据标签个数限制，如果超过限制，该数据将被忽略，不入存储；默认值为0，表示没有限制</li>
<li>relabel_configs： 拉取数据重置标签配置</li>
<li>metric_relabel_configs：metric 重置标签配置</li>
</ul>
<h4 id="rules规则">rules规则</h4>
<p>当某些metrics不正常时，就需要发出告警，而rules正是做这个事情的，比如CPU连续1小时超过99%等。如下是一个request响应时间过高的rule：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#ff79c6">groups</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>- <span style="color:#ff79c6">name</span>: example
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>  <span style="color:#ff79c6">rules</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>  - <span style="color:#ff79c6">alert</span>: HighErrorRate
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>    <span style="color:#ff79c6">expr</span>: job:request_latency_seconds:mean5m{job=&#34;myjob&#34;} &gt; 0.5
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>    <span style="color:#ff79c6">for</span>: 10m
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>    <span style="color:#ff79c6">labels</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>      <span style="color:#ff79c6">severity</span>: page
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>    <span style="color:#ff79c6">annotations</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>      <span style="color:#ff79c6">summary</span>: High request latency
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>      <span style="color:#ff79c6">description</span>: description info
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>  - <span style="color:#ff79c6">alert</span>: ExampleAlert
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>    <span style="color:#ff79c6">expr</span>: vector(1)
</code></pre></div><h3 id="四种数据类型">四种数据类型</h3>
<ol>
<li>Instant vector : 每个指标返回一个值,且指标集合里面的时间戳都相同.类似于即时数据.</li>
<li>Range vector: 每个指标包含多个时序数据.</li>
<li>Scalar: 只有一个浮点值</li>
<li>String: 未开放使用.</li>
</ol>
<h3 id="promql">Promql</h3>
<h4 id="二元操作">二元操作</h4>
<p>+ - * / % ^ 加减乘除 取余</p>
<p>二元操作符使用范围:</p>
<ol>
<li>scalar/scalar</li>
<li>vector/scalar</li>
<li>vector/vector</li>
</ol>
<h4 id="聚合操作">聚合操作</h4>
<ol>
<li>sum (calculate sum over dimensions)</li>
<li>min (select minimum over dimensions)</li>
<li>max (select maximum over dimensions)</li>
<li>avg (calculate the average over dimensions)</li>
<li>stddev (calculate population standard deviation over dimensions)</li>
<li>stdvar (calculate population standard variance over dimensions)</li>
<li>count (count number of elements in the vector)</li>
<li>count_values (count number of elements with the same value)</li>
<li>bottomk (smallest k elements by sample value)</li>
<li>topk (largest k elements by sample value)</li>
<li>quantile (calculate φ-quantile (0 ≤ φ ≤ 1) over dimensions)</li>
</ol>
<h4 id="函数">函数</h4>
<ol>
<li>
<p>rate(v range-vector)</p>
<p>根据每个点计算每秒的平均变化率.</p>
</li>
<li>
<p>irate(v range-vector)</p>
<p>根据最后两个数据点计算变化率.irate()适合于变化较快的数据,rate()适合变化较慢的数据.</p>
</li>
</ol>
<h3 id="常用例子">常用例子:</h3>
<p>查询CPU使用率:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span style="color:#bd93f9">100</span> - <span style="color:#ff79c6">(</span>avg by <span style="color:#ff79c6">(</span>job<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">(</span>irate<span style="color:#ff79c6">(</span>node_cpu<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">mode</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;idle&#34;</span><span style="color:#ff79c6">}[</span>5m<span style="color:#ff79c6">]))</span> * 100<span style="color:#ff79c6">)</span>
</code></pre></div><p>查询网卡即时速率</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>irate<span style="color:#ff79c6">(</span>node_network_receive_bytes<span style="color:#ff79c6">[</span>2m<span style="color:#ff79c6">])</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span>vector<span style="color:#ff79c6">(</span>1<span style="color:#ff79c6">)</span>  <span style="color:#6272a4">#始终为真，可以用来测试告警</span>
</code></pre></div><h2 id="alertmanager配置">AlertManager配置</h2>
<p>Prometheus只会产生告警并把告警发送给AlertManager，至于什么等级的告警发送给谁，还是要在AlertManager中配置的。目前官方支持slack，企业微信和Email，钉钉可以用这个webhook的容器实现。</p>
<p>docker run &ndash;network host -d timonwong/prometheus-webhook-dingtalk &ndash;ding.profile=&ldquo;webhook1=https://oapi.dingtalk.com/robot/send?access_token=xxxx&rdquo;</p>
<p>配置文件示例：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#ff79c6">global</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>  <span style="color:#6272a4"># ResolveTimeout is the time after which an alert is declared resolved</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>  <span style="color:#6272a4"># if it has not been updated.</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>  <span style="color:#ff79c6">[ resolve_timeout</span>: &lt;duration&gt; | default = 5m ]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>  <span style="color:#6272a4"># The default HTTP client configuration</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>  <span style="color:#ff79c6">[ http_config</span>: &lt;http_config&gt; ]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span style="color:#6272a4"># Files from which custom notification template definitions are read.</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span style="color:#6272a4"># The last component may use a wildcard matcher, e.g. &#39;templates/*.tmpl&#39;.</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span style="color:#ff79c6">templates</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>  [ - &lt;filepath&gt; ... ]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span style="color:#6272a4"># The root node of the routing tree.</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span style="color:#ff79c6">route</span>: &lt;route&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>  <span style="color:#ff79c6">routes</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>  - <span style="color:#ff79c6">receiver</span>: <span style="color:#f1fa8c">&#39;database-pager&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>    <span style="color:#ff79c6">group_wait</span>: 10s
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>    <span style="color:#ff79c6">match_re</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span>      <span style="color:#ff79c6">service</span>: mysql|cassandra
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>  - <span style="color:#ff79c6">receiver</span>: <span style="color:#f1fa8c">&#39;frontend-pager&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>    <span style="color:#ff79c6">group_by</span>: [product, environment]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>    <span style="color:#ff79c6">match</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span>      <span style="color:#ff79c6">team</span>: frontend
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span><span style="color:#6272a4"># A list of notification receivers.</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span><span style="color:#ff79c6">receivers</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span>  - &lt;receiver&gt; ...
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span><span style="color:#6272a4"># A list of inhibition rules.</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span><span style="color:#ff79c6">inhibit_rules</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span>  [ - &lt;inhibit_rule&gt; ... ]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span>--- <span style="color:#6272a4">#具体示例</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span><span style="color:#ff79c6">global</span>: 
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span>  <span style="color:#ff79c6">&#34;resolve_timeout&#34;: </span><span style="color:#f1fa8c">&#34;5m&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span><span style="color:#ff79c6">route</span>: 
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36</span>  <span style="color:#ff79c6">group_by</span>: [<span style="color:#f1fa8c">&#39;job&#39;</span>]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37</span>  <span style="color:#ff79c6">group_wait</span>: 30s
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38</span>  <span style="color:#ff79c6">group_interval</span>: 5m
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39</span>  <span style="color:#ff79c6">repeat_interval</span>: 12h
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40</span>  <span style="color:#ff79c6">receiver</span>: <span style="color:#f1fa8c">&#39;slack_general&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41</span>  <span style="color:#ff79c6">routes</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42</span>  - <span style="color:#ff79c6">receiver</span>: <span style="color:#f1fa8c">&#34;slack_general&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43</span>    <span style="color:#ff79c6">match</span>:  
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44</span>      <span style="color:#ff79c6">alertname</span>: DeadMansSwitch
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45</span>  - <span style="color:#ff79c6">receiver</span>: <span style="color:#f1fa8c">&#34;send_to_dingding_webhook1&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46</span>    <span style="color:#ff79c6">match</span>:  
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47</span>      <span style="color:#ff79c6">severity</span>: warning
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48</span><span style="color:#ff79c6">receivers</span>: 
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49</span>- <span style="color:#ff79c6">name</span>: slack_general
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50</span>  <span style="color:#ff79c6">slack_configs</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51</span>  - <span style="color:#ff79c6">api_url</span>: https://hooks.slack.com/services/TCXP8SPD4/BCW9QDP8T/
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52</span>    <span style="color:#ff79c6">channel</span>: <span style="color:#f1fa8c">&#39;#general&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53</span>- <span style="color:#ff79c6">name</span>: send_to_dingding_webhook1
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54</span>  <span style="color:#ff79c6">webhook_configs</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55</span>  - <span style="color:#ff79c6">send_resolved</span>: <span style="color:#ff79c6">false</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56</span>    <span style="color:#ff79c6">url</span>: http://localhost:8060/dingtalk/webhook1/send
</code></pre></div><h2 id="ref">Ref</h2>
<p>Prometheus 入门</p>
<p><a href="https://www.hi-linux.com/posts/25047.html">https://www.hi-linux.com/posts/25047.html</a></p>
<p>Prometheus 实战</p>
<p><a href="https://songjiayang.gitbooks.io/prometheus/content/">https://songjiayang.gitbooks.io/prometheus/content/</a></p>
<p><a href="https://yunlzheng.gitbook.io/prometheus-book/part-iii-prometheus-shi-zhan/references">https://yunlzheng.gitbook.io/prometheus-book/part-iii-prometheus-shi-zhan/references</a></p>

    </div>
  </article>

  
  






  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/posts">Writings</a></li>
         
          <li><a href="/tags">Tags</a></li>
         
          <li><a href="/about">About</a></li>
        
      </ul>
    </div>

    
    <div id="toc-footer" style="display: none">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#prometheus简介">Prometheus简介</a>
      <ul>
        <li><a href="#组成及架构">组成及架构</a></li>
        <li><a href="#prometheus-相关概念">Prometheus 相关概念</a></li>
      </ul>
    </li>
    <li><a href="#prometheus配置">Prometheus配置</a>
      <ul>
        <li>
          <ul>
            <li><a href="#rules规则">rules规则</a></li>
          </ul>
        </li>
        <li><a href="#四种数据类型">四种数据类型</a></li>
        <li><a href="#promql">Promql</a>
          <ul>
            <li><a href="#二元操作">二元操作</a></li>
            <li><a href="#聚合操作">聚合操作</a></li>
            <li><a href="#函数">函数</a></li>
          </ul>
        </li>
        <li><a href="#常用例子">常用例子:</a></li>
      </ul>
    </li>
    <li><a href="#alertmanager配置">AlertManager配置</a></li>
    <li><a href="#ref">Ref</a></li>
  </ul>
</nav>
    </div>
    

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fexample.com%2fposts%2fpromethus%2f" aria-label="Facebook">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fexample.com%2fposts%2fpromethus%2f&text=%e6%96%b0%e5%bc%8f%e7%9b%91%e6%8e%a7%e7%b3%bb%e7%bb%9f%20%e2%80%94%20prometheus" aria-label="Twitter">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fexample.com%2fposts%2fpromethus%2f&title=%e6%96%b0%e5%bc%8f%e7%9b%91%e6%8e%a7%e7%b3%bb%e7%bb%9f%20%e2%80%94%20prometheus" aria-label="Linkedin">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fexample.com%2fposts%2fpromethus%2f&is_video=false&description=%e6%96%b0%e5%bc%8f%e7%9b%91%e6%8e%a7%e7%b3%bb%e7%bb%9f%20%e2%80%94%20prometheus" aria-label="Pinterest">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=%e6%96%b0%e5%bc%8f%e7%9b%91%e6%8e%a7%e7%b3%bb%e7%bb%9f%20%e2%80%94%20prometheus&body=Check out this article: https%3a%2f%2fexample.com%2fposts%2fpromethus%2f" aria-label="Email">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fexample.com%2fposts%2fpromethus%2f&title=%e6%96%b0%e5%bc%8f%e7%9b%91%e6%8e%a7%e7%b3%bb%e7%bb%9f%20%e2%80%94%20prometheus" aria-label="Pocket">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fexample.com%2fposts%2fpromethus%2f&title=%e6%96%b0%e5%bc%8f%e7%9b%91%e6%8e%a7%e7%b3%bb%e7%bb%9f%20%e2%80%94%20prometheus" aria-label="reddit">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fexample.com%2fposts%2fpromethus%2f&name=%e6%96%b0%e5%bc%8f%e7%9b%91%e6%8e%a7%e7%b3%bb%e7%bb%9f%20%e2%80%94%20prometheus&description=Prometheus%20%e6%98%af%e4%b8%80%e5%a5%97%e5%bc%80%e6%ba%90%e7%9a%84%e7%b3%bb%e7%bb%9f%e7%9b%91%e6%8e%a7%e6%8a%a5%e8%ad%a6%e6%a1%86%e6%9e%b6%e3%80%82%e5%ae%83%e5%90%af%e5%8f%91%e4%ba%8e%20Google%20%e7%9a%84%20borgmon%20%e7%9b%91%e6%8e%a7%e7%b3%bb%e7%bb%9f%ef%bc%8c%e7%94%b1%e5%b7%a5%e4%bd%9c%e5%9c%a8%20SoundCloud%20%e7%9a%84%20google%20%e5%89%8d%e5%91%98%e5%b7%a5%e5%9c%a8%202012%20%e5%b9%b4%e5%88%9b%e5%bb%ba%ef%bc%8c%e4%bd%9c%e4%b8%ba%e7%a4%be%e5%8c%ba%e5%bc%80%e6%ba%90%e9%a1%b9%e7%9b%ae%e8%bf%9b%e8%a1%8c%e5%bc%80%e5%8f%91%ef%bc%8c%e5%b9%b6%e4%ba%8e%202015%20%e5%b9%b4%e6%ad%a3%e5%bc%8f%e5%8f%91%e5%b8%83%e3%80%822016%20%e5%b9%b4%ef%bc%8cPrometheus%20%e6%ad%a3%e5%bc%8f%e5%8a%a0%e5%85%a5%20Cloud%20Native%20Computing%20Foundation%ef%bc%8c%e6%88%90%e4%b8%ba%e5%8f%97%e6%ac%a2%e8%bf%8e%e5%ba%a6%e4%bb%85%e6%ac%a1%e4%ba%8e%20Kubernetes%20%e7%9a%84%e9%a1%b9%e7%9b%ae%e3%80%82%0aPrometheus%e7%ae%80%e4%bb%8b%20%e4%bd%9c%e4%b8%ba%e6%96%b0%e4%b8%80%e4%bb%a3%e7%9a%84%e7%9b%91%e6%8e%a7%e6%a1%86%e6%9e%b6%ef%bc%8cPrometheus%20%e5%85%b7%e6%9c%89%e4%bb%a5%e4%b8%8b%e7%89%b9%e7%82%b9%ef%bc%9a%0a%20%20%e5%bc%ba%e5%a4%a7%e7%9a%84%e5%a4%9a%e7%bb%b4%e5%ba%a6%e6%95%b0%e6%8d%ae%e6%a8%a1%e5%9e%8b%ef%bc%9a%0a%20%e6%97%b6%e9%97%b4%e5%ba%8f%e5%88%97%e6%95%b0%e6%8d%ae%e9%80%9a%e8%bf%87%20metric%20%e5%90%8d%e5%92%8c%e9%94%ae%e5%80%bc%e5%af%b9%e6%9d%a5%e5%8c%ba%e5%88%86%e3%80%82%20%e6%89%80%e6%9c%89%e7%9a%84%20metrics%20%e9%83%bd%e5%8f%af%e4%bb%a5%e8%ae%be%e7%bd%ae%e4%bb%bb%e6%84%8f%e7%9a%84%e5%a4%9a%e7%bb%b4%e6%a0%87%e7%ad%be%e3%80%82%20%e6%95%b0%e6%8d%ae%e6%a8%a1%e5%9e%8b%e6%9b%b4%e9%9a%8f%e6%84%8f%ef%bc%8c%e4%b8%8d%e9%9c%80%e8%a6%81%e5%88%bb%e6%84%8f%e8%ae%be%e7%bd%ae%e4%b8%ba%e4%bb%a5%e7%82%b9%e5%88%86%e9%9a%94%e7%9a%84%e5%ad%97%e7%ac%a6%e4%b8%b2%e3%80%82%20%e5%8f%af%e4%bb%a5%e5%af%b9%e6%95%b0%e6%8d%ae%e6%a8%a1%e5%9e%8b%e8%bf%9b%e8%a1%8c%e8%81%9a%e5%90%88%ef%bc%8c%e5%88%87%e5%89%b2%e5%92%8c%e5%88%87%e7%89%87%e6%93%8d%e4%bd%9c%e3%80%82%20%e6%94%af%e6%8c%81%e5%8f%8c%e7%b2%be%e5%ba%a6%e6%b5%ae%e7%82%b9%e7%b1%bb%e5%9e%8b%ef%bc%8c%e6%a0%87%e7%ad%be%e5%8f%af%e4%bb%a5%e8%ae%be%e4%b8%ba%e5%85%a8%20unicode%e3%80%82%20%20%20%20%e7%81%b5%e6%b4%bb%e8%80%8c%e5%bc%ba%e5%a4%a7%e7%9a%84%e6%9f%a5%e8%af%a2%e8%af%ad%e5%8f%a5%ef%bc%88PromQL%ef%bc%89%ef%bc%9a%e5%9c%a8%e5%90%8c%e4%b8%80%e4%b8%aa%e6%9f%a5%e8%af%a2%e8%af%ad%e5%8f%a5%ef%bc%8c%e5%8f%af%e4%bb%a5%e5%af%b9%e5%a4%9a%e4%b8%aa%20metrics%20%e8%bf%9b%e8%a1%8c%e4%b9%98%e6%b3%95%e3%80%81%e5%8a%a0%e6%b3%95%e3%80%81%e8%bf%9e%e6%8e%a5%e3%80%81%e5%8f%96%e5%88%86%e6%95%b0%e4%bd%8d%e7%ad%89%e6%93%8d%e4%bd%9c%e3%80%82%0a%20%20%e6%98%93%e4%ba%8e%e7%ae%a1%e7%90%86%ef%bc%9a%20Prometheus%20server%20%e6%98%af%e4%b8%80%e4%b8%aa%e5%8d%95%e7%8b%ac%e7%9a%84%e4%ba%8c%e8%bf%9b%e5%88%b6%e6%96%87%e4%bb%b6%ef%bc%8c%e5%8f%af%e7%9b%b4%e6%8e%a5%e5%9c%a8%e6%9c%ac%e5%9c%b0%e5%b7%a5%e4%bd%9c%ef%bc%8c%e4%b8%8d%e4%be%9d%e8%b5%96%e4%ba%8e%e5%88%86%e5%b8%83%e5%bc%8f%e5%ad%98%e5%82%a8%e3%80%82%0a%20%20%e9%ab%98%e6%95%88%ef%bc%9a%e5%b9%b3%e5%9d%87%e6%af%8f%e4%b8%aa%e9%87%87%e6%a0%b7%e7%82%b9%e4%bb%85%e5%8d%a0%203.5%20bytes%ef%bc%8c%e4%b8%94%e4%b8%80%e4%b8%aa%20Prometheus%20server%20%e5%8f%af%e4%bb%a5%e5%a4%84%e7%90%86%e6%95%b0%e7%99%be%e4%b8%87%e7%9a%84%20metrics%e3%80%82%0a%20%20%e4%bd%bf%e7%94%a8%20pull%20%e6%a8%a1%e5%bc%8f%e9%87%87%e9%9b%86%e6%97%b6%e9%97%b4%e5%ba%8f%e5%88%97%e6%95%b0%e6%8d%ae%ef%bc%8c%e8%bf%99%e6%a0%b7%e4%b8%8d%e4%bb%85%e6%9c%89%e5%88%a9%e4%ba%8e%e6%9c%ac%e6%9c%ba%e6%b5%8b%e8%af%95%e8%80%8c%e4%b8%94%e5%8f%af%e4%bb%a5%e9%81%bf%e5%85%8d%e6%9c%89%e9%97%ae%e9%a2%98%e7%9a%84%e6%9c%8d%e5%8a%a1%e5%99%a8%e6%8e%a8%e9%80%81%e5%9d%8f%e7%9a%84%20metrics%e3%80%82%0a%20%20%e5%8f%af%e4%bb%a5%e9%87%87%e7%94%a8%20push%20gateway%20%e7%9a%84%e6%96%b9%e5%bc%8f%e6%8a%8a%e6%97%b6%e9%97%b4%e5%ba%8f%e5%88%97%e6%95%b0%e6%8d%ae%e6%8e%a8%e9%80%81%e8%87%b3%20Prometheus%20server%20%e7%ab%af%e3%80%82" aria-label="Tumblr">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fexample.com%2fposts%2fpromethus%2f&t=%e6%96%b0%e5%bc%8f%e7%9b%91%e6%8e%a7%e7%b3%bb%e7%bb%9f%20%e2%80%94%20prometheus" aria-label="Hacker News">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu-toggle" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;" aria-label="Menu">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
        <a id="toc-toggle" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;" aria-label="TOC">
          <i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share-toggle" class="icon" href="#" onclick="$('#share-footer').toggle();return false;" aria-label="Share">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2025  You 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts">Writings</a></li>
         
        <li><a href="/tags">Tags</a></li>
         
        <li><a href="/about">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>

<script src=/js/code-copy.js></script>




</html>
