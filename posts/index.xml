<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Posts on Cactus theme example</title>
    <link>https://example.com/posts/</link>
    <description>Recent content in Posts on Cactus theme example</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>You</copyright>
    <lastBuildDate>Sun, 06 Mar 2022 18:34:11 +0800</lastBuildDate><atom:link href="https://example.com/posts/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>2021</title>
      <link>https://example.com/posts/2021/</link>
      <pubDate>Sun, 06 Mar 2022 18:34:11 +0800</pubDate>
      
      <guid>https://example.com/posts/2021/</guid>
      <description>â€‹	å…ˆè¯´ä¸‹CISï¼ˆContainer Ingress Servicesï¼‰å§ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ª(https://github.com/F5Networks/k8s-bigip-ctlr) ï¼Œç›®çš„æ˜¯ä¸ºé›†ç¾¤å†…çš„å››å±‚ä¸šåŠ¡æä¾›è´Ÿè½½å‡è¡¡ï¼Œé¡¹ç›®çš„åˆè¡·æ˜¯ä¸ºå®¹å™¨å†…çš„redisæä¾›è®¿é—®å…¥å£ï¼Œæ¯•ç«Ÿpodçš„IPä¼šå˜ï¼Œä¹‹å‰æ˜¯ç”¨Nginx ingressçš„å››å±‚streamåšåå‘ä»£ç†ï¼Œé‚£å°±è¦æ”¹configmapã€‚ï¼ˆè¿™é‡Œæ’ä¸€ä¸‹redisåœ¨é›†ç¾¤çš„æ¨¡å¼æ˜¯å¯ä»¥ç”±ä¸€ä¸ªå…¥å£è¿›æ¥ï¼Œç„¶åæŠŠæµé‡è½¬åˆ° key æ‰€åœ¨çš„ slot æ‰€åœ¨çš„rediså®ä¾‹ï¼Œä¹Ÿå°±æ˜¯redisèŠ‚ç‚¹å¯ä»¥æ„ŸçŸ¥é›†ç¾¤çš„å…¶ä»–èŠ‚ç‚¹ã€‚å¯¹äºetcdï¼Ÿï¼‰ç”±äºå„ç§åŸå› å¼€å§‹æµ‹è¯•è¿™ä¸ªCISï¼Œç½‘ç»œé‚£è¾¹è¿˜ä¸ºæ­¤é…ç½®äº† ECMP ï¼ˆhttps://en.wikipedia.org/wiki/Equal-cost_multi-path_routingï¼‰ï¼ŒåŒæ—¶ ECMP é™åˆ¶ä¸‹ä¸€è·³èŠ‚ç‚¹æœ€å¤šæ˜¯16ä¸ªï¼Œæˆ‘ä»¬è¿˜ä¸ºæ­¤æå‡ºäº†Groupåˆ°Namespaceä¸€å¯¹å¤šçš„è§„åˆ’ï¼Œæ¯ä¸ªGroupè®¡åˆ’æµé‡å¤§æ¦‚40Gå§ğŸ˜„ã€‚å…ˆè¯´ä¸‹è¿™ä¸ªCISçš„å¥‡è‘©ä¹‹å¤„å§ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“æ ¹æ®Ingressçš„è®¾è®¡ï¼Œæœ€ä¸»è¦çš„æ˜¯è¦æ‰¾åˆ°Ingresså¯¹åº”çš„Serviceåå­—ï¼ˆåå­—åœ¨namespaceçº§åˆ«æ˜¯å”¯ä¸€çš„ï¼‰ï¼Œæ ¹æ®åå­—æ¥å®ç°å¯¹åº”å…³ç³»ã€‚ä½†æ˜¯CISç¡®æ˜¯æ ¹æ®Serviceçš„labelæ¥å…³è¿çš„ï¼Œè€Œä¸”CISçš„å¯¹åº”å…³ç³»æ˜¯å†™åœ¨configmapé‡Œé¢ï¼Œä¸æ”¯æŒå¤šä¸ªconfigmapï¼Œä¹Ÿå°±æ˜¯å¤šä¸ªæ•°ç»„æ¥è¡¨ç¤ºä¸åŒçš„è´Ÿè½½å‡è¡¡ã€‚è¿™é‡Œåªæ˜¯ç”¨ingressä½œä¸ºç¤ºä¾‹ï¼Œè¡¨ç¤ºæˆ‘ä¸æ˜¯å¾ˆèµåŒè¿™ä¸ªå…³ç³»æ˜ å°„æ–¹å¼ï¼Œå› ä¸ºä½ ä¸€ä¸ªè´Ÿè½½å‡è¡¡çš„åªéœ€è¦çŸ¥é“Serviceåå­—ï¼Œè¿›è€ŒæŸ¥å‡ºæ¥bankend IPå°±å¥½äº†ï¼Œä¸åº”è¯¥åœ¨Serviceä¸Šé¢åšäº‹æƒ…ã€‚
1# ingress ç‰ˆ  2apiVersion: extensions/v1beta1 3kind: Ingress 4metadata: 5 name: app 6spec: 7 rules: 8 - host: vsxen.github.io 9 http: 10 paths: 11 - backend: 12 serviceName: nginx 13 servicePort: 80 14--- 15# CISç‰ˆ 16apiVersion: v1 17kind: Service 18metadata: 19 labels: 20 cis-app: &amp;#34;app&amp;#34; 21 cis-port: &amp;#34;443&amp;#34; 22 name: app 23spec: 24 ports: 25 - name: https 26 port: 443 27 protocol: TCP 28 targetPort: 6443 â€‹	å½“ç„¶å¯¹åº”ç§æœ‰äº‘çš„ç¯å¢ƒï¼Œä¹Ÿæœ‰ https://github.</description>
    </item>
    
    <item>
      <title>å¦‚ä½•ä¸ºCentOS7å‡çº§4.xå†…æ ¸</title>
      <link>https://example.com/posts/uprade-kernel/</link>
      <pubDate>Sun, 07 Mar 2021 09:10:53 +0800</pubDate>
      
      <guid>https://example.com/posts/uprade-kernel/</guid>
      <description>é»˜è®¤çš„CentOS 7 ä½¿ç”¨çš„æ˜¯ 3.xç‰ˆæœ¬çš„å†…æ ¸ï¼Œæ¯”å¦‚ 7.3ä½¿ç”¨çš„æ˜¯3.10.0-957.5.1.el7.x86_64ï¼Œå¤§ç‰ˆæœ¬å·ä¹Ÿå°±æ˜¯3.10.0ï¼Œåé¢çš„957ä¹Ÿå°±æ˜¯ä¸æ–­çš„ç»´æŠ¤çš„å°ç‰ˆæœ¬ï¼Œå¦‚æœä½ ä¸å‡çº§çš„è¯ï¼Œä»…ä»…æ˜¯updateçš„è¯ï¼Œåªä¼šå¢åŠ æœ€åçš„å°ç‰ˆæœ¬å·ã€‚ä½†æ˜¯å½“æˆ‘ä»¬æƒ³ä½¿ç”¨é«˜ç‰ˆæœ¬å†…æ ¸æ‰æ”¯æŒçš„ç‰¹æ€§çš„æ—¶å€™ï¼Œå°±éœ€è¦å‡çº§ã€‚æ‰“å¼€https://www.kernel.org/ ä½ ä¼šå‘ç°æœ‰ä¸‹é¢å‡ ä¸ªç‰ˆæœ¬ï¼šé‚£æ€ä¹ˆæ‰èƒ½æ‰¾åˆ°éœ€è¦çš„ç‰ˆæœ¬çš„åŒ…å‘¢ï¼Ÿ
   mainline: 5.13-rc1 2021-05-09     stable: 5.12.4 2021-05-14   stable: 5.11.21 2021-05-14   longterm: 5.10.37 2021-05-14   longterm: 5.4.119 2021-05-14   longterm: 4.19.190 2021-05-07   longterm: 4.14.232 2021-04-28   longterm: 4.9.268 2021-04-28   longterm: 4.4.268 2021-04-28   linux-next: next-20210514 2021-05-14    é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸‹æœ€å°åŒ–ç³»ç»Ÿé»˜è®¤å®‰è£…äº†å“ªäº›kernelç›¸å…³çš„åŒ…ï¼š
1# rpm -qa |grep kernel 2kernel-3.10.0-957.5.1.el7.x86_64 3kernel-tools-3.10.0-957.5.1.el7.x86_64 4kernel-headers-3.</description>
    </item>
    
    <item>
      <title>2020</title>
      <link>https://example.com/posts/2020/</link>
      <pubDate>Sun, 27 Dec 2020 18:48:15 +0800</pubDate>
      
      <guid>https://example.com/posts/2020/</guid>
      <description>å—¯ï¼Œ2020å¹´å°±è¦è¿‡å»äº†ï¼Œè·ç¦»æˆ‘ä¸Šæ¬¡å†™åšå®¢å±…ç„¶éƒ½æœ‰åŠå¹´äº†ï¼Œæœç„¶æ˜¯å¿™äº†å¾ˆå¤šï¼Œäº¦æˆ–æ˜¯è‡ªå·±åœ¨æ‰¾å€Ÿå£ï¼Ÿï¼Œæˆ‘å‘¢ä¹Ÿåªæƒ³å†™ä¸€ä¸‹æœ‰æ·±åº¦çš„ä¸œè¥¿ï¼Œåˆéœ€è¦æ›´å¤šçš„æ—¶é—´ã€‚
æƒ¯ä¾‹å…ˆè®°ä¸€ä¸‹æµæ°´è´¦ï¼Œ2æœˆä¸€ç›´éƒ½åœ¨å®¶é‡Œï¼Œæ¯”è¾ƒå·®çš„ä¿¡å·åŠ ä¸Šè‡ªèº«çš„è‡ªåˆ¶åŠ›ä¹Ÿä¸å¼ºï¼Œå…¶å®èŠ±åœ¨å·¥ä½œçš„æ—¶é—´ä¸é•¿ã€‚å¤§æ¦‚03ä¸Šæ—¬çš„æ—¶å€™å»çš„å…¬å¸å§ï¼Œç„¶åå°±å¼€å§‹å±…å®¶éš”ç¦»ï¼ˆç¬‘ã€‚4æœˆçš„æ—¶å€™å¼€å¯äº†æ‹›è˜æ—ºå­£ï¼Œæˆ‘ä¹Ÿé¢äº†å‡ ä¸ªï¼Œä¹Ÿç®—æ˜¯æˆ‘åšçš„æ¯”è¾ƒåæ‚”çš„åœ°æ–¹ï¼Œä¸è¦æ‹›ä¸€ä¸ªæŠ€æœ¯ä¸è¡Œè€Œä¸”æ— æ³•æ²Ÿé€šçš„äººã€‚äº”ä¸€çš„æ—¶å€™ä¹Ÿæ²¡å›å»ï¼Œå°±åœ¨é™„è¿‘è½¬äº†ä¸€åœˆï¼Œæ‰‹æœºä¹Ÿåœ¨é‚£ä¸ªæ—¶å€™è¿›æ°´äº†ï¼ŒåŸæ¥ç°ä»£æŠ€æœ¯åœ¨æ°´ç«é¢å‰ä¸å€¼ä¸€æï¼Œå¦å¤–å¤§å®¶å¦‚æœæ˜¯è¿›æ°´æœºå™¨ä¸€èˆ¬éƒ½å¯ä»¥æ”¾å¼ƒäº†ï¼Œä¿®å¥½ä¹‹åä¹Ÿå¯èƒ½æœ‰æš—ç—…ï¼Œå½“ç„¶ä¹Ÿå–å†³äºå¸ˆå‚…çš„æ‰‹è‰ºã€‚6æœˆçš„æ—¶å€™æ¬å®¶ï¼Œç»ˆäºæˆ‘åˆè¾¾åˆ°äº†æ­¥è¡Œä¸Šç­çš„æ°´å¹³ï¼Œéšä¹‹åˆ°æ¥çš„æ˜¯æˆ¿ç§Ÿå¢é•¿ã€‚æ¥ä¸‹æ¥å°±é‡ç‚¹è®²è®²åšè¿‡çš„ä¸œè¥¿å§ï¼š
é¦–å…ˆæ˜¯vGPUç›¸å…³çš„ï¼Œä¸ºäº†æ›´å¥½çš„æ€§èƒ½ï¼Œæˆ‘ä»¬æ‰¾äº†å‡ å—ç½‘å¡æ­å»ºRDMAçš„ç¯å¢ƒï¼Œç”¨çš„åº”è¯¥æ˜¯è¿™å—å¡ï¼Œhttps://www.mellanox.com/products/ethernet-adapters/connectx-4-en ï¼Œå½“ç„¶ä¸æ˜¯åŸå‚çš„ï¼Œé—®é¢˜å°±å‡ºåœ¨è¿™ä¸ªOEMç‰ˆæœ¬çš„è®¾å¤‡ä¸Šï¼Œæˆ‘ä¸€ç›´åœ¨ç”¨å®˜æ–¹çš„é©±åŠ¨ï¼Œå› ä¸ºæˆ‘å¯¹è¿™ä¸€å—ä¹Ÿä¸æ˜¯å¾ˆç†Ÿï¼Œåˆ°ç°åœ¨ä¹Ÿä¸èƒ½å‡†å¤‡çš„è§£é‡Šä»€ä¹ˆæ˜¯ROCEä»¥åŠçº¯IBç½‘ï¼Œæ›´å‘çš„ä»£ç åœ¨è°ƒç”¨ç½‘å¡çš„æ—¶å€™å†™æ­»äº†ä¸€éƒ¨åˆ†å‚æ•°ï¼Œå¯¼è‡´åœ¨å®¿ä¸»ä¸Šç”¨ibwriteå’Œibreadéƒ½æ˜¯æˆåŠŸçš„ï¼Œä½†æ˜¯åœ¨å®¹å™¨ä¸­ä¸€ç›´å¤±è´¥ï¼ŒæŠ¥ibv_create_qp failed to create a queue pair (qp)çš„é”™è¯¯ï¼Œæœ€åç”šè‡³æ€€ç–‘åˆ°äº†æ“ä½œç³»ç»Ÿä¸Šï¼ˆè€Œä¸”æˆ‘ä»¬éƒ½å‡çº§äº†å†…æ ¸ï¼‰ï¼Œç„¶ååœ¨githubä¸Šé¢æ‰¾äº†ä¸€ä¸ªç¤ºä¾‹çœ‹èƒ½ä¸èƒ½è·‘èµ·æ¥ https://github.com/jcxue/RDMA-Tutorialï¼Œå½“ç„¶ä¹Ÿéœ€è¦ä¿®æ”¹ä¸€éƒ¨åˆ†ï¼Œæœ€åç»ˆäºå‘ç°æ˜¯å†™æ­»è®¾å¤‡å·çš„é—®é¢˜ã€‚é‚®ä»¶åˆ—è¡¨ä¹Ÿç¿»è¿‡ https://www.spinics.net/lists/linux-rdma/msg81222.html ã€‚
æ¥ç€æ˜¯harborï¼Œåœ¨é•œåƒå­˜å‚¨è¿™ä¸€å—ï¼Œå…¶å®é€‰æ‹©è¿™ä¸€ä¸ª&amp;hellip;å®˜æ–¹çš„registryåªæœ‰cliï¼Œquayå¼€æºçš„æ—¶å€™å¤ªæ™šï¼Œè€Œä¸”å®‰è£…ä¹Ÿæœ‰äº›å¤æ‚ï¼Ÿharboråœ¨å¯è§‚æµ‹æ€§ä¸ŠçœŸæ˜¯è¾£é¸¡ï¼Œé¦–å…ˆé•œåƒåŒæ­¥æ²¡æœ‰è¿›åº¦æ¡ï¼Œå¦‚æœé‡åˆ°ä¸€ä¸ªç‰¹åˆ«å¤§çš„é¡¹ç›®ï¼Œæˆ–è€…ç‰¹åˆ«å¤šçš„tagï¼Œé‚£ä½ å°±è‡ªæ±‚å¤šç¦å§ã€‚å½“ä½ æƒ³çœ‹çœ‹è°ç”¨äº†ç©ºé—´æœ€å¤šï¼Œè²Œä¼¼æ²¡æœ‰ï¼Œè™½ç„¶ç°åœ¨å¯ä»¥è®¾ç½®å­˜å‚¨é…ç½®ã€‚å®˜æ–¹çš„registryè™½ç„¶æä¾›äº†metricsï¼Œä½†æ˜¯harboré»˜è®¤æ²¡æœ‰æš´éœ²å‡ºæ¥ï¼Œè¿™é‡Œä¹Ÿæœ‰æºç¨‹å¤§ä½¬çš„æ–‡ç« å¯ä»¥å‚è€ƒä¸€ä¸‹http://arthurchiao.art/blog/monitoring-hub/ ã€‚UIæ›´æ˜¯å¯æ€•ï¼Œç¿»é¡µç¿»åˆ°æ‰‹é…¸ã€‚2.xä¹‹å‰çš„ç‰ˆæœ¬æ²¡æœ‰åœ¨çº¿GCï¼Œè¿™å°±æ„å‘³ç€ä½ è¦æ¸…ç†é•œåƒçš„æ—¶å€™å¿…é¡»å…ˆåœæ‰ï¼ï¼ï¼https://github.com/c4po/harbor_exporter
ç´§æ¥ç€æˆ‘ä»¬å°±æµ‹è¯•äº†Calicoçš„é›†ç¾¤ï¼Œå’Œå®˜æ–¹æ–‡æ¡£ä¸Šé¢ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†å¤–éƒ¨çš„gobgpä½œä¸ºRRèŠ‚ç‚¹ä¸é›†ç¾¤è¿æ¥ã€‚è¯´ä¸€ä¸‹é‡åˆ°çš„é—®é¢˜çš„å§ï¼Œé¦–å…ˆcalicoå¹¶ä¸æ”¯æŒå›ºå®šIPï¼Œcalicoä»…å¯ä»¥åˆ†é…ä¸€ä¸ªIPç»™workloadï¼Œå½“ä½ åœ¨æ»šåŠ¨æ›´æ–°ã€å¤šå‰¯æœ¬çš„æ—¶å€™å°±å‡ ä¹ä¸èƒ½ç”¨äº†ï¼Œè¿™é‡Œä¹Ÿæœ‰åˆ†æ https://www.ichenfu.com/2019/09/21/calico-ip-allocation-problems/ï¼Œå…¶æ¬¡æ˜¯IPPoolä¸èƒ½æ‰©å……ï¼ŒIP Blockçš„ç”Ÿå‘½å‘¨æœŸå’ŒèŠ‚ç‚¹å…¶å®æ˜¯å¼ºç›¸å…³çš„ï¼Œè¿™è¾¹æ–‡ç« ä¹Ÿæœ‰åˆ†æï¼Œæœ€åä»–ä»¬æ˜¯ç”¨äº†ä¸€ä¸ªCRDå®Œæˆäº†ippoolçš„æ‰©å…… https://mp.weixin.qq.com/s/FF8c7g8iOTX-e-efrSo5dAã€‚https://shimo.im/docs/tXck8cGKxKWKctp8
ç„¶åæ˜¯ciliumçš„ç½‘ç»œæ–¹æ¡ˆï¼Œè¿™ä¸ªå°±å±äºå¾ˆç¡¬æ ¸çš„ï¼Œå¯¹å†…æ ¸è¦æ±‚å†4.Xï¼Œä¸€äº›ç‰¹æ€§è¿˜è¦å†4.18ä»¥ä¸Šï¼Œåœ¨1.6ä¹‹åçš„ç‰ˆæœ¬æä¾›äº†ç½‘ç»œæµçš„å¯è§†åŒ–æ”¯æŒï¼Œæœ‰ç©ºå†ç»†è®²ã€‚
å®‰å…¨ç›¸å…³ï¼Œk8så®˜æ–¹æä¾›äº†pspè¿™ä¸ªå¯¹è±¡æ¥é™åˆ¶ç”¨æˆ·å®¹å™¨çš„ä¸€äº›è¡Œä¸ºï¼Œç¦æ­¢æŒ‚è½½hostpathã€selinuxã€capabilitiesç­‰ï¼Œä¸»è¦æ˜¯å½“ä½ åœ¨å®¹å™¨é‡Œé¢ä½¿ç”¨rootç”¨æˆ·æŒ‚è½½ä¸Šå®¿ä¸»æœºçš„æ–‡ä»¶ä¹‹åï¼Œä½ ä¼šå‘ç°å¯ä»¥ä½¿ç”¨rm -rf äº†ï¼Œè¿™å°±éœ€è¦CIæµç¨‹çš„é…åˆäº†ã€‚é™¤æ­¤ä¹‹å¤–sysdigå¼€æºäº†falco https://falco.org/ï¼Œé‡‡ç”¨å†…æ ¸æ¨¡å—åŠ ebpfçš„æ–¹å¼ï¼ŒåŠ ä¸Šè‡ªå®šä¹‰è§„åˆ™ï¼Œå¯ä»¥æ§åˆ¶å®¹å™¨çš„è¡Œä¸ºï¼Œæ‰€ä»¥å’Œpspçš„åŠŸèƒ½æœ‰é‡å¤ã€‚
é™¤äº†è¿›ç¨‹çš„ä¸€äº›é™åˆ¶ä¹‹å¤–ï¼Œèµ„æºçš„é™åˆ¶ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ï¼Œå°¤å…¶æ˜¯ç£ç›˜å’Œå†…å­˜ï¼Œå½“ç„¶è¿™äº›éƒ½å¯ä»¥é€šè¿‡requestå’Œlimitæ¥è®¾ç½®ï¼Œå¯¹å®¹å™¨ç£ç›˜çš„é™åˆ¶ä¸»è¦æ˜¯é’ˆå¯¹å¯å†™å±‚ä»¥åŠæŒ‚è½½è¿™ä¸¤ç§ï¼Œè¿™ä¸ªkubeletå’ŒCRIé…åˆã€‚é™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¸€ä¸‹ç­–ç•¥ç›¸å…³çš„å®‰å…¨ï¼Œæ¯”å¦‚ä¸è®¾ç½®limitä¸è®©éƒ¨ç½²ï¼Œè¿™å°±è¦ç”¨åˆ°OPAäº†ï¼ˆåŒç±»ä¸­ä¸ªäººè§‰å¾—æ¯”è¾ƒå®Œå–„ï¼‰ï¼Œå¯ä»¥æŠŠè§„åˆ™ä½œä¸ºCRDæ¥ä½¿ç”¨ã€‚
æ¥ç€æˆ‘ä»¬å‡çº§äº†é›†ç¾¤ï¼Œä»1.14å‡çº§åˆ°1.16ï¼Œç„¶åjenkinsæ’ä»¶å°±å‡ºäº†é—®é¢˜ï¼Œhttps://github.com/fabric8io/kubernetes-client/pull/1669ï¼Œæ˜¯å°‘äº†ä¸€ä¸ªhttp headerï¼Œæœ€å¥½æŠŠé›†ç¾¤çš„eventéƒ½æ•´åˆåˆ°äº†ä¸€èµ·ï¼Œå¹¶ç”¨kibanaç”»äº†ä¸€ä¸ªdashboardã€‚</description>
    </item>
    
    <item>
      <title>è‡ªå·±åŠ¨æ‰‹å®ç°ä¸€ä¸ªkubectl exec</title>
      <link>https://example.com/posts/kubectl-exec/</link>
      <pubDate>Sat, 20 Jun 2020 12:44:22 +0800</pubDate>
      
      <guid>https://example.com/posts/kubectl-exec/</guid>
      <description>åœ¨æ—¥å¸¸å·¥ä½œä¸­kubectl exec å¯ä»¥è¯´æ˜¯éå¸¸é«˜é¢‘ä½¿ç”¨çš„ï¼Œå¦‚æœä½ æƒ³è‡ªå·±äº†è§£ç›¸å…³åŸç†ï¼Œä¸å¦¨è‡ªå·±åŠ¨æ‰‹å†™ä¸€ä¸ªã€‚
çŸ¥è¯†å‚¨å¤‡ï¼š
  websocket é˜®ä¸€å³°è¿™ç¯‡ã€ŠWebSocket æ•™ç¨‹- é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—ã€‹å†™çš„æ¯”è¾ƒè¯¦è¿›ã€‚
  kubectl exec åŸç†
https://itnext.io/how-it-works-kubectl-exec-e31325daa910
https://erkanerol.github.io/post/how-kubectl-exec-works/
å¦‚æœä½ è‹±æ–‡é˜…è¯»èƒ½è¿˜å¯ä»¥ï¼Œè¿™ä¸¤ç¯‡æ–‡ç« ä»åŸç†æ–¹é¢ä»‹ç»äº†execæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚
  äº†è§£äº†ä»¥ä¸ŠçŸ¥è¯†ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¼€å§‹åŠ¨æ‰‹å§ã€‚
é¦–å…ˆæ¥åˆå§‹åŒ–ä¸€ä¸‹é¡¹ç›®ï¼Œè¿™é‡Œä½¿ç”¨go modä½œä¸ºä¾èµ–ç®¡ç†å·¥å…·ã€‚k8sçš„client-goå¯¹æœºå™¨ç‰ˆæœ¬æ˜¯æœ‰è¦æ±‚çš„ï¼Œæ‰€ä»¥åœ¨åˆå§‹åŒ–çš„æ—¶å€™æœ€å¥½å»å®˜æ–¹é‚£è¾¹æ‰¾ä¸€ä¸‹å¯ç”¨çš„ç‰ˆæœ¬ã€‚å¦‚æœé‡åˆ°mod/k8s.io/client-go@v10.0.0+incompatible/kubernetes/scheme/register.go:22:2: unknown import path &amp;quot;k8s.io/api/admissionregistration /v1alpha1&amp;quot;: cannot find module providing package k8s.io/api/admissionregistration/v1alpha1
è¿™ç§æŠ¥é”™ï¼Œå¯ä»¥å°è¯•å¼ºåˆ¶æŒ‡å®šç‰ˆæœ¬ï¼Œè¿™ä¸ªä¹Ÿæ˜¯ä»kubebuilderé‚£é‡Œå­¦åˆ°çš„ã€‚
1go mod init k8sdemo 2 3module k8sdemo 4 5go 1.13 6 7require ( 8 github.com/gorilla/websocket v1.4.2 9 golang.org/x/crypto v0.0.0-20190820162420-60c769a6c586 10 k8s.io/api v0.17.2 11 k8s.io/apimachinery v0.17.2 12 k8s.io/client-go v0.17.2 13) client-goçš„exampleç›®å½•ä¹Ÿæœ‰ç›¸å…³å¯¹è±¡çš„CURDç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆä»è¿™é‡Œå…¥æ‰‹ï¼Œå…ˆç†Ÿæ‚‰ç›¸å…³æ“ä½œï¼Œå¯ä»¥çœ‹åˆ°é¦–å…ˆä»kuebconfigè¯»å–é…ç½®ï¼Œç„¶ååˆå§‹åŒ–å„ç§clientçš„ä¸€ä¸ªé›†åˆï¼Œæœ€ååˆ›å»ºäº†ä¸€ä¸ªdeploymentå®ä¾‹ã€‚
1	config, err := clientcmd.BuildConfigFromFlags(&amp;#34;&amp;#34;, *kubeconfig) 2	if err !</description>
    </item>
    
    <item>
      <title>ä»Natåˆ°TCP_TW</title>
      <link>https://example.com/posts/tcp_nat/</link>
      <pubDate>Tue, 25 Feb 2020 09:04:20 +0800</pubDate>
      
      <guid>https://example.com/posts/tcp_nat/</guid>
      <description>çœ‹åˆ°è¿™ä¸ªæ ‡é¢˜ï¼Œä½ å¯èƒ½ä¼šæ„Ÿåˆ°ç–‘æƒ‘è¿™ä¸¤ä¸ªæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿä¸€ä¸ªæ˜¯IPè½¬æ¢ä¸€ä¸ªæ˜¯TCPï¼Œä¼¼ä¹å…³ç³»ä¸å¤§ï¼Ÿæ¥ä¸‹æ¥å¬æˆ‘æ…¢æ…¢ä»‹ç»ã€‚
NAT åœ¨IPV4çš„æ—¶ä»£ï¼ŒIPå¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼Œå…¬ç½‘å’Œå±€åŸŸç½‘ã€‚å½“ä½ åœ¨å±€åŸŸç½‘æ—¶æƒ³è¦è®¿é—®å¤–é¢çš„å†…å®¹å°±è¦ç»è¿‡Natï¼Œå³ç½‘ç»œåœ°å€è½¬æ¢ä¹Ÿå°±æ˜¯æŠŠå±€åŸŸç½‘çš„IPè½¬æ¢ä¸ºå…¬ç½‘ï¼Œå‘é€å’Œæ¥æ”¶è¯·æ±‚ã€‚å…¶ä¸­
 SNat åŸåœ°å€è½¬æ¢ Source natï¼Œä¹Ÿå°±æ˜¯åœ¨å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„è·¯ç”±å™¨æŠŠç±»ä¼¼192.168.1.2è½¬æ¢ä¸ºæˆ‘ä»¬æ‹¨å·ä¸Šç½‘çš„å…¬ç½‘IPï¼Œ DNatä¹Ÿå°±æ˜¯ç›®çš„åœ°å€è½¬æ¢ï¼Œä¹Ÿå°±æ˜¯åœ¨æ”¶åˆ°æ¥æ”¶åˆ°è¯·æ±‚çš„æ—¶å€™ï¼ŒæŠŠä¸Šé¢çš„å…¬ç½‘IPè½¬æ¢ä¸º192.168.1.2çš„å±€åŸŸç½‘IPã€‚  ä¹Ÿå°±æ˜¯è¯´å…¶å®æˆ‘ä»¬æ— æ—¶æ— åˆ»éƒ½åœ¨ä½¿ç”¨ç€Natï¼Œè¿™æ˜¯å®¢æˆ·ç«¯ã€‚å¯¹äºæœåŠ¡ç«¯å‘¢ï¼Ÿä¹Ÿä¼šç”¨åˆ°Natã€‚å…¸å‹çš„åœºæ™¯æ¯”å¦‚è´Ÿè½½å‡è¡¡ã€‚æ¯”å¦‚è¯´æˆ‘ä»¬è¯·æ±‚çš„æ·˜å®é¦–é¡µï¼Œæ·˜å®çš„æœåŠ¡å™¨è‚¯å®šä¸æ­¢ä¸€å°ï¼Œæ·˜å®å¯èƒ½ä¹Ÿæ˜¯é€šè¿‡è´Ÿè½½å‡è¡¡ä»¥åŠNatæ¥æŠŠè¯·æ±‚åˆ†å‘åˆ°åç«¯ã€‚
1dig A taobao.com +short 2140.205.220.96 3140.205.94.189 TCP ä¸ºä»€ä¹ˆä¼šæ³¨æ„åˆ°è¿™ç‚¹å‘¢ï¼Ÿå…¶å®ä¸»è¦æ˜¯å› ä¸ºéƒ¨ç½²åœ¨å®¹å™¨å†…çš„æœåŠ¡åœ¨è¿æ¥MySQLçš„æ—¶å€™ç»å¸¸ä¼šæŠ¥é”™æ¯”å¦‚ï¼š
1pymysql.err.OperationalError: (2003, &amp;#34;Can&amp;#39;t connect to MySQL server on &amp;#39;xxxx (timed out)&amp;#34;) 2Error Code: 2013. Lost connection to MySQL server during query ä¸»è¦çš„åŸå› å°±æ˜¯å› ä¸ºå¼€å‘TCP timewaitçš„å¤ç”¨ã€‚è¿™é‡Œå¼•ç”¨ä¸‹åˆ«äººçš„æ–‡ç« ï¼š
11. åŒæ—¶å¼€å¯tcp_timestampå’Œtcp_tw_recycleä¼šå¯ç”¨TCP/IPåè®®æ ˆçš„per-hostçš„PAWSæœºåˆ¶ 22. ç»è¿‡åŒä¸€NATè½¬æ¢åçš„æ¥è‡ªä¸åŒçœŸå®clientçš„æ•°æ®æµï¼Œåœ¨æœåŠ¡ç«¯çœ‹æ¥æ˜¯äºåŒä¸€hostæ‰“äº¤é“ 33. è™½ç„¶ç»è¿‡åŒä¸€NATè½¬åŒ–ï¼Œä½†ç”±äºä¸åŒçœŸå®clientä¼šæºå¸¦å„è‡ªçš„timestampå€¼ 4å› è€Œæ— æ³•ä¿è¯æ•´è¿‡NATè½¬åŒ–åçš„æ•°æ®åŒ…æºå¸¦çš„timestampå€¼ä¸¥æ ¼é€’å¢ 54. å½“æœåŠ¡å™¨çš„per-host PAWSæœºåˆ¶è¢«è§¦å‘åï¼Œä¼šä¸¢å¼ƒtimestampå€¼ä¸ç¬¦åˆé€’å¢æ¡ä»¶çš„æ•°æ®åŒ… å…ˆè¯´ç»“è®º
 å¼€å¯tcp_timestampï¼Œä½†ä¸è¦å¼€tcp_tw_recycle
 TCPçš„ä¸‰æ¬¡æ¡æ‰‹è¿™äº›å°±ä¸å¤šè¯´äº†ï¼Œä¸‹é¢å°±æ ¹æ®æµç¨‹å›¾ä»¥åŠLinux kernelç›¸å…³TCPå‚æ•°è¡¥å……ä¸€ä¸‹ç»†èŠ‚ã€‚
1å®¢æˆ·ç«¯ æœåŠ¡ç«¯ 2 + + 3 | | 4 | | Listen ç›‘å¬ç«¯å£ 5 | | 6 | | 7+------------------------------------------------------------------+ 8å‘é€SYN,(SYN_SEND) | | 9 | | 10 | | å›å¤SYN+ACKï¼Œåˆ°SYN_RCVD 11 | | 12 å›å¤ACK | | 13 | | 14+------------------------------------------------------------------+ å»ºç«‹è¿æ¥ 15 å»ºç«‹é“¾æ¥ | | å»ºç«‹é“¾æ¥ 16 åŒæ–¹å¼€å§‹ä¼ è¾“æ•°æ® | | åŒæ–¹å¼€å§‹ä¼ è¾“æ•°æ® 17 | | 18 GET / HTTP1.</description>
    </item>
    
    <item>
      <title>Containerd gvisor &amp; k8s</title>
      <link>https://example.com/posts/containerd-gvisor/</link>
      <pubDate>Mon, 25 Nov 2019 12:31:20 +0800</pubDate>
      
      <guid>https://example.com/posts/containerd-gvisor/</guid>
      <description>æœ¬æ–‡ä¸»è¦è®¨è®ºå¦‚ä½•åœ¨containerdä¸­ä½¿ç”¨gvisorä½œä¸ºruntimeï¼Œä»¥åŠå¦‚ä½•å¯¹æ¥k8sã€‚
å®‰è£…containerd è¿™ä¸ªå°±ä¸ç”¨å¤šè¯´äº†ï¼Œç›´æ¥apt install containerd å³å¯ï¼Œä¼šå®‰è£…ä¸€ä¸‹å‡ ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤º
1/usr/bin/containerd å®ˆæŠ¤è¿›ç¨‹ 2/usr/bin/containerd-shim åº”è¯¥æ˜¯è´Ÿè´£å¤„ç†å®¹å™¨å†…stdout &amp;amp; stderr 3/usr/bin/containerd-shim-runc-v1 åº”è¯¥æ˜¯è´Ÿè´£å¯åŠ¨å®¹å™¨å†…çš„pid 1 4/usr/bin/containerd-stress å‹åŠ›æµ‹è¯•å·¥å…· 5/usr/bin/ctr cliå·¥å…·  åæ§½ä¸€ä¸‹ ctrå¯èƒ½æ²¡æœ‰dockerçš„clié‚£ä¹ˆå¥½ç”¨
 æ¥ä¸‹æ¥æˆ‘ä»¬æ¥è¿è¡Œä¸€ä¸ªå®¹å™¨æµ‹è¯•ä¸€ä¸‹containerdï¼š
 å› ä¸ºcontainerdé»˜è®¤çš„pauseå®¹å™¨ä½¿ç”¨çš„æ˜¯gcr.k8s.io/pauseï¼Œå¦‚æœç½‘ç»œæœ‰é—®é¢˜çš„è¯ï¼Œå°±éœ€è¦æå‰å¯¼å…¥ï¼Œæˆ–è€…åœ¨ä¿®æ”¹é»˜è®¤é…ç½®ã€‚ è¿˜è¦æé†’ä¸€ä¸‹ï¼Œcontainerdæœ‰namespaceçš„åŒºåˆ«ï¼Œé»˜è®¤æ˜¯åœ¨defaultä¸‹é¢ï¼Œè¿™é‡Œä¸æ˜¯k8sçš„namespace ã€‚ é™¤æ­¤ä¹‹å¤–è¿˜è¦é…ç½®CNIä»¥ä¾›å®¹å™¨å¯åŠ¨åˆ†é…ç½‘ç»œï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„é…ç½®ï¼š  1mkdir -p /etc/cni/net.d 2cat &amp;gt;&amp;#39;/etc/cni/net.d&amp;#39;/10-containerd-net.conflist &amp;lt;&amp;lt;EOF 3{ 4 &amp;#34;cniVersion&amp;#34;: &amp;#34;0.3.1&amp;#34;, 5 &amp;#34;name&amp;#34;: &amp;#34;containerd-net&amp;#34;, 6 &amp;#34;plugins&amp;#34;: [ 7 { 8 &amp;#34;type&amp;#34;: &amp;#34;bridge&amp;#34;, 9 &amp;#34;bridge&amp;#34;: &amp;#34;cni1&amp;#34;, 10 &amp;#34;isGateway&amp;#34;: true, 11 &amp;#34;ipMasq&amp;#34;: true, 12 &amp;#34;promiscMode&amp;#34;: true, 13 &amp;#34;ipam&amp;#34;: { 14 &amp;#34;type&amp;#34;: &amp;#34;host-local&amp;#34;, 15 &amp;#34;subnet&amp;#34;: &amp;#34;10.</description>
    </item>
    
    <item>
      <title>K8s é›†ç¾¤å‡çº§</title>
      <link>https://example.com/posts/k8s-cluster-update/</link>
      <pubDate>Tue, 22 Oct 2019 21:17:05 +0800</pubDate>
      
      <guid>https://example.com/posts/k8s-cluster-update/</guid>
      <description>ç›®å‰k8så·®ä¸å¤šä¸‰ä¸ªæœˆå°±ä¼šæœ‰ä¸€ä¸ªå¤§ç‰ˆæœ¬ï¼Œå·®ä¸å¤šåŠå¹´ä¸æ›´æ–°çš„è¯å°±è¿½ä¸ä¸Šå®˜æ–¹çš„æ­¥ä¼äº†ï¼ŒåŒæ—¶è¿˜ä¼šæœ‰ä¸€äº›é‡å¤§0dayçš„CVEè¢«å‘ç°ï¼Œæ‰€ä»¥é€‚å½“çš„å‡çº§é›†ç¾¤ä¹Ÿæ˜¯æœ‰å¿…è¦çš„ã€‚æœ¬æ–‡è¯•å°è®¨è®ºä¸€ç§å¯ä»¥æŠŠå½±å“é™åˆ°æœ€ä½ç”šè‡³zero down timeçš„å‡çº§æ–¹å¼ã€‚å¦å¤–æœ¬æ–‡ä¸»è¦è®¨è®ºkubeadmæ­å»ºçš„é›†ç¾¤ï¼Œåœ¨åŸåŸºç¾¤ä¸­å‡çº§ã€‚
ä½•æ—¶å‡çº§ k8séµå®ˆè¯­ä¹‰åŒ–ç‰ˆæœ¬çš„è§„å®šï¼Œæ¯”å¦‚x.y.zä¸­ï¼Œæœ€åçš„å°ç‰ˆæœ¬å¯ä»¥éšæ„å‡çº§ï¼Œå½“å‘ç°æœ‰æ–°çš„CVEä¹‹åï¼Œå¯ä»¥é€šè¿‡å‡çº§å°ç‰ˆæœ¬æ¥å¿«é€Ÿä¿®å¤ï¼Œå½“ç„¶å¦‚æœåœ¨VPCæˆ–è€…å†…ç½‘ä¹‹å†…ï¼Œå°±ä¸ç”¨å¤ªæ‹…å¿ƒäº†ã€‚
å½“yéœ€è¦å‡çº§çš„æ—¶å€™ï¼Œå®˜æ–¹ä¸å»ºè®®è·¨ä¸¤ä¸ªç‰ˆæœ¬å·å‡çº§ï¼Œè™½ç„¶ä»£ç ä¸­æœ‰å…¼å®¹çš„æ–¹å¼ï¼Œè¿™æ—¶å€™é€šè¿‡kubeadm upgradeçš„å‘½ä»¤ä¹Ÿæ˜¯å¯ä»¥å‡çº§çš„ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æ£€æµ‹æ›´æ–°çš„æ—¶å€™éœ€è¦ç§‘å­¦ä¸Šç½‘ï¼Œdocè§ https://kubernetes.io/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/ã€‚
å‡çº§å‡†å¤‡ å¤‡ä»½æ•°æ®ï¼Œè¿™ä¸ªåº”è¯¥åœ¨å¹³æ—¶å°±åšå¥½ï¼Œetcdçš„æ•°æ®å…¨é‡å¤‡ä»½ï¼Œæ•°æ®ç›®å½•ä¹Ÿåº”è¯¥å¤‡ä»½ï¼Œé›†ç¾¤ä¸­åº”ç”¨å¯¹åº”çš„yamlæ–‡ä»¶ï¼Œç”šè‡³æ˜¯pvcä¸­çš„æ•°æ®ï¼Œå½“ç„¶è¿™ä¸ªè¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œå¤‡ä»½ã€‚
ç„¶åé˜…è¯»ç›¸å…³release nodeï¼Œé‡ç‚¹å…³æ³¨å…¶ä¸­å‡ éƒ¨åˆ†ï¼š Known Issuesï¼ŒAction Requireedï¼ŒDeprecations and removalsã€‚ç¤¾åŒºä¼šå°†ä¸€äº›å˜åŒ–highlightåˆ°è¿™é‡Œï¼Œé˜…è¯»è¿™äº›å˜åŒ–å¯ä»¥æ˜ç¡®è‡ªå·±éœ€è¦é‡‡å–å“ªäº›è¡ŒåŠ¨ã€‚æœ‰å“ªäº›å‚æ•°å˜åŒ–ï¼Œå“ªäº›featureå‘ç”Ÿæ›´æ”¹ã€‚æ¯”å¦‚1.13åˆ°1.14 Node Leaseçš„featureå°±é»˜è®¤æ‰“å¼€äº†ã€‚è§ https://github.com/kubernetes/kubernetes/pull/72096
å‡çº§æµç¨‹ï¼ŒæŒ‰ç…§æˆ‘çš„ç»éªŒï¼Œå‡çº§æ­¥éª¤åº”è¯¥æ˜¯etcd master node addonsï¼Œnodeç»„ä»¶å¯ä»¥ä¸masterç»„ä»¶æœ€å¤šå»¶è¿Ÿä¸¤ä¸ªå°ç‰ˆæœ¬(minor version)ï¼Œä½†æ˜¯ä¸èƒ½æ¯”masterç»„ä»¶æ–°ï¼Œå› ä¸ºå¯èƒ½ä¼šæœ‰æ–°çš„å­—æ®µï¼Œæ‰€ä»¥masterç‰ˆæœ¬åº”è¯¥é«˜ä¸€ç‚¹ã€‚
etcdéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¦ä¿è¯é›†ç¾¤çš„å¯ç”¨æ€§å¿…é¡»è¦æœ‰(n+1)/2ä¸ªå¯ç”¨èŠ‚ç‚¹ï¼Œè¿™æ—¶å€™æ‰èƒ½è¿›è¡Œè¯»å†™æ“ä½œï¼Œå¦åˆ™etcdå°±ä¼šæ‹’ç»å†™å…¥ã€‚
é™¤æ­¤ä»¥å¤– https://www.cnblogs.com/gaorong/p/11266629.html è¿™ç¯‡æ–‡ç« æåˆ°åº”è¯¥æš‚æ—¶åœæ‰KCMï¼Œé¿å…podæ¼‚ç§»æˆ–è€…å‰¯æœ¬å‘é€å˜åŒ–ï¼Œä»”ç»†æƒ³æ¥ä¹Ÿæ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œä¸è¿‡è¿™æ ·é™ä½äº†é›†ç¾¤çš„å¯ç”¨æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯å‡çº§çš„æ—¶å€™ä¸èƒ½è¿›è¡Œå…¶ä»–æ“ä½œï¼Œå½“ç„¶å¯ç”¨æ€§å’Œä¸€è‡´æ€§ä¹Ÿæ˜¯éœ€è¦åšä¸€ä¸ªé€‰æ‹©ã€‚
å‡çº§æµ‹è¯•ï¼Œè‡ªå·±æ­å»ºä¸€ä¸ªæ—§çš„é›†ç¾¤ï¼Œç„¶åæŒ‰ç…§æ­¥éª¤å‡çº§ï¼Œçœ‹çœ‹æ˜¯å¦æœ‰ä¸€äº›æ„æ–™ä¹‹å¤–çš„é—®é¢˜å‡ºç°ã€‚
Ref kubernetesé›†ç¾¤å‡çº§çš„æ­£ç¡®å§¿åŠ¿
https://www.cnblogs.com/gaorong/p/11266629.html</description>
    </item>
    
    <item>
      <title>kubectl å¸¸ç”¨å¿«æ·é”®</title>
      <link>https://example.com/posts/kubectl/</link>
      <pubDate>Fri, 20 Sep 2019 22:31:20 +0800</pubDate>
      
      <guid>https://example.com/posts/kubectl/</guid>
      <description>æŸ¥è¯¢ç±» 1# custom-columns 2 3# æ¯”å¦‚ æŸ¥çœ‹role=sre æ ‡ç­¾podé•œåƒï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨goçš„è‡ªå®šä¹‰è¾“å‡º 4kubectl -n kube-system get po -l tier=control-plane -o custom-columns=NAME:.metadata.name,image:.spec.containers[0].image 5NAME image 6etcd-ubuntu-bionic gcr.azk8s.cn/google_containers/etcd:3.3.15-0 7kube-apiserver-ubuntu-bionic gcr.azk8s.cn/google_containers/kube-apiserver:v1.16.2 8kube-controller-manager-ubuntu-bionic gcr.azk8s.cn/google_containers/kube-controller-manager:v1.16.2 9kube-scheduler-ubuntu-bionic gcr.azk8s.cn/google_containers/kube-scheduler:v1.16.2 10 11# go-template  12 13# range åµŒå¥— 14# åˆ—å‡ºæ‰€æœ‰å®¹å™¨ä½¿ç”¨çš„é•œåƒå 15kubectl get pods -o go-template --template=&amp;#39;{{range .items}}{{range .spec.containers}}{{printf &amp;#34;%s\n&amp;#34; .image}}{{end}}{{end}}&amp;#39; 16istio/examples-bookinfo-details-v1:1.5.0 17istio/examples-bookinfo-productpage-v1:1.5.0 18istio/examples-bookinfo-ratings-v1:1.5.0 19 20# æ¡ä»¶åˆ¤æ–­ 21# åˆ—å‡ºæ‰€æœ‰ä¸å¯è°ƒåº¦èŠ‚ç‚¹çš„èŠ‚ç‚¹åä¸ IP 22kubectl get no -o go-template=&amp;#39;{{range .items}}{{if .spec.unschedulable}}{{.metadata.name}} {{.spec.externalID}}{{&amp;#34;\n&amp;#34;}}{{end}}{{end}}&amp;#39; 23 24 25# jsonpath 26 27# æŸ¥è¯¢podçš„å¯åŠ¨æ—¶é—´ 28kubectl -n kube-system get pods -o=jsonpath=&amp;#39;{range .</description>
    </item>
    
    <item>
      <title>procfs ä¸ Linux ç³»ç»Ÿç›‘æ§</title>
      <link>https://example.com/posts/monitor-procfs/</link>
      <pubDate>Sun, 25 Aug 2019 12:24:20 +0800</pubDate>
      
      <guid>https://example.com/posts/monitor-procfs/</guid>
      <description>Unixç³»æ¨å´‡ä¸€ä¸ªè§‚ç‚¹ï¼ŒEverything is a file ã€‚å¯¹äºä¸€äº›ç³»ç»Ÿä»¥åŠè¿›ç¨‹ä¿¡æ¯ï¼Œkernelä¼šä»¥æ–‡ä»¶ç³»ç»Ÿçš„ç³»ç»ŸæŒ‚è½½åœ¨procå’Œsysç›®å½•ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„procfsï¼Œsysfsè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿã€‚åŒ…æ‹¬CPUï¼Œå†…å­˜å’Œç¡¬ç›˜ç­‰ä¿¡æ¯ã€‚å½“ç„¶å¯¹äºç³»ç»Ÿç›‘æ§æ¥è¯´ï¼Œè¿™ä¹Ÿæ˜¯é‡è¦çš„æ•°æ®æºã€‚
procçš„ç›®å½•çœ‹èµ·æ¥æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼Œé‚£äº›æ•°å­—éƒ½æ˜¯è¿›ç¨‹çš„PIDï¼Œå…¶ä»–çš„æ˜¯ä¸€äº›ç³»ç»Ÿç³»ï¼Œæ¯”å¦‚cpuinfoè®°å½•è€…ç¡¬ä»¶çš„CPUä¿¡æ¯ï¼š
æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿›ç¨‹PIDé‡Œé¢çš„ä¿¡æ¯ï¼Œè®°å½•è€…æ­¤è¿›ç¨‹çš„å¯åŠ¨å‘½ä»¤ï¼Œå‚æ•°ç­‰ä¿¡æ¯ã€‚
1ls /proc/ 21 1170 1345 19 2116 304 382 406 787 942 consoles interrupts kpageflags pagetypeinfo sysrq-trigger 310 12 14 1911 22 305 383 408 8 955 cpuinfo iomem loadavg partitions sysvipc 41022 1205 15 1922 24 31 384 41 824 96 crypto ioports locks sched_debug thread-self 5105 1215 16 1928 25 32 387 42 85 967 devices irq mdstat schedstat timer_list 61059 1216 174 2 257 33 389 422 86 979 diskstats kallsyms meminfo scsi tty 711 122 175 20 26 34 398 462 87 994 dma kcore misc self uptime 81122 1243 176 2098 26150 35 4 555 88 acpi driver key-users modules slabinfo version 91134 1269 177 21 27 36 40 556 89 buddyinfo execdomains keys mounts softirqs version_signature 101147 1289 18 2100 28 37 400 6 9 bus fb kmsg mpt stat vmallocinfo 111152 13 183 2114 29 379 402 639 90 cgroups filesystems kpagecgroup mtrr swaps vmstat 121166 1340 186 2115 30 381 404 7 908 cmdline fs kpagecount net sys zoneinfo 13 14 15ls /proc/1/ 16attr cmdline environ io mem ns pagemap sched smaps_rollup syscall wchan 17autogroup comm exe limits mountinfo numa_maps patch_state schedstat stack task 18auxv coredump_filter fd loginuid mounts oom_adj personality sessionid stat timers 19cgroup cpuset fdinfo map_files mountstats oom_score projid_map setgroups statm timerslack_ns 20clear_refs cwd gid_map maps net oom_score_adj root smaps status uid_map sysfsä¸»è¦è®°å½•çš„ç³»ç»Ÿçš„è®¾å¤‡ä¿¡æ¯ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªdocker0çš„è™šæ‹Ÿç½‘å¡ï¼š</description>
    </item>
    
    <item>
      <title>Etcd ä½¿ç”¨å…¥é—¨</title>
      <link>https://example.com/posts/get-start-etcd/</link>
      <pubDate>Sat, 15 Jun 2019 12:31:20 +0800</pubDate>
      
      <guid>https://example.com/posts/get-start-etcd/</guid>
      <description>etcdæ˜¯coreosæ ¹æ®Raftä¸€è‡´æ€§ç®—æ³•ç”¨goå®ç°çš„åˆ†å¸ƒå¼KVæ•°æ®åº“ï¼Œä½œä¸ºk8sæ•°æ®å”¯ä¸€å­˜å‚¨çš„åœ°æ–¹ï¼Œetcdå…·æœ‰é«˜æ€§èƒ½çš„è¯»å†™ä»¥åŠwatchæ€§èƒ½ï¼Œä¹Ÿå¯ä»¥ç”¨åœ¨æœåŠ¡æ³¨å†Œï¼Œé…ç½®ä¸­å¿ƒç­‰ã€‚å®˜æ–¹Doc https://github.com/etcd-io/etcd/blob/master/Documentation
å…¥é—¨ åˆè¯†å•èŠ‚ç‚¹ etcdä½¿ç”¨äº†ä¸¤ä¸ªç«¯å£ 2379 grpc ä»¥åŠ2380 httpï¼Œç°åœ¨æœ€æ–°çš„APIç‰ˆæœ¬æ˜¯v3ï¼Œä¹‹å‰çš„v2æ€§èƒ½æœ‰ä¸€å®šé—®é¢˜ï¼Œå»ºè®®ç›´æ¥ç”¨v3çš„APIã€‚é…ç½®etcdå¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡æˆ–è€…å‘½ä»¤è¡Œå‚æ•°ã€‚Etcdä¼šæœ‰ä¸€äº›é»˜è®¤å‚æ•°ï¼Œä½†æ˜¯bindçš„åœ°å€éƒ½æ˜¯127.0.0.1
1docker run -d --name etcd k8s.gcr.io/etcd:3.3.10 etcd 2# etcdmain 32019-06-25 06:26:30.323960 I | etcdmain: etcd Version: 3.3.10 42019-06-25 06:26:30.324127 I | etcdmain: Git SHA: 27fc7e2 52019-06-25 06:26:30.324138 I | etcdmain: Go Version: go1.10.4 62019-06-25 06:26:30.324153 I | etcdmain: Go OS/Arch: linux/amd64 72019-06-25 06:26:30.324162 I | etcdmain: setting maximum number of CPUs to 2, total number of available CPUs is 2 82019-06-25 06:26:30.</description>
    </item>
    
    <item>
      <title>k8s APIServer åŠ¨æ€å‡†å…¥æ§åˆ¶å™¨</title>
      <link>https://example.com/posts/k8s-apiserver-webhook/</link>
      <pubDate>Sat, 25 May 2019 22:31:20 +0800</pubDate>
      
      <guid>https://example.com/posts/k8s-apiserver-webhook/</guid>
      <description>å½“ä½ åœ¨k8sé›†ç¾¤ä¸­ä¸€ä¸ªä¸å­˜åœ¨çš„namespaceä¸­åˆ›å»ºä¸€ä¸ªpodï¼Œä¼šè¿”å›ä¸€ä¸ªnamespace not foundç±»ä¼¼çš„é”™è¯¯ï¼Œä½ æœ‰æƒ³è¿‡è¿™ä¸ªæ˜¯å“ªä¸ªç»„ä»¶å®Œæˆçš„å—ï¼Ÿå¯¹å°±æ˜¯admission pluginã€‚
ä»æ§åˆ¶å™¨è¯´èµ· ä»€ä¹ˆæ˜¯å‡†å…¥æ’ä»¶ï¼Œåœ¨APIServerä¸­æœ‰è¿™æ ·ä¸€ä¸ªå‚æ•°--enable-admission-pluginsï¼Œç”¨äºå¯¹åˆ›å»ºçš„å¯¹è±¡çš„åˆç†æ€§è¿›è¡ŒéªŒè¯å’ŒäºŒæ¬¡ä¿®æ”¹ã€‚å¯é€‰çš„å‚æ•°å¦‚ä¸‹æ‰€ç¤ºï¼š
 AlwaysAdmit, # ä¸€ç›´å…è®¸ AlwaysDeny, # ä¸€ç›´ç¦æ­¢ AlwaysPullImages, # åœ¨å¯åŠ¨å®¹å™¨ä¹‹å‰æ€»æ˜¯å»ä¸‹è½½é•œåƒï¼Œç›¸å½“äºæ¯å½“å®¹å™¨å¯åŠ¨å‰åšä¸€æ¬¡ç”¨äºæ˜¯å¦æœ‰æƒä½¿ç”¨è¯¥å®¹å™¨é•œåƒçš„æ£€æŸ¥ DefaultStorageClass, # é»˜è®¤çš„sc DefaultTolerationSeconds, DenyEscalatingExec, # æ‹’ç»execå’Œattachå‘½ä»¤åˆ°æœ‰å‡çº§ç‰¹æƒçš„Podçš„ç»ˆç«¯ç”¨æˆ·è®¿é—®ã€‚å¦‚æœé›†ä¸­åŒ…å«å‡çº§ç‰¹æƒçš„å®¹å™¨ï¼Œè€Œè¦é™åˆ¶ç»ˆç«¯ç”¨æˆ·åœ¨è¿™äº›å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤çš„èƒ½åŠ›ï¼Œæ¨èä½¿ç”¨æ­¤æ’ä»¶ DenyExecOnPrivileged, EventRateLimit, # event é™æµ ExtendedResourceToleration, ImagePolicyWebhook, LimitPodHardAntiAffinityTopology, LimitRanger, # é»˜è®¤èµ„æºé™é¢ï¼Œç”¨äºPodå’Œå®¹å™¨ä¸Šçš„é…é¢ç®¡ç†ï¼Œå®ƒä¼šè§‚å¯Ÿè¿›å…¥çš„è¯·æ±‚ï¼Œç¡®ä¿Podå’Œå®¹å™¨ä¸Šçš„é…é¢ä¸ä¼šè¶…æ ‡ã€‚å‡†å…¥æ§åˆ¶å™¨LimitRangerå’Œèµ„æºå¯¹è±¡LimitRangeä¸€èµ·å®ç°èµ„æºé™åˆ¶ç®¡ç† MutatingAdmissionWebhook, # æˆæƒåçš„webhook NamespaceAutoProvision, NamespaceExists,# å‘½åç©ºé—´æ˜¯å¦å­˜åœ¨ NamespaceLifecycle, # å½“ä¸€ä¸ªè¯·æ±‚æ˜¯åœ¨ä¸€ä¸ªä¸å­˜åœ¨çš„namespaceä¸‹åˆ›å»ºèµ„æºå¯¹è±¡æ—¶ï¼Œè¯¥è¯·æ±‚ä¼šè¢«æ‹’ç»ã€‚å½“åˆ é™¤ä¸€ä¸ªnamespaceæ—¶ï¼Œå°†ä¼šåˆ é™¤è¯¥namespaceä¸‹çš„æ‰€æœ‰èµ„æºå¯¹è±¡ NodeRestriction, OwnerReferencesPermissionEnforcement, PersistentVolumeClaimResize, # PVC æ‰©å®¹ PersistentVolumeLabel, # PVCæ ‡ç­¾ PodNodeSelector,# pod èŠ‚ç‚¹é€‰æ‹©å™¨ PodPreset, # å‘namespaceæ³¨å…¥å˜é‡å’Œå­˜å‚¨ PodSecurityPolicy, # podå®‰å…¨ç­–ç•¥ PodTolerationRestriction, Priority, # è°ƒåº¦ç­–ç•¥ï¼Ÿ ResourceQuota, # ç”¨äºnamespaceä¸Šçš„é…é¢ç®¡ç†ï¼Œå®ƒä¼šè§‚å¯Ÿè¿›å…¥çš„è¯·æ±‚ï¼Œç¡®ä¿åœ¨namespaceä¸Šçš„é…é¢ä¸è¶…æ ‡ã€‚æ¨èå°†è¿™ä¸ªæ’ä»¶æ”¾åˆ°å‡†å…¥æ§åˆ¶å™¨åˆ—è¡¨çš„æœ€åä¸€ä¸ªã€‚ResourceQuotaå‡†å…¥æ§åˆ¶å™¨æ—¢å¯ä»¥é™åˆ¶æŸä¸ªnamespaceä¸­åˆ›å»ºèµ„æºçš„æ•°é‡ï¼Œåˆå¯ä»¥é™åˆ¶æŸä¸ªnamespaceä¸­è¢«Podè¯·æ±‚çš„èµ„æºæ€»é‡ã€‚ResourceQuotaå‡†å…¥æ§åˆ¶å™¨å’ŒResourceQuotaèµ„æºå¯¹è±¡ä¸€èµ·å¯ä»¥å®ç°èµ„æºé…é¢ç®¡ç† SecurityContextDeny, # å°†Podå®šä¹‰ä¸­å®šä¹‰äº†çš„SecurityContexté€‰é¡¹å…¨éƒ¨å¤±æ•ˆã€‚SecurityContextåŒ…å«åœ¨å®¹å™¨ä¸­å®šä¹‰äº†æ“ä½œç³»ç»Ÿçº§åˆ«çš„å®‰å…¨é€‰å‹å¦‚fsGroupï¼Œselinuxç­‰é€‰é¡¹ ServiceAccount, #è¿™ä¸ªæ’ä»¶å®ç°äº†serviceAccountsç­‰ç­‰è‡ªåŠ¨åŒ–ï¼Œå¦‚æœä½¿ç”¨ServiceAccountå¯¹è±¡ï¼Œå¼ºçƒˆæ¨èä½¿ç”¨è¿™ä¸ªæ’ä»¶ StorageObjectInUseProtection, TaintNodesByCondition, ValidatingAdmissionWebhook.</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨kubeadmåˆå§‹åŒ–é›†ç¾¤</title>
      <link>https://example.com/posts/create-cluster-use-kubeadm/</link>
      <pubDate>Fri, 17 May 2019 22:31:20 +0800</pubDate>
      
      <guid>https://example.com/posts/create-cluster-use-kubeadm/</guid>
      <description>å¾ˆä¹…ä¹‹å‰å°±å†™è¿‡è¿™ç¯‡ç¬”è®°ï¼Œä¸€ç›´æ²¡å‘å‡ºæ¥ï¼Œè™½è¯´è¿™æ ·çš„æ–‡ç« å·®ä¸å¤šå·²ç»çƒ‚å¤§è¡—äº†ï¼Œè¿˜æ˜¯å¯ä»¥çœ‹ä¸€ä¸‹çš„ã€‚
1âˆâˆ 2apt install -y bash-completion 3yum install -y bash-completion 4echo &amp;#34;source &amp;lt;(kubectl completion bash)&amp;#34; &amp;gt;&amp;gt; ~/.bashrc 5echo &amp;#34;source &amp;lt;(kubeadm completion bash)&amp;#34; &amp;gt;&amp;gt; ~/.bashrc 6source ~/.bashrc 7modprobe ip_vs &amp;amp;&amp;amp; modprobe ip_vs_rr &amp;amp;&amp;amp; modprobe ip_vs_wrr &amp;amp;&amp;amp; modprobe ip_vs_sh 8rm -rf /var/lib/cni/ 9rm -rf /var/lib/kubelet/* 10rm -rf /etc/cni/ 11ip link del cni0 &amp;amp;&amp;amp; ip link del flannel.1 &amp;amp;&amp;amp; ip link del kube-ipvs0 12net.ipv6.conf.all.disable_ipv6 = 1 13awk &amp;#39;$2 ~ path {print $2}&amp;#39; path=/var/lib/kubelet /proc/mounts | xargs -r umount 14kubeadm init --kubernetes-version 1.</description>
    </item>
    
    <item>
      <title>Kubernetesä¸­çš„å­˜å‚¨</title>
      <link>https://example.com/posts/storage-in-kubernets/</link>
      <pubDate>Sun, 12 May 2019 22:31:20 +0800</pubDate>
      
      <guid>https://example.com/posts/storage-in-kubernets/</guid>
      <description>æ¦‚å¿µ PersistentVolume PersistentVolumeï¼ˆæŒä¹…å·ï¼Œç®€ç§°PVï¼‰æ˜¯é›†ç¾¤å†…ï¼Œç”±ç®¡ç†å‘˜æä¾›çš„ç½‘ç»œå­˜å‚¨çš„ä¸€éƒ¨åˆ†ã€‚å°±åƒé›†ç¾¤ä¸­çš„èŠ‚ç‚¹ä¸€æ ·ï¼ŒPVä¹Ÿæ˜¯é›†ç¾¤ä¸­çš„ä¸€ç§èµ„æºã€‚å®ƒä¹ŸåƒVolumeä¸€æ ·ï¼Œæ˜¯ä¸€ç§volumeæ’ä»¶ï¼Œä½†æ˜¯å®ƒçš„ç”Ÿå‘½å‘¨æœŸå´æ˜¯å’Œä½¿ç”¨å®ƒçš„Podç›¸äº’ç‹¬ç«‹çš„ã€‚PVè¿™ä¸ªAPIå¯¹è±¡ï¼Œæ•è·äº†è¯¸å¦‚NFSã€ISCSIã€æˆ–å…¶ä»–äº‘å­˜å‚¨ç³»ç»Ÿçš„å®ç°ç»†èŠ‚ã€‚ https://kubernetes.io/docs/concepts/storage/persistent-volumes#persistent-volumes
1# kubectl explain pv.spec 2# KIND: PersistentVolume 3# VERSION: v1 4# spec 5# accessModes &amp;lt;[]string&amp;gt; 6# capacity &amp;lt;map[string]string&amp;gt; 7# mountOptions &amp;lt;[]string&amp;gt; éƒ¨åˆ†æ”¯æŒï¼Œæ¯”å¦‚NFS 8# persistentVolumeReclaimPolicy &amp;lt;string&amp;gt; 9# storageClassName &amp;lt;string&amp;gt; 10# volumeMode &amp;lt;string&amp;gt; 11apiVersion: v1 12kind: PersistentVolume 13metadata: 14 name: block-pv 15spec: 16 accessModes: 17 - ReadWriteOnce 18 capacity: 19 storage: 10Gi 20 persistentVolumeReclaimPolicy: Retain 21 storageClassNameï¼š aliclood-nas 22 volumeMode: Block PersistentVolumeClaim PersistentVolumeClaimï¼ˆæŒä¹…å·å£°æ˜ï¼Œç®€ç§°PVCï¼‰æ˜¯ç”¨æˆ·çš„ä¸€ç§å­˜å‚¨è¯·æ±‚ã€‚å®ƒå’ŒPodç±»ä¼¼ï¼ŒPodæ¶ˆè€—Nodeèµ„æºï¼Œè€ŒPVCæ¶ˆè€—PVèµ„æºã€‚Podèƒ½å¤Ÿè¯·æ±‚ç‰¹å®šçš„èµ„æºï¼ˆå¦‚CPUå’Œå†…å­˜ï¼‰ã€‚PVCèƒ½å¤Ÿè¯·æ±‚æŒ‡å®šçš„å¤§å°å’Œè®¿é—®çš„æ¨¡å¼ï¼ˆå¯ä»¥è¢«æ˜ å°„ä¸ºä¸€æ¬¡è¯»å†™æˆ–è€…å¤šæ¬¡åªè¯»ï¼‰ã€‚ PVCå…è®¸ç”¨æˆ·æ¶ˆè€—æŠ½è±¡çš„å­˜å‚¨èµ„æºï¼Œç”¨æˆ·ä¹Ÿç»å¸¸éœ€è¦å„ç§å±æ€§ï¼ˆå¦‚æ€§èƒ½ï¼‰çš„PVã€‚é›†ç¾¤ç®¡ç†å‘˜éœ€è¦æä¾›å„ç§å„æ ·ã€ä¸åŒå¤§å°ã€ä¸åŒè®¿é—®æ¨¡å¼çš„PVï¼Œè€Œä¸ç”¨å‘ç”¨æˆ·æš´éœ²è¿™äº›volumeå¦‚ä½•å®ç°çš„ç»†èŠ‚ã€‚å› ä¸ºè¿™ç§éœ€æ±‚ï¼Œå°±å‚¬ç”Ÿå‡ºä¸€ç§StorageClassèµ„æºã€‚
1 # accessModes &amp;lt;[]string&amp;gt; 2 # storageClassName &amp;lt;string&amp;gt; 3 # volumeMode &amp;lt;string&amp;gt; 4 # volumeName &amp;lt;string&amp;gt; 5 # resources &amp;lt;Object&amp;gt; 6kind: PersistentVolumeClaim 7apiVersion: v1 8metadata: 9 name: myclaim 10spec: 11 accessModes: 12 - ReadWriteOnce 13 storageClassName: slow 14 volumeMode: Filesystem 15 resources: 16 requests: 17 storage: 8Gi StorageClass StorageClassæä¾›äº†ä¸€ç§æ–¹å¼ï¼Œä½¿å¾—ç®¡ç†å‘˜èƒ½å¤Ÿæè¿°ä»–æä¾›çš„å­˜å‚¨çš„ç­‰çº§ã€‚é›†ç¾¤ç®¡ç†å‘˜å¯ä»¥å°†ä¸åŒçš„ç­‰çº§æ˜ å°„åˆ°ä¸åŒçš„æœåŠ¡ç­‰çº§ã€ä¸åŒçš„åç«¯ç­–ç•¥ã€‚ https://kubernetes.</description>
    </item>
    
    <item>
      <title>åœ¨awsä¸Šä½¿ç”¨kopséƒ¨ç½²k8sé›†ç¾¤</title>
      <link>https://example.com/posts/use-kops-in-aws/</link>
      <pubDate>Sun, 12 May 2019 22:31:20 +0800</pubDate>
      
      <guid>https://example.com/posts/use-kops-in-aws/</guid>
      <description>ç®€ä»‹ï¼šKubernetes Operations (kops) - Production Grade K8s Installation, Upgrades, and Management kopså®£ç§°å·²ç»è¾¾åˆ°ç”Ÿäº§çº§åˆ«ï¼Œå‡†å¤‡è¯•ä¸€ä¸‹kopsï¼Œè§‚å¯Ÿå…¶è¿è¡Œæ§åˆ¶å¹³é¢çš„æ–¹å¼ã€‚å®˜æ–¹çš„æ–‡æ¡£å¦‚ä¸‹ï¼š https://github.com/kubernetes/kops/blob/master/docs/aws.md
å®‰è£… å½“ç„¶kopsä¹Ÿæ˜¯ç”¨golangå†™çš„ï¼Œæ‰€ä»¥ä½ åªè¦ä¸‹è½½é¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶å³å¯ã€‚
1# æŒ‡å®šç‰ˆæœ¬ 2https://github.com/kubernetes/kops/releases/download/1.10.0/kops-linux-amd64 3 4#æœ€æ–°ç‰ˆæœ¬ 5wget -O kops https://github.com/kubernetes/kops/releases/download/$(curl -s https://api.github.com/repos/kubernetes/kops/releases/latest | grep tag_name | cut -d &amp;#39;&amp;#34;&amp;#39; -f 4)/kops-linux-amd64 6chmod +x ./kops 7sudo mv ./kops /usr/local/bin/ 8 9curl -LO https://storage.googleapis.com/kubernetes-release/release/1.10.0/bin/linux/amd64/kubectl 10 11wget -O kubectl https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl 12chmod +x ./kubectl 13sudo mv ./kubectl /usr/local/bin/kubectl 14 15#awscliæ˜¯ç”¨Pythonå†™çš„ï¼Œå®‰è£…Pythonå’Œpipåç›´æ¥è¿è¡Œä¸‹é¢å‘½ä»¤å°±å¯ä»¥äº†ã€‚ 16pip install awscli åˆ›å»ºIAM kops éœ€è¦æœ‰ä»¥ä¸‹å››ä¸ªæƒé™ï¼Œé¦–å…ˆåˆ›å»ºäº†kopsçš„ç”¨æˆ·ç»„ï¼Œç„¶ååˆ›å»ºäº†kopsç”¨æˆ·
 AmazonEC2FullAccess AmazonRoute53FullAccess AmazonS3FullAccess IAMFullAccess AmazonVPCFullAccess  1aws iam create-group --group-name kops 2 3aws iam attach-group-policy --policy-arn arn:aws:iam::aws:policy/AmazonEC2FullAccess --group-name kops 4aws iam attach-group-policy --policy-arn arn:aws:iam::aws:policy/AmazonRoute53FullAccess --group-name kops 5aws iam attach-group-policy --policy-arn arn:aws:iam::aws:policy/AmazonS3FullAccess --group-name kops 6aws iam attach-group-policy --policy-arn arn:aws:iam::aws:policy/IAMFullAccess --group-name kops 7aws iam attach-group-policy --policy-arn arn:aws:iam::aws:policy/AmazonVPCFullAccess --group-name kops 8 9aws iam create-user --user-name kops 10 11aws iam add-user-to-group --user-name kops --group-name kops 12 13aws iam create-access-key --user-name kops 14 15# configure the aws client to use your new IAM user 16aws configure # Use your new access and secret key here 17aws iam list-users # you should see a list of all your IAM users here 18 19# Because &amp;#34;aws configure&amp;#34; doesn&amp;#39;t export these vars for kops to use, we export them now 20export AWS_ACCESS_KEY_ID=$(aws configure get aws_access_key_id) 21export AWS_SECRET_ACCESS_KEY=$(aws configure get aws_secret_access_key) åˆ›å»ºS3 é¦–å…ˆæˆ‘åˆ›å»ºäº†ä¸€ä¸ªs3çš„å­˜å‚¨ï¼Œç”¨äºå­˜æ”¾kopsçš„é…ç½®æ–‡ä»¶ï¼Œç„¶åä¸ºè¿™ä¸ªå­˜å‚¨æ¡¶åŠ å…¥äº†ç‰ˆæœ¬æ§åˆ¶</description>
    </item>
    
    <item>
      <title>CoreDNS-åŸºäºCaddyçš„DNS Server</title>
      <link>https://example.com/posts/coredns/</link>
      <pubDate>Thu, 25 Apr 2019 22:31:20 +0800</pubDate>
      
      <guid>https://example.com/posts/coredns/</guid>
      <description>CoreDNSåˆ©ç”¨ä½œä¸ºWebæœåŠ¡å™¨Caddyçš„ä¸€éƒ¨åˆ†è€Œå¼€å‘çš„æœåŠ¡å™¨æ¡†æ¶ã€‚è¯¥æ¡†æ¶å…·æœ‰éå¸¸çµæ´»ï¼Œå¯æ‰©å±•çš„æ¨¡å‹ï¼Œç”¨äºé€šè¿‡å„ç§ä¸­é—´ä»¶ç»„ä»¶ä¼ é€’è¯·æ±‚ã€‚è¿™äº›ä¸­é—´ä»¶ç»„ä»¶æ ¹æ®è¯·æ±‚æä¾›ä¸åŒçš„æ“ä½œï¼Œä¾‹å¦‚è®°å½•ï¼Œé‡å®šå‘ï¼Œä¿®æ”¹æˆ–ç»´æŠ¤ã€‚è™½ç„¶å®ƒä¸€å¼€å§‹ä½œä¸ºWebæœåŠ¡å™¨ï¼Œä½†æ˜¯Caddyå¹¶ä¸æ˜¯ä¸“é—¨é’ˆå¯¹HTTPåè®®çš„ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯å¼€å‘CoreDNSçš„ç†æƒ³æ¡†æ¶ã€‚
Install å¦‚æœä½¿ç”¨Kubeadmåˆå§‹åŒ–çš„é›†ç¾¤ï¼Œé»˜è®¤å·²ç»å®‰è£…äº†CoreDNSã€‚é»˜è®¤é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š
1cat /etc/coredns/Corefile 2.:53 { 3 errors 4 health 5 kubernetes cluster.local in-addr.arpa ip6.arpa { 6 pods insecure 7 upstream 8 fallthrough in-addr.arpa ip6.arpa 9 } 10 prometheus :9153 11 proxy . /etc/resolv.conf 12 cache 30 13 reload 14 loadbalance 15} 9153/metrics æ˜¯é»˜è®¤çš„metricsç«¯å£ :8080/health æ˜¯å¥åº·æ£€æŸ¥çš„ç«¯å£ï¼Œé™¤æ­¤ä¹‹å¤–éœ€è¦æ³¨æ„çš„æ˜¯æ·»åŠ äº†ä¸€ä¸ªkernel capabilitiesï¼ŒDNSç­–ç•¥æ˜¯é»˜è®¤ã€‚åªä¼šå¯¹cluster.localè¿›è¡Œè§£æï¼Œå…¶ä»–åŸŸååˆ™æ˜¯è½¬å‘åˆ°ä¸Šæ¸¸DNSæœåŠ¡å™¨ã€‚
 securityContext: allowPrivilegeEscalation: false capabilities: add: - NET_BIND_SERVICE drop: - all CoreDNSç›¸å½“äºåˆ›å»ºäº†ä¸€ä¸ªKubernetesä¸­é—´ä»¶ã€‚è¯¥ä¸­é—´ä»¶ä½¿ç”¨Kubernetes APIæ¥æ»¡è¶³é’ˆå¯¹ç‰¹å®šKubernetes podæˆ–æœåŠ¡çš„DNSè¯·æ±‚ã€‚è€Œä¸”ç”±äºKube-DNSä½œä¸ºKubernetesçš„å¦ä¸€é¡¹æœåŠ¡ï¼Œkubeletå’ŒCoreDNSä¹‹é—´æ²¡æœ‰ç´§å¯†çš„ç»‘å®šã€‚åªéœ€è¦å°†DNSæœåŠ¡çš„IPåœ°å€å’ŒåŸŸåä¼ é€’ç»™kubeletï¼Œè€ŒKuberneteså¹¶ä¸å…³å¿ƒè°åœ¨å®é™…å¤„ç†è¯¥IPè¯·æ±‚ã€‚å’ŒDNSç›¸å…³çš„é…éƒ½åœ¨kubeletä¸Šé¢ï¼Œåˆ†åˆ«æ˜¯ï¼š
 &amp;ndash;cluster-dns &amp;ndash;cluster-domain  é™¤æ­¤ä¹‹å¤–Podçš„dnsPolicy å¯é€‰å‚æ•°ä¸º&amp;rsquo;ClusterFirstWithHostNet&#39;, &amp;lsquo;ClusterFirst&amp;rsquo;, &amp;lsquo;Default&amp;rsquo; or &amp;lsquo;None&amp;rsquo;ï¼Œè€Œå½“Podè®¾ç½®dnsPolicyä¸ºClusterFirstæ—¶ ï¼Œå³å¯åœ¨podå†…ç”Ÿæˆä»¥ä¸‹/etc/resolv.</description>
    </item>
    
    <item>
      <title>k8s çš„å®æ—¶æ—¥å¿— Events</title>
      <link>https://example.com/posts/k8s-event-explorer/</link>
      <pubDate>Tue, 16 Apr 2019 09:43:24 +0000</pubDate>
      
      <guid>https://example.com/posts/k8s-event-explorer/</guid>
      <description>Event ä»€ä¹ˆæ˜¯k8sçš„Eventsï¼Ÿæ¯”å¦‚ä½ å¯åŠ¨äº†ä¸€ä¸ªDeploymentï¼Œk8sçš„å„å¤§ç»„ä»¶å°±å¼€å§‹ä¾æ¬¡å¿™ç¢Œèµ·æ¥ï¼Œæœ€ç»ˆå®ŒæˆPodçš„åˆ›å»ºï¼Œä»å£°æ˜ä¸€ä¸ªDeploymentå¼€å§‹ï¼Œåˆ°Podå¯åŠ¨å®Œæˆï¼Œä¼šç”Ÿæˆä¸€äº›åˆ—Eventsï¼Œç”¨æ¥å‘ŠçŸ¥ç”¨æˆ·ç°åœ¨çš„çŠ¶æ€ã€‚eventå°±æ˜¯ç”¨æ¥å›ç­”ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚ä¸ºä»€ä¹ˆpodæ²¡æœ‰å¯åŠ¨ï¼Œå› ä¸ºæ²¡æœ‰é…ç½®ç§æœ‰ä»“åº“çš„è®¤è¯ï¼Œä¸ºä»€ä¹ˆpodä¼šè¢«Killï¼Œå› ä¸ºæ˜¯è¶…è¿‡limitçš„é™åˆ¶ã€‚å…·ä½“å¦‚ä¸‹æ‰€ç¤ºï¼š
1kubectl get ev 2LAST SEEN TYPE REASON OBJECT MESSAGE 33s Normal Scheduled pod/nginx-698898f666-smg7t Successfully assigned default/nginx-698898f666-smg7t to east1-monitor1 43s Normal Pulled pod/nginx-698898f666-smg7t Container image &amp;#34;nginx:alpine&amp;#34; already present on machine 53s Normal Created pod/nginx-698898f666-smg7t Created container nginx 63s Normal Started pod/nginx-698898f666-smg7t Started container nginx 73s Normal SuccessfulCreate replicaset/nginx-698898f666 Created pod: nginx-698898f666-smg7t 83s Normal ScalingReplicaSet deployment/nginx Scaled up replica set nginx-698898f666 to 1 è¿™äº›ä¿¡æ¯ä¼šè¢«å­˜å‚¨åœ¨Etcdä¸­ï¼Œé»˜è®¤çš„ä¿å­˜æ—¶é—´ä¸º1å°æ—¶ã€‚
1/registry/events/default/nginx-698898f666-smg7t.1593fd25ca0c7e00 2/registry/events/default/nginx-698898f666-smg7t.1593fd25f1ff3cca 3/registry/events/default/nginx-698898f666-smg7t.1593fd25f4066f9f 4/registry/events/default/nginx-698898f666-smg7t.1593fd25fd741cf6 5/registry/events/default/nginx-698898f666.1593fd25c9abf7dc 6/registry/events/default/nginx.1593fd25c9217fce æ‰¾åˆ°ä¸€æ¡Eventï¼Œå¯ä»¥çœ‹åˆ°å®Œæ•´çš„ä¿¡æ¯å¦‚ä¸‹ï¼Œå€¼å¾—å…³æ³¨çš„åœ°æ–¹æœ‰involvedObjectçš„nameå’Œsourceçš„hostç­‰ç­‰ã€‚</description>
    </item>
    
    <item>
      <title>k8s ä¸ƒå±‚è®¿é—®å…¥å£ Ingress</title>
      <link>https://example.com/posts/k8s-ingress-useage/</link>
      <pubDate>Tue, 12 Mar 2019 22:31:20 +0800</pubDate>
      
      <guid>https://example.com/posts/k8s-ingress-useage/</guid>
      <description>k8såˆæœŸçš„æ—¶å€™ï¼Œåªæœ‰Serviceä½œä¸ºå››å±‚è´Ÿè½½å‡è¡¡ï¼Œåæ¥æ‰æ¨å‡ºäº†ä¸“é—¨ç”¨ä½œä¸ƒå±‚çš„è´Ÿè½½å‡è¡¡&amp;ndash;Ingressã€‚ç¬¬ä¸€æ‰¹å®ç°Ingress Controllerçš„å°±æ˜¯traefikä»¥åŠNginx Ingressï¼Œåæ¥éšç€Envoryçš„å‡ºç°ï¼Œä¹Ÿé€æ¸æ¶Œç°å‡ºäº†è¶Šæ¥è¶Šå¤šçš„Ingress Controllerå®ç°ï¼Œæ¯”å¦‚ï¼š
 https://github.com/heptio/contour https://github.com/datawire/ambassador https://github.com/istio/istio/  ä½†æ˜¯è¿™äº›å®ç°çš„åŸç†è¯´åˆ°åº•å°±æ˜¯watchåç«¯çš„Serviceï¼Œç„¶ååˆ›å»ºå¯¹äºçš„è®¿é—®è§„åˆ™ã€‚
Install ä»¥Nginx Ingressä¸ºä¾‹ï¼Œç”±Goï¼ŒLuaå’ŒCä¸‰ç§è¯­è¨€ç»„æˆï¼ŒGoè´Ÿè´£ä¸k8s APIäº¤äº’ï¼Œä¸‹é¢ç®€å•ä»‹ç»ä¸€äº›å®‰è£…è¿‡ç¨‹ã€‚
1#é¦–å…ˆå®‰è£…æ§åˆ¶å™¨ï¼Œ 2kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/master/deploy/mandatory.yaml 3#ç„¶ååˆ›å»ºService 4kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/master/deploy/provider/baremetal/service-nodeport.yaml ä»¥ä¸Šæ˜¯å±äºBate-metalçš„é…ç½®ï¼Œå¦‚æœä½ æ˜¯åœ¨Public CLoudå¯ä»¥æ›¿æ¢ä¸ºLoadBalancerã€‚ä»”ç»†è§‚å¯Ÿä¸€ä¸‹ç¬¬ä¸€ä¸ªyamlæ–‡ä»¶ï¼Œå¯ä»¥å‘ç°æœ‰äº›ç‰¹æ®Šçš„åœ°æ–¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œæœ‰ä¸€ä¸ªç‰¹æ®Šçš„annotationsï¼Œçœ‹æ¥å’ŒAPIServerç±»ä¼¼ï¼Œæ”¯æŒå¤šå‰¯æœ¬é«˜å¯ç”¨ã€‚
I0411 09:11:06.783582 7 leaderelection.go:227] successfully acquired lease ingress-nginx/ingress-controller-leader-nginx
1kubectl -n ingress-nginx get cm ingress-controller-leader-nginx -oyaml 2apiVersion: v1 3kind: ConfigMap 4metadata: 5 annotations: 6 control-plane.alpha.kubernetes.io/leader: &amp;#39;{&amp;#34;holderIdentity&amp;#34;:&amp;#34;nginx-ingress-controller-85f9f75759-4wb8k&amp;#34;,&amp;#34;leaseDurationSeconds&amp;#34;:30,&amp;#34;acquireTime&amp;#34;:&amp;#34;2019-04-11T09:11:06Z&amp;#34;,&amp;#34;renewTime&amp;#34;:&amp;#34;2019-04-11T13:12:56Z&amp;#34;,&amp;#34;leaderTransitions&amp;#34;:0}&amp;#39; 7 creationTimestamp: &amp;#34;2019-04-11T09:11:06Z&amp;#34; 8 name: ingress-controller-leader-nginx 9 namespace: ingress-nginx 10 resourceVersion: &amp;#34;28998&amp;#34; 11 selfLink: /api/v1/namespaces/ingress-nginx/configmaps/ingress-controller-leader-nginx 12 uid: bd25d320-5c39-11e9-af65-00163e132347 å› ä¸ºNginxåŸç”Ÿæ”¯æŒå››å±‚è´Ÿè½½å‡è¡¡ï¼Œæ‰€æœ‰Nginx Ingressä¹Ÿæ˜¯æ”¯æŒå››å±‚çš„ã€‚</description>
    </item>
    
    <item>
      <title>Kubernetes ä¸­çš„ç½‘ç»œç»“æ„</title>
      <link>https://example.com/posts/kubernetes-network-flannel/</link>
      <pubDate>Tue, 12 Feb 2019 22:31:20 +0800</pubDate>
      
      <guid>https://example.com/posts/kubernetes-network-flannel/</guid>
      <description>Kubernetes é‡‡ç”¨çš„æ˜¯åŸºäºæ‰å¹³åœ°å€ç©ºé—´çš„ç½‘ç»œæ¨¡å‹ï¼Œé›†ç¾¤ä¸­çš„æ¯ä¸ª Pod éƒ½æœ‰è‡ªå·±çš„ IP åœ°å€ï¼ŒPod ä¹‹é—´ä¸éœ€è¦é…ç½® NAT å°±èƒ½ç›´æ¥é€šä¿¡ã€‚å¦å¤–ï¼ŒåŒä¸€ä¸ª Pod ä¸­çš„å®¹å™¨å…±äº« Pod çš„ IPï¼Œèƒ½å¤Ÿé€šè¿‡ localhost é€šä¿¡ã€‚
  IP-per-Podï¼Œæ¯ä¸ª Pod éƒ½æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹ IP åœ°å€ï¼ŒPod å†…æ‰€æœ‰å®¹å™¨å…±äº«ä¸€ä¸ªç½‘ç»œå‘½åç©ºé—´
  é›†ç¾¤å†…æ‰€æœ‰ Pod éƒ½åœ¨ä¸€ä¸ªç›´æ¥è¿é€šçš„æ‰å¹³ç½‘ç»œä¸­ï¼Œå¯é€šè¿‡ IP ç›´æ¥è®¿é—®
 æ‰€æœ‰å®¹å™¨ä¹‹é—´æ— éœ€ NAT å°±å¯ä»¥ç›´æ¥äº’ç›¸è®¿é—® æ‰€æœ‰ Node å’Œæ‰€æœ‰å®¹å™¨ä¹‹é—´æ— éœ€ NAT å°±å¯ä»¥ç›´æ¥äº’ç›¸è®¿é—® å®¹å™¨è‡ªå·±çœ‹åˆ°çš„ IP è·Ÿå…¶ä»–å®¹å™¨çœ‹åˆ°çš„ä¸€æ ·    æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å…ˆä»‹ç»ä¸€ä¸‹å‡ ä¸ªæ¦‚å¿µï¼Œ
 Service cluster IP å°½å¯åœ¨é›†ç¾¤å†…éƒ¨è®¿é—®ï¼Œå¤–éƒ¨è¯·æ±‚éœ€è¦é€šè¿‡ NodePortã€LoadBalance æˆ–è€… Ingress æ¥è®¿é—® ç½‘ç»œçš„å‘½åç©ºé—´ï¼šLinuxåœ¨ç½‘ç»œæ ˆä¸­å¼•å…¥ç½‘ç»œå‘½åç©ºé—´ï¼Œå°†ç‹¬ç«‹çš„ç½‘ç»œåè®®æ ˆéš”ç¦»åˆ°ä¸åŒçš„å‘½ä»¤ç©ºé—´ä¸­ï¼Œå½¼æ­¤é—´æ— æ³•é€šä¿¡ï¼›dockeråˆ©ç”¨è¿™ä¸€ç‰¹æ€§ï¼Œå®ç°ä¸å®¹å™¨é—´çš„ç½‘ç»œéš”ç¦»ã€‚ Vethè®¾å¤‡å¯¹ï¼šVethè®¾å¤‡å¯¹çš„å¼•å…¥æ˜¯ä¸ºäº†å®ç°åœ¨ä¸åŒç½‘ç»œå‘½åç©ºé—´çš„é€šä¿¡ã€‚ Iptables/Netfilterï¼šNetfilterè´Ÿè´£åœ¨å†…æ ¸ä¸­æ‰§è¡Œå„ç§æŒ‚æ¥çš„è§„åˆ™(è¿‡æ»¤ã€ä¿®æ”¹ã€ä¸¢å¼ƒç­‰)ï¼Œè¿è¡Œåœ¨å†…æ ¸ æ¨¡å¼ä¸­ï¼›Iptablesæ¨¡å¼æ˜¯åœ¨ç”¨æˆ·æ¨¡å¼ä¸‹è¿è¡Œçš„è¿›ç¨‹ï¼Œè´Ÿè´£ååŠ©ç»´æŠ¤å†…æ ¸ä¸­Netfilterçš„å„ç§è§„åˆ™è¡¨ï¼›é€šè¿‡äºŒè€…çš„é…åˆæ¥å®ç°æ•´ä¸ªLinuxç½‘ç»œåè®®æ ˆä¸­çµæ´»çš„æ•°æ®åŒ…å¤„ç†æœºåˆ¶ã€‚ ç½‘æ¡¥ï¼šç½‘æ¡¥æ˜¯ä¸€ä¸ªäºŒå±‚ç½‘ç»œè®¾å¤‡,é€šè¿‡ç½‘æ¡¥å¯ä»¥å°†linuxæ”¯æŒçš„ä¸åŒçš„ç«¯å£è¿æ¥èµ·æ¥,å¹¶å®ç°ç±»ä¼¼äº¤æ¢æœºé‚£æ ·çš„å¤šå¯¹å¤šçš„é€šä¿¡ã€‚ è·¯ç”±ï¼šLinuxç³»ç»ŸåŒ…å«ä¸€ä¸ªå®Œæ•´çš„è·¯ç”±åŠŸèƒ½ï¼Œå½“IPå±‚åœ¨å¤„ç†æ•°æ®å‘é€æˆ–è½¬å‘çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨è·¯ç”±è¡¨æ¥å†³å®šå‘å¾€å“ªé‡Œ  å¦‚ä»Šï¼ŒKubernetesæ”¹å˜äº†è½¯ä»¶å¼€å‘çš„å®Œæˆæ–¹å¼ã€‚ä½œä¸ºç”¨äºç®¡ç†å®¹å™¨åŒ–å·¥ä½œè´Ÿè½½å’ŒæœåŠ¡çš„ä¾¿æºå¼ï¼Œå¯æ‰©å±•çš„å¼€æºå¹³å°ï¼Œè¯¥å¹³å°å¯ä¿ƒè¿›å£°æ˜å¼é…ç½®å’Œè‡ªåŠ¨åŒ–ï¼ŒKuberneteså·²è¯æ˜è‡ªå·±æ˜¯ç®¡ç†å¤æ‚å¾®æœåŠ¡çš„ä¸»å¯¼è€…ã€‚å®ƒçš„å—æ¬¢è¿ç¨‹åº¦æºäºKubernetesæ»¡è¶³ä»¥ä¸‹éœ€æ±‚çš„äº‹å®ï¼šä¼ä¸šå¸Œæœ›å¢é•¿å’Œå‡å°‘æ”¯ä»˜ï¼ŒDevOpséœ€è¦ä¸€ä¸ªç¨³å®šçš„å¹³å°ï¼Œå¯ä»¥å¤§è§„æ¨¡è¿è¡Œåº”ç”¨ç¨‹åºï¼Œå¼€å‘äººå‘˜æƒ³è¦å¯é ä¸”å¯å¤åˆ¶çš„æµç¨‹æ¥ç¼–å†™ï¼Œæµ‹è¯•å’Œè°ƒè¯•ä»£ç ã€‚è¿™æ˜¯ä¸€ç¯‡å¾ˆå¥½çš„æ–‡ç« ï¼Œå¯ä»¥äº†è§£æœ‰å…³Kubernetesæ¼”åŒ–å’Œæ¶æ„çš„æ›´å¤šä¿¡æ¯ã€‚
ç®¡ç†Kubernetesç½‘ç»œçš„é‡è¦é¢†åŸŸä¹‹ä¸€æ˜¯åœ¨å†…éƒ¨å’Œå¤–éƒ¨è½¬å‘å®¹å™¨ç«¯å£ï¼Œä»¥ç¡®ä¿å®¹å™¨å’ŒPodå¯ä»¥æ­£ç¡®ç›¸äº’é€šä¿¡ã€‚ä¸ºäº†ç®¡ç†æ­¤ç±»é€šä¿¡ï¼ŒKubernetesæä¾›ä»¥ä¸‹å››ç§è”ç½‘æ¨¡å‹ï¼š
 å®¹å™¨åˆ°å®¹å™¨é€šä¿¡ ç‚¹å¯¹ç‚¹é€šè®¯ Podåˆ°Serviceé€šè®¯ å¯¹å¤–æ²Ÿé€š  åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å‘æ‚¨å±•ç¤ºKubernetesç½‘ç»œä¸­çš„Podå¯ä»¥ç›¸äº’é€šä¿¡çš„æ–¹å¼ï¼Œæ·±å…¥æ¢è®¨Podåˆ°Podçš„é€šä¿¡ã€‚</description>
    </item>
    
    <item>
      <title>k8s é›†ç¾¤ç›‘æ§ --  Prometheus Operator</title>
      <link>https://example.com/posts/promthus-operator/</link>
      <pubDate>Tue, 22 Jan 2019 22:31:20 +0800</pubDate>
      
      <guid>https://example.com/posts/promthus-operator/</guid>
      <description>å¯¹äºä»»ä½•ç³»ç»Ÿæ¥è¯´ï¼Œç›‘æ§éƒ½æ˜¯ä¸å¯æˆ–ç¼ºçš„ä¸œè¥¿ï¼Œç³»ç»Ÿç°åœ¨æ˜¯ä»€ä¹ˆæ ·ï¼Œä¸ä¸€å‘¨å‰ç›¸æ¯”æ˜¯å¦éœ€è¦è°ƒæ•´èµ„æºç­‰éƒ½éœ€è¦ä¸€ä¸ªç›‘æ§ç³»ç»Ÿæ¥å‚è€ƒã€‚å¯¹äºk8sæ¥è¯´å¸¸ç”¨çš„å¼€æºç›‘æ§æ–¹æ¡ˆä¹Ÿå°±æ˜¯ä¸‹é¢å‡ ç§ï¼š
 heaspter+InfluxDB (å·²è¢«å¼ƒç”¨) Prometheus Open falcon Telegraf+InfluxDB  è€Œä¸”k8sæ‰€éœ€çš„ç›‘æ§é¡¹ç›®æ˜¯æ¯”è¾ƒå¤šçš„ï¼Œå¦‚ä¸‹è¡¨ï¼š(k8s 1.14.0)    ç›‘æ§ç»„ä»¶ metric PATï¼¨     API Server 6443/metrics   Controller ï¼­anager 10257/metrics   kube Scheduler 10259/metrics   Etcd 2379/metrics   Kubelet API 10252/metrics   Cadvisor 10250/metrics/cadvisor   Node 9100/metrics    å› æ­¤æƒ³è¦å…¨é¢çš„ç›‘æ§é›†ç¾¤çŠ¶æ€ï¼Œæˆ‘ä¸ªäººæ„Ÿè§‰Prometheusæ˜¯æ¯”è¾ƒåˆé€‚çš„ï¼Œä½†æ˜¯å½“ä½ ä¿®æ”¹ä¾æ¬¡è§„åˆ™å°±éœ€è¦é‡å¯ä¸€æ¬¡ã€‚è€Œä¸”äº‘åŸç”Ÿä¸­æ¯”è¾ƒæ¨èä½¿ç”¨å£°æ˜å¼ä»£æ›¿å‘½ä»¤å¼ï¼Œäºæ˜¯Prometheus Operatorå°±è¯ç”Ÿäº†ï¼Œæ•´ä½“ç»“æ„å¦‚ä¸‹å›¾ï¼š
Install ä¸ªäººæ¨èçš„æ–¹å¼æ˜¯ä»repoä¸­applyä¸€å †yamlï¼Œå¦‚æœä½ æ“…é•¿helmï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ã€‚
1git clone https://github.com/coreos/prometheus-operator 2kubectl get crd 3NAME CREATED AT 4alertmanagers.monitoring.coreos.com 2018-09-12T02:13:19Z 5prometheuses.monitoring.coreos.com 2018-09-12T02:13:19Z 6prometheusrules.</description>
    </item>
    
    <item>
      <title>ä¸€ä¸ªå®Œæ•´çš„Pod æè¿°åº”è¯¥æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ</title>
      <link>https://example.com/posts/k8s-pod-full-yaml/</link>
      <pubDate>Tue, 25 Dec 2018 22:31:20 +0800</pubDate>
      
      <guid>https://example.com/posts/k8s-pod-full-yaml/</guid>
      <description>Podä½œä¸ºk8så·¥ä½œè´Ÿè½½çš„åŸºæœ¬å•ä½,ä¸è®ºæ˜¯Deploymentè¿˜æ˜¯jobç­‰ç­‰éœ€è¦è®¡ç®—èµ„æºçš„æ§åˆ¶å™¨ï¼Œéƒ½éœ€è¦å®šä¹‰å°†è¢«åˆ›å»ºçš„podæ¨¡æ¿ï¼Œæ‰€ä»¥ç†Ÿæ‚‰podçš„æ‰€æœ‰å­—æ®µè¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚ä»Šå¤©å°±ç”¨Deploymentä½œä¸ºä¾‹å­ï¼Œçœ‹ä¸€ä¸‹ä¸€ä¸ªå®Œæ•´podæ¨¡æ¿åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚
Deploymentå¤§è‡´å¯ä»¥åˆ†ä¸ºäº”ä¸ªå­—æ®µï¼Œå¯ä»¥ç”¨kubectl explain deployå‘½ä»¤æŸ¥çœ‹ã€‚å‰ä¸¤ä¸ªå­—æ®µåˆ†åˆ«ä¸ºapiverionå’Œkindï¼Œå°±ä¸ç”¨å¤šè¯´äº†ï¼Œåä¸‰ä¸ªå­—æ®µæ˜¯metadataï¼Œspecå’Œk8sç”Ÿæˆçš„statusï¼Œå®¹æˆ‘æ…¢æ…¢è®²æ¥ã€‚
ä¸‰å¤§æè¿° metadata æ­¤éƒ¨åˆ†ä¸»è¦å®šä¹‰äº†podçš„å±æ€§ä¿¡æ¯ï¼Œæ³¨è§£å’Œæ ‡ç­¾ï¼Œåå­—ï¼Œå½’å±ä¿¡æ¯ï¼Œæ˜¯è¢«å“ªä¸ªæ§åˆ¶å™¨åˆ›å»ºçš„ï¼Œpod-template-hashæ˜¯å¿…å®šå­˜åœ¨çš„æ ‡ç­¾ï¼Œä»”ç»†çœ‹ä¼šå‘ç°å’Œrsçš„åå­—åé¢æ˜¯ç›¸åŒçš„ã€‚ ç¤ºä¾‹ï¼š
metadata: creationTimestamp: &amp;quot;2019-05-18T05:13:16Z&amp;quot; generateName: nginx-6c885545f8- labels: pod-template-hash: 6c885545f8 run: nginx name: nginx-6c885545f8-gl8gc namespace: default ownerReferences: - apiVersion: apps/v1 blockOwnerDeletion: true controller: true kind: ReplicaSet name: nginx-6c885545f8 uid: a4dfdd64-792b-11e9-8da2-00163e132347 resourceVersion: &amp;quot;1178868&amp;quot; selfLink: /api/v1/namespaces/default/pods/nginx-6c885545f8-gl8gc uid: a4e0e290-792b-11e9-8da2-00163e132347 spec ç»ˆäºåˆ°äº†podçš„æè¿°éƒ¨åˆ†ï¼Œæœ€ä¸»è¦çš„containerséƒ¨åˆ†å°±æ˜¯åœ¨è¿™é‡Œå®šä¹‰çš„ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªobjectï¼Œæˆ‘ä»¬çŸ¥é“podå†…çš„containerså­˜å‚¨å’Œç½‘ç»œç­‰èµ„æºæ˜¯å…±äº«çš„ï¼ŒCPUå’Œmemoryä¹Ÿæ˜¯å¯ä»¥éš”ç¦»çš„ï¼Œé»˜è®¤æŒ‚è½½äº†ä¸€ä¸ªvolumeï¼Œä¹Ÿå°±æ˜¯serviceaccountç”¨æ¥åœ¨å†…éƒ¨è®¿é—®APIServeræ‰€ç”¨çš„tokenï¼ŒCAä¿¡æ¯ã€‚ æŒ‰ç§ç±»å¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ ç§
  è°ƒåº¦ç›¸å…³
 affinity äº²å’Œæ€§ åˆ†ä¸ºnodeAffinity podAffinity podAntiAffinityä¸‰ç§ nodeName èŠ‚ç‚¹åå­— é»˜è®¤ç”±è°ƒåº¦å™¨åˆ†é… nodeSelector èŠ‚ç‚¹é€‰æ‹©å™¨ schedulerName è°ƒåº¦å™¨åå­— tolerations å®¹å¿    ç”Ÿå‘½å‘¨æœŸ
 initContainers åˆå§‹åŒ–å®¹å™¨ containers çš„ lifecycle åŒ…æ‹¬preStartå’ŒpreStopè„šæœ¬ restartPolicy é‡å¯ç­–ç•¥ Always, OnFailure,Never.</description>
    </item>
    
    <item>
      <title>Kubernetes ä¸­çš„èµ„æºç®¡ç†å’Œä¼˜å…ˆçº§</title>
      <link>https://example.com/posts/k8s-resource-qos/</link>
      <pubDate>Tue, 09 Oct 2018 22:31:20 +0800</pubDate>
      
      <guid>https://example.com/posts/k8s-resource-qos/</guid>
      <description>Kubernetes æ˜¯æ€ä¹ˆå®šä¹‰èµ„æºçš„å‘¢ï¼Ÿ
â€‹	åœ¨ kubernetes ä¸­ï¼Œä»»ä½•å¯ä»¥è¢«ç”³è¯·ã€åˆ†é…ï¼Œæœ€ç»ˆè¢«ä½¿ç”¨çš„å¯¹è±¡ï¼Œéƒ½æ˜¯ kubernetes ä¸­çš„èµ„æºï¼Œæ¯”å¦‚ CPUã€å†…å­˜ã€‚è€Œä¸”é’ˆå¯¹æ¯ä¸€ç§è¢« kubernetes æ‰€ç®¡ç†çš„èµ„æºï¼Œéƒ½ä¼šè¢«èµ‹äºˆä¸€ä¸ªã€èµ„æºç±»å‹åã€‘ï¼Œè¿™äº›åå­—éƒ½æ˜¯ç¬¦åˆ RFC 1123 è§„åˆ™çš„ï¼Œæ¯”å¦‚ CPUï¼Œå®ƒå¯¹åº”çš„èµ„æºåå…¨ç§°ä¸º kubernetes.io/cpuï¼ˆåœ¨å±•ç¤ºæ—¶ä¸€èˆ¬ç›´æ¥ç®€å†™ä¸º cpuï¼‰ï¼›GPU èµ„æºå¯¹åº”çš„èµ„æºåä¸º alpha.kubernetes.io/nvidia-gpuã€‚
â€‹	é™¤äº†åå­—ä»¥å¤–ï¼Œé’ˆå¯¹æ¯ä¸€ç§èµ„æºè¿˜ä¼šå¯¹åº”æœ‰ä¸”ä»…æœ‰ä¸€ç§ã€åŸºæœ¬å•ä½ã€‘ã€‚è¿™ä¸ªåŸºæœ¬å•ä½ä¸€èˆ¬æ˜¯åœ¨ kubernetes ç»„ä»¶å†…éƒ¨ç»Ÿä¸€ç”¨æ¥è¡¨ç¤ºè¿™ç§èµ„æºçš„æ•°é‡çš„ï¼Œæ¯”å¦‚ memory çš„åŸºæœ¬å•ä½å°±æ˜¯å­—èŠ‚ã€‚ä½†æ˜¯ä¸ºäº†æ–¹ä¾¿å¼€å‘è€…ä½¿ç”¨ï¼Œåœ¨å¼€å‘è€…é€šè¿‡ yaml æ–‡ä»¶æˆ–è€… kubectl åŒ kubernetes è¿›è¡Œäº¤äº’æ—¶ä»å¯ä»¥ä½¿ç”¨å¤šç§å¯è¯»æ€§æ›´å¥½çš„èµ„æºå•ä½ï¼Œæ¯”å¦‚å†…å­˜çš„ Giã€‚è€Œå½“è¿™äº›ä¿¡æ¯è¿›å…¥ kubernetes å†…éƒ¨åï¼Œè¿˜æ˜¯ä¼šè¢«æ˜¾å¼çš„è½¬æ¢ä¸ºæœ€åŸºæœ¬å•ä½ã€‚
â€‹	æ‰€æœ‰çš„èµ„æºç±»å‹ï¼Œåˆå¯ä»¥è¢«åˆ’åˆ†ä¸ºä¸¤å¤§ç±»ï¼šå¯å‹ç¼©(compressible)å’Œä¸å¯å‹ç¼©(incompressible)çš„ã€‚å…¶è¯„åˆ¤æ ‡å‡†å°±åœ¨äºï¼šå¦‚æœç³»ç»Ÿé™åˆ¶æˆ–è€…ç¼©å°å®¹å™¨å¯¹å¯å‹ç¼©èµ„æºçš„ä½¿ç”¨çš„è¯ï¼Œåªä¼šå½±å“æœåŠ¡å¯¹å¤–çš„æœåŠ¡æ€§èƒ½ï¼Œæ¯”å¦‚ CPU å°±æ˜¯ä¸€ç§éå¸¸å…¸å‹çš„å¯å‹ç¼©èµ„æºã€‚å¯¹äºä¸å¯å‹ç¼©èµ„æºæ¥è¯´ï¼Œèµ„æºçš„ç´§ç¼ºæ˜¯æœ‰å¯èƒ½å¯¼è‡´æœåŠ¡å¯¹å¤–ä¸å¯ç”¨çš„ï¼Œæ¯”å¦‚å†…å­˜å°±æ˜¯ä¸€ç§éå¸¸å…¸å‹çš„ä¸å¯å‹ç¼©èµ„æºã€‚
Kubernetes ä¸­æœ‰å“ªå‡ ç±»èµ„æºå‘¢ï¼Ÿ
â€‹	ç›®å‰ kubernetes é»˜è®¤å¸¦æœ‰ä¸¤ç±»åŸºæœ¬èµ„æºCPUå’ŒMemoryã€‚å…¶ä¸­ CPUï¼Œä¸ç®¡åº•å±‚çš„æœºå™¨æ˜¯é€šè¿‡ä½•ç§æ–¹å¼æä¾›çš„ï¼ˆç‰©ç†æœº or è™šæ‹Ÿæœºï¼‰ï¼Œä¸€ä¸ªå•ä½çš„ CPU èµ„æºéƒ½ä¼šè¢«æ ‡å‡†åŒ–ä¸ºä¸€ä¸ªæ ‡å‡†çš„ &amp;ldquo;Kubernetes Compute Unit&amp;rdquo; ï¼Œå¤§è‡´å’Œ x86 å¤„ç†å™¨çš„ä¸€ä¸ªå•ä¸ªè¶…çº¿ç¨‹æ ¸å¿ƒæ˜¯ç›¸åŒçš„ã€‚CPU èµ„æºçš„åŸºæœ¬å•ä½æ˜¯ millicoresï¼Œå› ä¸º CPU èµ„æºå…¶å®å‡†ç¡®æ¥è®²ï¼ŒæŒ‡çš„æ˜¯ CPU æ—¶é—´ã€‚æ‰€ä»¥å®ƒçš„åŸºæœ¬å•ä½ä¸º millicoresï¼Œ1 ä¸ªæ ¸ç­‰äº 1000 millicoresã€‚ä¹Ÿä»£è¡¨äº† kubernetes å¯ä»¥å°†å•ä½ CPU æ—¶é—´ç»†åˆ†ä¸º 1000 ä»½ï¼Œåˆ†é…ç»™æŸä¸ªå®¹å™¨ã€‚å†…å­˜memory èµ„æºçš„åŸºæœ¬å•ä½æ¯”è¾ƒå¥½ç†è§£ï¼Œå°±æ˜¯å­—èŠ‚ã€‚å¦å¤–ï¼Œkubernetes é’ˆå¯¹ç”¨æˆ·çš„è‡ªå®šåˆ¶éœ€æ±‚ï¼Œè¿˜ä¸ºç”¨æˆ·æä¾›äº† device plugin æœºåˆ¶ï¼Œè®©ç”¨æˆ·å¯ä»¥å°†èµ„æºç±»å‹è¿›ä¸€æ­¥æ‰©å……ï¼Œæ¯”å¦‚ç°åœ¨æ¯”è¾ƒå¸¸ç”¨çš„ nvidia gpu èµ„æºã€‚è¿™ä¸ªç‰¹æ€§å¯ä»¥ä½¿ç”¨æˆ·èƒ½å¤Ÿåœ¨ kubernetes ä¸­ç®¡ç†è‡ªå·±ä¸šåŠ¡ä¸­ç‰¹æœ‰çš„èµ„æºï¼Œå¹¶ä¸”æ— éœ€ä¿®æ”¹ kubernetes è‡ªèº«æºç ã€‚è€Œä¸” kubernetes è‡ªèº«åç»­è¿˜ä¼šè¿›ä¸€æ­¥æ”¯æŒæ›´å¤šéå¸¸é€šç”¨çš„èµ„æºç±»å‹ï¼Œæ¯”å¦‚ç½‘ç»œå¸¦å®½ã€å­˜å‚¨ç©ºé—´ã€å­˜å‚¨ iops ç­‰ç­‰ã€‚æ‰€ä»¥å¦‚ä¸Šï¼Œæˆ‘ä»¬å°±å›ç­”äº† kubernetes æ˜¯å¦‚ä½•å®šä¹‰èµ„æºçš„é—®é¢˜ã€‚</description>
    </item>
    
    <item>
      <title>fluent äº‘åŸç”Ÿçš„ä¸‹çš„æ—¥å¿—æ”¶é›†å·¥å…·</title>
      <link>https://example.com/posts/fluentd/</link>
      <pubDate>Tue, 25 Sep 2018 12:31:20 +0800</pubDate>
      
      <guid>https://example.com/posts/fluentd/</guid>
      <description>Fluentd æ˜¯å¦ä¸€ä¸ª Ruby è¯­è¨€ç¼–å†™çš„æ—¥å¿—æ”¶é›†ç³»ç»Ÿã€‚å’Œ Logstash ä¸åŒçš„æ˜¯ï¼ŒFluentd æ˜¯åŸºäº MRI å®ç°çš„ï¼Œå¹¶ä¸æ˜¯åˆ©ç”¨å¤šçº¿ç¨‹ï¼Œè€Œæ˜¯åˆ©ç”¨äº‹ä»¶é©±åŠ¨ã€‚å•ä¸ªæ—¥å¿—å¤„ç†çš„æµç¨‹å¦‚ä¸‹ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å¤šä¸ªæ—¥å¿—æµä¸€åŒå¤„ç†ã€‚
è¿™é‡Œç©¿æ’ä¸€ä¸‹Docker çš„æ—¥å¿—æ ¼å¼ï¼Œé»˜è®¤çš„æ˜¯json-fileï¼Œåˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªå­—æ®µï¼Œå½“ç„¶ä¹Ÿæœ‰åˆ«çš„driverï¼Œä½†æ˜¯ä¼šå¯¼è‡´docker logsä¸èƒ½ä½¿ç”¨ï¼Œä¹Ÿå°±æ²¡æœ‰å°è¯•ã€‚
1 &amp;#34;log&amp;#34;: &amp;#34;10.244.0.1 - - [21/Dec/2018:13:06:52 +0000] \&amp;#34;GET / HTTP/1.1\&amp;#34; 200,&amp;#34; 2 &amp;#34;stream&amp;#34;: &amp;#34;stdout&amp;#34;, 3 &amp;#34;time&amp;#34;: &amp;#34;2018-12-21T13:06:52.182042579Z&amp;#34; 4} é…ç½® fluentdé…ç½®ä¸»è¦ç”±ä»¥ä¸‹5éƒ¨åˆ†ç»„æˆ
 sourceï¼šç¡®å®šè¾“å…¥æº matchï¼š ç¡®å®šè¾“å‡ºç›®çš„åœ° filterï¼šç¡®å®š event å¤„ç†æµ systemï¼šè®¾ç½®ç³»ç»ŸèŒƒå›´çš„é…ç½® labelï¼šå°†å†…éƒ¨è·¯ç”±çš„è¾“å‡ºå’Œè¿‡æ»¤å™¨åˆ†ç»„ @includeï¼šåŒ…æ‹¬å…¶å®ƒæ–‡ä»¶  ä¸‹é¢ä»¥k8sé¡¹ç›®æ—¥å¿—æ”¶é›†é…ç½®ä¸ºå®ä¾‹ï¼Œä»‹ç»ä¸€ä¸‹ç›¸å…³é…ç½®ã€‚
æ•°æ®æº 1&amp;lt;source&amp;gt; 2 @id fluentd-containers.log 3 @type tail 4 path /var/log/containers/demo.log 5 pos_file /var/log/es-containers.log.pos 6 tag raw.kubernetes.* 7 read_from_head true 8 &amp;lt;parse&amp;gt; 9 @type multi_format 10 &amp;lt;pattern&amp;gt; 11 format json 12 time_key time 13 time_format %Y-%m-%dT%H:%M:%S.</description>
    </item>
    
    <item>
      <title>Kubernetes ä¸­çš„å¼¹æ€§ä¼¸ç¼© Autoscaler</title>
      <link>https://example.com/posts/cluster-autoscaler/</link>
      <pubDate>Tue, 25 Sep 2018 12:31:20 +0800</pubDate>
      
      <guid>https://example.com/posts/cluster-autoscaler/</guid>
      <description>å¼¹æ€§ä¼¸ç¼©æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸å¼•äººçš„è¯é¢˜ï¼Œç±»ä¼¼ä¸äº‘è®¡ç®—ä¸­æ‰€æå€¡çš„æŒ‰éœ€ä»˜è´¹ï¼Œåˆç†ä½¿ç”¨å¯ä»¥å‡å°‘æ‰€éœ€è®¡ç®—èµ„æºï¼Œé™ä½ç›¸å…³çš„æœåŠ¡å™¨æˆæœ¬ã€‚å¯¹äºk8sæ¥è¯´ç›®å‰ä¸€å…±æœ‰ä¸¤ç§å¼¹æ€§ä¼¸ç¼©ï¼š
 Cluster å³è‡ªåŠ¨å¢åŠ åˆ é™¤èŠ‚ç‚¹ Pod åˆ†ä¸ºæ°´å¹³å’Œå‚ç›´ä¸¤ç§ï¼Œæ°´å¹³ä¼¸ç¼©åœ¨k8sé‡Œå·²ç»æ”¯æŒï¼Œå‚ç›´ä¼¸ç¼©éœ€è¦å®‰è£…  ç›¸å…³repo https://github.com/kubernetes/autoscaler ï¼Œä¸‹é¢åˆ†åˆ«ä»‹ç»ä¸‹ç›¸å…³ä¿¡æ¯ã€‚
Node Cluster-autoscaler ClusterScalerå®‰è£…ç›¸å¯¹æ¥è¯´æ¯”è¾ƒç®€å•ï¼Œå’Œå…¶ä»–æ’ä»¶ç±»ä¼¼ï¼Œå®šä¹‰å¥½ServiceAccountï¼ŒDeploymentä»¥åŠä¼¸ç¼©ç»„ç­‰å³å¯ï¼Œä½†æ˜¯æ¯”è¾ƒå¼ºä¾é å…¬æœ‰äº‘ã€‚ç›®å‰æ”¯æŒçš„AliCloudï¼ŒAzureï¼ŒAWSï¼ŒBaiduCloudç­‰ï¼Œæ³¨æ„éœ€è¦é…ç½®Access Keyä»¥åŠæ ¹è¯ä¹¦ï¼ˆè®¿é—®APIæ—¶éœ€è¦ï¼‰ç­‰ä¿¡æ¯ã€‚å…³é”®é…ç½®å¦‚ä¸‹ï¼š
1 - ./cluster-autoscaler 2 - --v=4 3 - --stderrthreshold=info 4 - --cloud-provider=aws 5 - --skip-nodes-with-local-storage=false 6 - --scale-down-delay-after-add=3m 7 - --nodes=1:5:nodes.demo.k8s.local æŒ‰ç…§æ­£å¸¸æ­¥éª¤ï¼Œå‘é›†ç¾¤æ·»åŠ èŠ‚ç‚¹ä¸€å…±éœ€è¦ä¸‰æ­¥ï¼š
 æ–°å¼€ä¸€å°æœºå™¨ï¼Œ é…ç½®bootstap tokenç­‰ä¿¡æ¯ï¼Œ æœ€ååŠ å…¥é›†ç¾¤ã€‚  ClusterScalerç›¸å½“äºæ›¿æˆ‘ä»¬åšäº†è¿™äº›å·¥ä½œï¼Œä»”ç»†é˜…è¯»ç›¸å…³æ–‡æ¡£ï¼Œå¯ä»¥çœ‹åˆ°é˜¿é‡Œäº‘ä¾èµ–çš„æ˜¯ESSï¼Œè€Œkopsä¸‹çš„awsä¾èµ–çš„æ˜¯ASGï¼ˆauto scaling groupï¼‰ï¼Œé€šè¿‡è‡ªåŠ¨ä¼¸ç¼©ç»„å¯ä»¥å‡ ä¹æ— å¹²é¢„çš„å®Œæˆæ‰©å®¹ã€‚
è¿™é‡Œç©¿æ’ä¸€ä¸ªå°çŸ¥è¯†ï¼Œå¯¹äºå¤§å¤šæ•°å…¬æœ‰äº‘æ¥è¯´ï¼Œéƒ½æ”¯æŒä¸€ä¸ªå«åšcloud-initçš„ä¸œè¥¿ï¼Œä¹Ÿå«åšuser dataï¼Œä¹Ÿå°±æ˜¯åœ¨æœºå™¨åˆå§‹åŒ–çš„æ—¶å€™æ‰§è¡Œçš„ä¸€æ®µshellè„šæœ¬ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸Šé¢çš„ç¬¬äºŒæ­¥ã€‚
é‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•åˆ¤æ–­é›†ç¾¤éœ€è¦æ‰©å®¹ã€ç¼©å®¹å‘¢ï¼Ÿæˆ‘ä»¬å…ˆå¯åŠ¨ä¸€ä¸ªrequestä¸º4C8Gçš„nginxåšæµ‹è¯•ï¼Œæˆ–è€…æ˜¯5ä¸ª1C2Gçš„nginxï¼Œç›®çš„å°±æ˜¯è¶…è¿‡ç°æœ‰é›†ç¾¤å‰©ä½™çš„è®¡ç®—èµ„æºï¼Œæ­£å¸¸æƒ…å†µä¸‹ä¸€å®šä¼šæœ‰podå¤„äºpendingçŠ¶æ€ï¼Œè¿™æ—¶å€™é€šè¿‡è§‚å¯Ÿæ—¥å¿—å¯ä»¥å‘ç°ï¼ŒClusterScalerå°±ä¼šè§¦å‘æ‰©å®¹èŠ‚ç‚¹ã€‚
I0408 04:46:52.022024 1 scale_up.go:249] Pod default/demo-589b486fbb-r5fn4 is unschedulable I0408 04:46:52.022039 1 scale_up.go:249] Pod default/demo-589b486fbb-rzlpn is unschedulable æºç åœ¨https://github.com/kubernetes/autoscaler/blob/cluster-autoscaler-1.2.2/cluster-autoscaler/core/scale_up.go#L59
Pod HPA æ°´å¹³ä¼¸ç¼© ç°åœ¨å®˜æ–¹æ”¯æŒçš„å°±æ˜¯HorizontalPodAutoscalerï¼Œå¯ä»¥æ ¹æ®CPUå’Œmemoryä½¿ç”¨æƒ…å†µæ¥åˆ¤æ–­ä¼¸ç¼©ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¼¸ç¼©çš„æ¡ä»¶æ˜¯CPUåˆ©ç”¨ç‡è¶…è¿‡å¤šå°‘å°±è§¦å‘æ‰©å®¹ï¼Œæ‰€ä»¥è‡³å°‘éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œpodç°åœ¨çš„CPUï¼Œä»¥åŠå®ƒrequestçš„CPUï¼Œ æ‰€ä»¥æˆ‘ä»¬é¦–å…ˆéœ€è¦éƒ¨ç½²metric-serverï¼Œç”¨æ¥è·å–podçš„å®æ—¶CPUä½¿ç”¨æƒ…å†µã€‚ https://github.</description>
    </item>
    
    <item>
      <title>terraform provider Kubernetes å…¥é—¨</title>
      <link>https://example.com/posts/terraform/</link>
      <pubDate>Mon, 17 Sep 2018 11:31:20 +0800</pubDate>
      
      <guid>https://example.com/posts/terraform/</guid>
      <description>ä¸‹è½½
åˆå§‹åŒ– terraform æ‰©å±•ä¸»è¦é çš„å°±æ˜¯providerï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨ä¹‹å‰éœ€è¦å‡†å¤‡å¥½æˆ–è€…ä¸‹è½½å¯¹åº”çš„providerã€‚è‡³äºä½ éœ€è¦ä»€ä¹ˆproviderï¼Œéœ€è¦åœ¨main.tfæŒ‡å®šï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚
å¦‚æœå¯ä»¥è”ç½‘çš„è¯ï¼Œè²Œä¼¼ä¼šä»fastlyçš„CDNä¸Šä¸‹è½½ï¼Œé»˜è®¤æ”¾åœ¨~/.terraform/pluginsç›®å½•ï¼Œç¦»çº¿å®‰è£…æˆ–è€…è‡ªå·±buildçš„è¯ä¹Ÿå¯ä»¥æ”¾åœ¨å¯¹åº”çš„ç›®å½•å³å¯ã€‚
terraformé»˜è®¤ä¼šè¯»å–kubeconfigçš„é»˜è®¤é…ç½®ï¼Œæœ‰ç‚¹ç»•å£ï¼Œä¹Ÿå¯ä»¥è‡ªå·±é…ç½®å¯¹åº”çš„è¯ä¹¦æˆ–è€…basic authï¼Œè¿™ä¸€ç‚¹å¯ä»¥å»çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œæˆ‘é…ç½®çš„å°±æ˜¯è¯»å–é»˜è®¤é…ç½®ã€‚ç„¶åå°±å°±å¯ä»¥åˆå§‹åŒ–å»ä¸‹è½½k8sçš„provideräº†ã€‚
1cat main.tf 2provider &amp;#34;kubernetes&amp;#34; {} 3# åˆå§‹åŒ– 4terraform init 5 6Initializing the backend... 7 8Initializing provider plugins... 9- Checking for available provider plugins... 10- Downloading plugin for provider &amp;#34;kubernetes&amp;#34; (hashicorp/kubernetes) 1.9.0... 11 12The following providers do not have any version constraints in configuration, 13so the latest version was installed. 14 15To prevent automatic upgrades to new major versions that may contain breaking 16changes, it is recommended to add version = &amp;#34;.</description>
    </item>
    
    <item>
      <title>æ–°å¼ç›‘æ§ç³»ç»Ÿ â€” prometheus</title>
      <link>https://example.com/posts/promethus/</link>
      <pubDate>Fri, 14 Sep 2018 22:31:20 +0800</pubDate>
      
      <guid>https://example.com/posts/promethus/</guid>
      <description>Prometheus æ˜¯ä¸€å¥—å¼€æºçš„ç³»ç»Ÿç›‘æ§æŠ¥è­¦æ¡†æ¶ã€‚å®ƒå¯å‘äº Google çš„ borgmon ç›‘æ§ç³»ç»Ÿï¼Œç”±å·¥ä½œåœ¨ SoundCloud çš„ google å‰å‘˜å·¥åœ¨ 2012 å¹´åˆ›å»ºï¼Œä½œä¸ºç¤¾åŒºå¼€æºé¡¹ç›®è¿›è¡Œå¼€å‘ï¼Œå¹¶äº 2015 å¹´æ­£å¼å‘å¸ƒã€‚2016 å¹´ï¼ŒPrometheus æ­£å¼åŠ å…¥ Cloud Native Computing Foundationï¼Œæˆä¸ºå—æ¬¢è¿åº¦ä»…æ¬¡äº Kubernetes çš„é¡¹ç›®ã€‚
Prometheusç®€ä»‹ ä½œä¸ºæ–°ä¸€ä»£çš„ç›‘æ§æ¡†æ¶ï¼ŒPrometheus å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š
  å¼ºå¤§çš„å¤šç»´åº¦æ•°æ®æ¨¡å‹ï¼š
 æ—¶é—´åºåˆ—æ•°æ®é€šè¿‡ metric åå’Œé”®å€¼å¯¹æ¥åŒºåˆ†ã€‚ æ‰€æœ‰çš„ metrics éƒ½å¯ä»¥è®¾ç½®ä»»æ„çš„å¤šç»´æ ‡ç­¾ã€‚ æ•°æ®æ¨¡å‹æ›´éšæ„ï¼Œä¸éœ€è¦åˆ»æ„è®¾ç½®ä¸ºä»¥ç‚¹åˆ†éš”çš„å­—ç¬¦ä¸²ã€‚ å¯ä»¥å¯¹æ•°æ®æ¨¡å‹è¿›è¡Œèšåˆï¼Œåˆ‡å‰²å’Œåˆ‡ç‰‡æ“ä½œã€‚ æ”¯æŒåŒç²¾åº¦æµ®ç‚¹ç±»å‹ï¼Œæ ‡ç­¾å¯ä»¥è®¾ä¸ºå…¨ unicodeã€‚    çµæ´»è€Œå¼ºå¤§çš„æŸ¥è¯¢è¯­å¥ï¼ˆPromQLï¼‰ï¼šåœ¨åŒä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œå¯ä»¥å¯¹å¤šä¸ª metrics è¿›è¡Œä¹˜æ³•ã€åŠ æ³•ã€è¿æ¥ã€å–åˆ†æ•°ä½ç­‰æ“ä½œã€‚
  æ˜“äºç®¡ç†ï¼š Prometheus server æ˜¯ä¸€ä¸ªå•ç‹¬çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ç›´æ¥åœ¨æœ¬åœ°å·¥ä½œï¼Œä¸ä¾èµ–äºåˆ†å¸ƒå¼å­˜å‚¨ã€‚
  é«˜æ•ˆï¼šå¹³å‡æ¯ä¸ªé‡‡æ ·ç‚¹ä»…å  3.5 bytesï¼Œä¸”ä¸€ä¸ª Prometheus server å¯ä»¥å¤„ç†æ•°ç™¾ä¸‡çš„ metricsã€‚
  ä½¿ç”¨ pull æ¨¡å¼é‡‡é›†æ—¶é—´åºåˆ—æ•°æ®ï¼Œè¿™æ ·ä¸ä»…æœ‰åˆ©äºæœ¬æœºæµ‹è¯•è€Œä¸”å¯ä»¥é¿å…æœ‰é—®é¢˜çš„æœåŠ¡å™¨æ¨é€åçš„ metricsã€‚
  å¯ä»¥é‡‡ç”¨ push gateway çš„æ–¹å¼æŠŠæ—¶é—´åºåˆ—æ•°æ®æ¨é€è‡³ Prometheus server ç«¯ã€‚</description>
    </item>
    
    <item>
      <title>Kubernetes è®¤è¯ä¸æˆæƒ</title>
      <link>https://example.com/posts/kubernetes-auth-rbac/</link>
      <pubDate>Fri, 15 Jun 2018 22:31:20 +0800</pubDate>
      
      <guid>https://example.com/posts/kubernetes-auth-rbac/</guid>
      <description>å¯¹äºä¸€ä¸ªç³»ç»Ÿæ¥è¯´ï¼Œè®¤è¯å’Œæˆæƒä¸å¯æˆ–ç¼ºçš„éƒ¨åˆ†ï¼Œæœ€å¸¸è§çš„æ–¹å¼è¦æ•°è´¦å·å¯†ç ï¼Œç®¡ç†å‘˜å’Œæ™®é€šç”¨æˆ·è¿™ç§è®¤è¯æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„ABACã€‚ä½†æ˜¯æ¯æ¬¡ä¿®æ”¹æƒé™éƒ½éœ€è¦é‡å¯ï¼Œæˆ–è€…ä¿®æ”¹è®°å½•ï¼Œä¼šæœ‰äº›ä¸æ–¹ä¾¿ï¼Œäºæ˜¯åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶&amp;ndash;RBACå°±å‡ºç°äº†ï¼ŒåŒæ—¶k8såˆ†ç¦»äº†è®¤è¯ï¼Œæˆæƒå’Œå‡†å…¥çš„è¿‡ç¨‹ï¼Œæ–¹ä¾¿ç¬¬ä¸‰æ–¹å¼€å‘ç›¸å…³æ’ä»¶ã€‚
ä¸‹å›¾å¤§è‡´æè¿°äº†k8sè®¤è¯çš„æµç¨‹å›¾ï¼Œæè¿°äº†ä¸€ä¸ªè¯·æ±‚åœ¨ç»è¿‡APIServerçš„æ—¶å€™éƒ½ç»å†äº†å“ªäº›é‰´æƒçš„è¿‡ç¨‹ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼šéœ€è¦è®¿é—®APIçš„æœ‰äººç±»ï¼Œä¹Ÿå°±æ˜¯Opsï¼Œé€šè¿‡kubectlä»¥åŠKubeconfigé…ç½®æ–‡ä»¶å’ŒAPI-Serveräº¤äº’ã€‚è¿˜æœ‰å°±æ˜¯Podï¼Œä¹Ÿå°±æ˜¯åº”ç”¨ï¼Œå¯¹APIèµ„æºè¿›è¡ŒCURDã€‚ç„¶åä¾æ¬¡ç»è¿‡äº†èº«ä»½è®¤è¯(authentication)ã€æˆæƒ(authorization)å’Œå‡†å…¥æ§åˆ¶ï¼ˆadmission controlï¼‰ã€‚ä¸‹é¢å°±æ¥è¯¦ç»†ä»‹ç»ä¸‹è®¤è¯å’Œæˆæƒ
è®¤è¯  Authenticationï¼šå³èº«ä»½éªŒè¯ï¼Œè¿™ä¸ªç¯èŠ‚å®ƒé¢å¯¹çš„è¾“å…¥æ˜¯æ•´ä¸ªhttp requestï¼Œå®ƒè´Ÿè´£å¯¹æ¥è‡ªclientçš„è¯·æ±‚è¿›è¡Œèº«ä»½æ ¡éªŒï¼Œæ”¯æŒçš„æ–¹æ³•åŒ…æ‹¬ï¼š  clientè¯ä¹¦éªŒè¯ï¼ˆhttpsåŒå‘éªŒè¯ï¼‰ basic auth æ™®é€štoken jwt token(ç”¨äºserviceaccount)    APIServerå¯åŠ¨æ—¶ï¼Œå¯ä»¥æŒ‡å®šä¸€ç§Authenticationæ–¹æ³•ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå¤šç§æ–¹æ³•ã€‚å¦‚æœæŒ‡å®šäº†å¤šç§æ–¹æ³•ï¼Œé‚£ä¹ˆAPIServerå°†ä¼šé€ä¸ªä½¿ç”¨è¿™äº›æ–¹æ³•å¯¹å®¢æˆ·ç«¯è¯·æ±‚è¿›è¡ŒéªŒè¯ï¼Œåªè¦è¯·æ±‚æ•°æ®é€šè¿‡å…¶ä¸­ä¸€ç§æ–¹æ³•çš„éªŒè¯ï¼ŒAPIServerå°±ä¼šè®¤ä¸ºAuthenticationæˆåŠŸï¼›åœ¨è¾ƒæ–°ç‰ˆæœ¬kubeadmå¼•å¯¼å¯åŠ¨çš„k8sé›†ç¾¤çš„apiserveråˆå§‹é…ç½®ä¸­ï¼Œé»˜è®¤æ”¯æŒclientè¯ä¹¦éªŒè¯å’Œserviceaccountä¸¤ç§èº«ä»½éªŒè¯æ–¹å¼ã€‚åœ¨è¿™ä¸ªç¯èŠ‚ï¼Œapiserverä¼šé€šè¿‡clientè¯ä¹¦æˆ–http headerä¸­çš„å­—æ®µ(æ¯”å¦‚serviceaccountçš„jwt token)æ¥è¯†åˆ«å‡ºè¯·æ±‚çš„â€œç”¨æˆ·èº«ä»½â€ï¼ŒåŒ…æ‹¬â€userâ€ã€â€groupâ€ç­‰ï¼Œè¿™äº›ä¿¡æ¯å°†åœ¨åé¢çš„authorizationç¯èŠ‚ç”¨åˆ°ã€‚
Client è¯ä¹¦ é¦–å…ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹kubectlçš„é»˜è®¤é…ç½®æ–‡ä»¶~/.kube/config
1apiVersion: v1 2clusters: 3- cluster: 4 certificate-authority-data: REDACTED 5 server: https://172.16.66.101:6443 6 name: kubernetes 7contexts: 8- context: 9 cluster: kubernetes 10 user: kubernetes-admin 11 name: kubernetes-admin@kubernetes 12current-context: kubernetes-admin@kubernetes 13kind: Config 14preferences: {} 15users: 16- name: kubernetes-admin 17 user: 18 client-certificate-data: REDACTED 19 client-key-data: REDACTED è¿™æœ‰ä¸¤ä¸ªé‡è¦çš„ä¿¡æ¯ client-certificate-data, client-key-data,é¦–å…ˆæŠŠdataæå–å‡ºæ¥</description>
    </item>
    
  </channel>
</rss>
